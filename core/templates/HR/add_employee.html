{% extends 'dashboard/base_template.html' %}
{% block title %}
CRM
{% endblock %}

{% block custom_css %}


{% endblock custom_css %}

{% block main_content %}


<div class="page-wrapper" style="padding-top: 0px;">
    <div class="content container-fluid">
        <div class="page-header">
            <div class="row">
                <div class="col-sm-12">
                    <h3 class="page-title">
                        <a href="{% url 'fn_employee_List_View' %}" style="margin-right: 10px;">
                            <i class="fa fa-arrow-left" data-bs-toggle="tooltip" title="" data-bs-original-title="Back" aria-label="fa fa-arrow-left"></i>
                        </a>
                        Add Employee
                    </h3>
                </div>
            </div>
        </div>
        <form method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="row">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-body">
                            <form method="post" id="vendor_form" action="" autocomplete="off">
                                <div class="row">
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label>Employee Name <span style="color: red;">*</span></label>
                                            <input type="text" class="form-control" name="name" id="name" placeholder="Employee Name" required>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-group">
                                        <label>Phone <span style="color: red;">*</span></label>
                                            <input type="text" class="form-control" name="phone" id="phone" placeholder="Mobile" required maxlength="10" 
                                            pattern="\d{10}" title="Enter a 10-digit number" 
                                            oninput="this.value = this.value.replace(/[^0-9]/g, '');">
                                        </div>
                                     </div>  
                                     <!-- <div class="col-md-3">
                                        <div class="form-group">
                                        <label>Email ID <span style="color: red;">*</span></label>
                                             <input type="email" class="form-control" name="email" id="email" placeholder="Email Address" required  pattern="[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}" required title="Please enter a valid email address">
                                          </div>
                                    </div> -->
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label>Email ID <span style="color: red;">*</span></label>
                                            <input type="text" class="form-control" name="email" id="email" 
                                                   placeholder="Email Address" required 
                                                   pattern="[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}|[nN][aA][nN]?" 
                                                   title="Please enter a valid email address or 'na', 'NA', 'NAN', 'nan'"
                                                   oninput="validateEmail(this)">
                                            <small id="emailMessage" class="form-text text-muted"></small>
                                        </div>
                                    </div>
                                    
                                    
                                    
                                    <div class="col-md-3">
                                        <div class="form-group">
                                        <label>Joining Date <span style="color: red;">*</span></label>
                                        <input type="date" placeholder="Joining Date" name="joining_date" class="form-control"
                                                class="form-input" required />
                                        </div>
                                    </div> 

                                 
                                  
                                 
                                    <div class="col-md-3">
                                        <div class="form-group">
                                        <label>Department <span style="color: red;">*</span></label>
                                        <select class="form-control" name="department_name" id="department" required>
                                            <option value="" disabled selected>Select Department</option>
                                            {% for item in employee_department %}
                                            <option value="{{ item.name }}">{{ item.name }}</option>
                                            {% endfor %}
                                             </select>
                                        </div>
                                     </div> 

                                     <div class="col-md-3">
                                        <div class="form-group">
                                        <label>Designation <span style="color: red;">*</span></label>
                                        <select class="form-control" name="designation_name" id="designation" required>
                                            <option value="" disabled selected>Select Designation</option>
                                            {% for item in employee_designation %}
                                            <option value="{{ item.name }}">{{ item.name }}</option>
                                            {% endfor %}
                                             </select>
                                        </div>
                                     </div> 
                                     <div class="col-md-3">
                                        <div class="form-group">
                                            <label>Address <span style="color: red;">*</span></label>
                                            <textarea type="text" name="address" id="address" class="form-control" placeholder="Address" required></textarea>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label>Bank Name <span style="color: red;">*</span></label>
                                            <input type="text" class="form-control" name="bank_name" id="bank_name" placeholder="Bank Name" required>
                                        </div>
                                    </div>


                                     <div class="col-md-3">
                                        <div class="form-group">
                                        <label>Account Number <span style="color: red;">*</span></label>
                                           <input type="text" class="form-control" name="account_number" id="account_number" placeholder="Account No." maxlength="17"  pattern="\d*" title="Please enter a valid account number" 
                                           oninput="this.value = this.value.replace(/[^0-9]/g, '');" required>
                                        </div>
                                     </div> 
                                     <div class="col-md-3">
                                        <div class="form-group">
                                        <label>IFSC Code</label>
                                           <input type="text" class="form-control" name="ifsc_code" id="ifsc_code" placeholder="IFSC Code" >
                                        </div>
                                     </div> 
                                     <div class="col-md-3">
                                        <div class="form-group">
                                        <label>Upload Photo</label>
                                            <input type="file" class="form-control" name="upload_photo" accept="employee_photos/*" >
                                     </div>
                                     </div> 
                                     <div class="col-md-3">
                                        <div class="form-group">
                                            <label>Status</label>
                                            <select class="form-control " name="status">
                                                <option value="">Select Status</option>
                                                <option value="Permanent">Permanent</option>
                                                <option value="Temporary">Temporary</option>
                                            </select>
                                        </div>
                                     </div>

                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label>Leaves Allocated</label>
                                            <input type="number" step="0.01" class="form-control" name="leaves_allocated" id="leaves_allocated"
                                                placeholder="Leaves Allocated" value="{{ employee.leaves_allocated|default_if_none:'' }}">
                                        </div>
                                    </div>
                                                     
                                      

                                 
                                </div>
                                <div class="add-customer-btns text-end">
                                    <a href="{% url 'fn_employee_List_View' %}" class="btn customer-btn-cancel btn-outline-danger me-1 btn-rounded">Cancel</a>
                                    <button type="submit" class="btn btn-outline-primary me-1 btn-rounded">Save Employee</button>
                                </div>
                                <div class="row col-sm-6 p-5">
                                    <div class="success_message row"></div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>



{% block custom_js %}

<script>
    function validateEmail(input) {
        const regex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$|^[nN][aA][nN]?$/;
        const messageElement = document.getElementById('emailMessage');
        if (regex.test(input.value)) {
            messageElement.textContent = 'Valid email address.';
            messageElement.style.color = 'green';
            input.setCustomValidity(''); // Clear custom validity
        } else {
            messageElement.textContent = 'Invalid email address. Please enter a valid email or "na", "NA", "NAN", "nan".';
            messageElement.style.color = 'red';
            input.setCustomValidity('Invalid email address'); // Set custom validity
        }
    }
    
    function checkFormValidity() {
        const emailInput = document.getElementById('email');
        validateEmail(emailInput); // Check email validity before form submission
    
        if (emailInput.checkValidity()) {
            return true; // Allow form submission if valid
        } else {
            return false; // Prevent form submission if invalid
        }
    }
    </script>
    
<script>
   document.addEventListener("DOMContentLoaded", function() {
       const gstNoInput = document.getElementById("gst_no");
       const gstNoLabel = document.querySelector(".gst_no"); // Get the label element
       const toggleGst = document.getElementById("toggleGst");

       // Check if GST number is initially provided
       if (gstNoInput.value.trim() !== '') {
           // If GST number is provided, keep the toggle button "on" (clicked)
           toggleGst.checked = true;
       } else {
           // If GST number is empty, turn the toggle button "off"
           toggleGst.checked = false;
           // Hide the GST number label and input field
           gstNoInput.style.display = 'none';
           gstNoLabel.style.display = 'none';
       }

       toggleGst.addEventListener("change", function() {
           if (!toggleGst.checked) {
               // If the toggle button is turned off, hide the GST number label and input field
               gstNoInput.style.display = 'none';
               gstNoLabel.style.display = 'none';
           } else {
               // If the toggle button is turned on, show the GST number label and input field
               gstNoInput.style.display = 'block';
               gstNoLabel.style.display = 'block';
           }
       });

       gstNoInput.addEventListener("input", function() {
           const gstNoValue = this.value.trim();
           if (gstNoValue !== '') {
               // If GST number is provided, keep the toggle button "on" (clicked)
               toggleGst.checked = true;
           } else {
               // If GST number is empty, turn the toggle button "off"
               toggleGst.checked = false;
           }
       });
   });
</script>

<!-- Add this script at the bottom of your HTML file, after the other JavaScript code -->
<script>
   document.addEventListener("DOMContentLoaded", function() {
     const gstIdInput = document.getElementById("gst_no");
     const panInput = document.getElementById("pan_no");
 
     // Function to generate PAN from GST (Assuming the format is consistent)
     function generatePAN(gstId) {
       // Extract the 3rd to 12th characters from the GST ID
       const panSubstring = gstId.substr(2, 10);
       // Append a fixed PAN suffix
       const panNumber = panSubstring;
       return panNumber;
     }
 
     gstIdInput.addEventListener("input", function() {
       const gstIdValue = this.value;
       if (gstIdValue.length >= 12) {
         const panValue = generatePAN(gstIdValue);
         panInput.value = panValue;
       } else {
         panInput.value = ''; // Clear the PAN field if the GST is not long enough
       }
     });
   });
 </script>
<script>
   document.addEventListener("DOMContentLoaded", function() {
      const gstNoInput = document.getElementById("gst_no");
      const toggleGst = document.getElementById("toggleGst");
  
      // Check if GST number is initially provided
      if (gstNoInput.value.trim() !== '') {
          // If GST number is provided, keep the toggle button "on" (clicked)
          toggleGst.checked = true;
      } else {
          // If GST number is empty, turn the toggle button "off"
          toggleGst.checked = false;
      }
  
      gstNoInput.addEventListener("input", function() {
          const gstNoValue = this.value.trim();
          if (gstNoValue !== '') {
              // If GST number is provided, keep the toggle button "on" (clicked)
              toggleGst.checked = true;
          } else {
              // If GST number is empty, turn the toggle button "off"
              toggleGst.checked = false;
          }
      });
  });
  
</script>  
<script>
   document.addEventListener("DOMContentLoaded", function() {
       // Your existing code for other fields here...
       
       // Function to validate Maximum Payment Limit
       function validateMaximumPaymentLimit(value) {
           // Allow empty value
           if (value.trim() === '') {
               return true;
           }

           // Add any additional validation logic if needed
           return true; // Return true for non-empty values (add validation logic here if needed)
       }

       const maximumPaymentLimitInput = document.getElementById("maximum_payment_limit");
       
       maximumPaymentLimitInput.addEventListener("input", function() {
           const value = this.value;
           if (!validateMaximumPaymentLimit(value)) {
               // Display an error message or perform other actions for invalid values
           }
       });
   });
</script>
<!-- Include jQuery -->
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

<script>
   // Get references to the dropdown and input fields
   var scustomer = document.getElementById("first_name");
   var fromInput = document.getElementById("display_name_input");

   // Add an event listener to the dropdown to update the input field when it changes
   scustomer.addEventListener("change", function () {
       var selectedcustomer = scustomer.value;
       fromInput.value = selectedcustomer;
   });
</script>



<script>
   document.addEventListener("DOMContentLoaded", function() {
       // Your existing code for other fields here...
       
       // Function to validate Total Supply Value
       function validateTotalSupplyValue(value) {
           if (value.trim() === '') {
               return true; // Allow empty value
           }
           
           // Add any additional validation logic if needed
           return true; // Return true for non-empty values (add validation logic here if needed)
       }

       // Function to validate Maximum Payment Limit
       function validateMaximumPaymentLimit(value) {
           if (value.trim() === '') {
               return true; // Allow empty value
           }

           // Add any additional validation logic if needed
           return true; // Return true for non-empty values (add validation logic here if needed)
       }

       const totalSupplyValueInput = document.getElementById("total_supply_value");
       const maximumPaymentLimitInput = document.getElementById("maximum_payment_limit");
       
       totalSupplyValueInput.addEventListener("input", function() {
           const value = this.value;
           if (!validateTotalSupplyValue(value)) {
               // Display an error message or perform other actions for invalid values
           }
       });
       
       maximumPaymentLimitInput.addEventListener("input", function() {
           const value = this.value;
           if (!validateMaximumPaymentLimit(value)) {
               // Display an error message or perform other actions for invalid values
           }
       });
   });
</script>

   <script>
      document.addEventListener("DOMContentLoaded", function() {
         const ifscInput = document.getElementById("ifscInput");
         const ifscError = document.getElementById("ifscError");
   
         // Function to validate an IFSC code
         function validateIFSC(ifsc) {
            if (ifsc.trim() === '') {
               return true;  // Empty value is allowed
            }
   
            const ifscRegex = /^[A-Za-z]{4}[0-9]{7}$/; // Regular expression for IFSC
            return ifscRegex.test(ifsc);
         }
   
         ifscInput.addEventListener("input", function() {
            const ifscValue = this.value.trim().toUpperCase(); // Remove whitespace and convert to uppercase
            if (!validateIFSC(ifscValue)) {
               ifscError.textContent = 'Enter a valid IFSC code (e.g., ABCD0123456).';
            } else {
               ifscError.textContent = '';
            }
         });
      });
   </script>
   

<script>
  document.addEventListener("DOMContentLoaded", function() {
      const mobileInput = document.getElementById("mobile");
      const mobileError = document.getElementById("mobileError");

      mobileInput.addEventListener("input", function() {
          const mobileValue = this.value;
          const mobileRegex = /^[0-9]{10}$/; // Regular expression for a 10-digit mobile number

          if (!mobileRegex.test(mobileValue)) {
              mobileError.textContent = "Enter a valid 10-digit mobile number.";
          } else {
              mobileError.textContent = "";
          }
      });
  });
</script>

<script>
   document.addEventListener("DOMContentLoaded", function() {
       const gstNoInput = document.getElementById("gst_no");
       const gstNoError = document.getElementById("gstNoError");
 
       function validateGSTNo(gstNoValue) {
           if (gstNoValue.trim() === '') {
               return true;  // Allow empty value
           }
 
           const gstNoRegex = /^([0-9]{2}[A-Z]{5}[0-9]{4}[A-Z]{1}[1-9A-Z]{1}[Z]{1}[0-9A-Z]{1})$/; 
 
           return gstNoRegex.test(gstNoValue);
       }
 
       gstNoInput.addEventListener("input", function() {
           const gstNoValue = this.value;
 
           if (!validateGSTNo(gstNoValue)) {
               gstNoError.textContent = "Enter a valid GST number (e.g., 12ABCDE1234F1Z5).";
           } else {
               gstNoError.textContent = "";
           }
       });
   });
 </script>
 <script>
   document.addEventListener("DOMContentLoaded", function() {
       const panInput = document.getElementById("pan_no");
       const panError = document.getElementById("panError");
 
       // Function to validate a PAN number
       function validatePAN(pan) {
           if (pan.trim() === '') {
               return true;  // Allow empty value
           }
 
           const panRegex = /^[A-Z]{5}[0-9]{4}[A-Z]$/; // Regular expression for PAN
           return panRegex.test(pan);
       }
 
       panInput.addEventListener("input", function() {
           const panValue = this.value.trim().toUpperCase(); // Remove whitespace and convert to uppercase
           if (!validatePAN(panValue)) {
               panError.textContent = 'Enter a valid PAN number (e.g., ABCDE1234F).';
           } else {
               panError.textContent = '';
           }
       });
   });
 </script>
 
{% endblock custom_js %}    
{% endblock main_content %}

    
