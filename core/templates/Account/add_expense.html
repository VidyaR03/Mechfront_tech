{% extends 'dashboard/base_template.html' %}
{% block title %}
CRM
{% endblock %}

{% block custom_css %}

<style>
    /* Inactive tab styles */
    .nav-tabs.nav-tabs-bottom .nav-item .nav-link {
        color: #ccc;
        /* Faint gray color for inactive tabs */
    }

    /* Active tab style */
    .nav-tabs.nav-tabs-bottom .nav-item .nav-link.active {
        color: #000;
        /* Black color for active tab */
    }
</style>
{% endblock custom_css %}

{% block main_content %}
<div class="page-wrapper" data-select2-id="8" style="min-height: 432px;">
    <div class="content container-fluid" data-select2-id="7">
        <div class="page-header invoices-page-header">
            <div class="row align-items-center">
                <div class="col">
                    <h3 class="page-title"> <a href="{% url 'expense_vendor_list'%}" style="margin-right: 10px;"><i
                                class="fa fa-arrow-left" data-bs-toggle="tooltip" title="" data-bs-original-title="Back"
                                aria-label="fa fa-arrow-left"></i></a> Add Expence</h3>
                </div>
                <div class="col-auto"> </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <div class="card invoices-add-card">
                    <div class="card-body">
                        <form class="invoices-form" method="post" id="invoice_form"
                            action="{% url 'add_expense_vendor_data'%}" enctype="multipart/form-data"
                            autocomplete="off">
                            {% csrf_token %}
                            <div class="invoices-main-form">
                                <div class="row">


                                    <div class="col-xl-3 col-md-6 col-sm-12 col-12">
                                        <div class="form-group">
                                            <div>
                                                <label>Vendor Name <span style="color: red;">*</span></label>
                                                <select class="form-control" name="ac_vendor" id="ac_vendor" required>
                                                    <option value="" disabled selected>Select Vendor</option>
                                                    {% for item in vendor_name %}
                                                    <option value="{{ item.company_name}}">{{ item.company_name }}
                                                    </option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-xl-3 col-md-6 col-sm-12 col-12">
                                        <div class="form-group">
                                            <div class=" ">
                                                <span>
                                                    <label>Invoice Date <span style="color: red;">*</span></label>
                                                    <input type="date" class="form-control" name="acc_date"
                                                        id="acc_date" placeholder="Date" required>
                                                </span>
                                            </div>
                                        </div>
                                    </div>


                                    <div class="col-xl-3 col-md-6 col-sm-12 col-12">
                                        <div class="form-group">
                                            <label>GST No.<span style="color: red;">*</span></label>
                                            <input type="text" class="form-control" name="acc_gst" id="acc_gst" required>
                                            <span id="gstError" style="color: red;"></span>

                                        </div>
                                    </div>

                                    <div class="col-xl-3 col-md-6 col-sm-12 col-12">
                                        <div class="form-group">
                                            <label>Freight<span style="color: red;">*</span></label>
                                            <input type="text" class="form-control" name="freight" id="freight" required>
                                        </div>
                                    </div>


                                    <div class="rowbb">
                                        <div class="invoice-add-table">
                                            <div class="table-responsive">
                                                <table class="table table-center add-table-items">
                                                    <thead>
                                                        <tr>
                                                            <th>Item Code</th>
                                                            <th width="180px">Description of Goods</th>
                                                            <th>HSN</th>
                                                            <th>Qty</th>
                                                            <th>UOM</th>
                                                            <th>Unit Price</th>
                                                            <th>Disc(%)</th>
                                                            <th>Tax Rate</th>
                                                            <th>Tax Amt</th>
                                                            <th>Total</th>
                                                            <th>Actions</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <input type="hidden" name="iid[]" class="iid" value="0">
                                                        <tr class="add-row">
                                                            <td><input type="text" class="form-control"
                                                                    name="itemcode_0" id="itemcode_0"
                                                                    onkeyup="getitemscodedetails('itemcode_0','item_0','godown_0','qty_0','rate_0','hsn_0','uom_0','discount_0','taxrate_0');" required>
                                                            </td>
                                                            <td><input type="text" class="form-control" name="item_0"
                                                                    id="item_0"
                                                                    onkeyup="getitemsdetails('item_0','godown_0','qty_0','rate_0','hsn_0','uom_0','discount_0','taxrate_0','itemcode_0');"
                                                                    placeholder=" " required>
                                                            </td>
                                                            <!-- <td><input type="text" class="form-control" name="des_0"
                                                                    id="des_0"></td> -->
                                                            <td><input type="text" class="form-control" name="hsn_0"
                                                                    id="hsn_0" required></td>

                                                            <td><input type="text" class="form-control" name="qty_0"
                                                                    id="qty_0" onkeyup="qty('qty_0')" required> </td>

                                                            <td><input type="text" class="form-control" name="uom_0"
                                                                    id="uom_0" required></td>

                                                            <td><input type="text" class="form-control" name="rate_0"
                                                                    id="rate_0" onkeyup="rate('rate_0')" required></td>


                                                            <td><input type="text" class="form-control"
                                                                    name="discount_0" id="discount_0"
                                                                    onkeyup="discountamt('discount_0')" required></td>

                                                            <td><input type="number" class="form-control" name="taxrate_0"
                                                                    id="taxrate_0" onkeyup="taxrate('taxrate_0')" required></td>

                                                            <td><input type="text" class="form-control taxamt"
                                                                    name="taxamt_0" id="taxamt_0" required></td>

                                                            <td><input type="text" class="form-control totalamt"
                                                                    name="total_0" id="total_0" required></td>

                                                            <td class="add-remove text-end"> <a
                                                                    href="javascript:void(0);" class="add-btn me-2"><i
                                                                        class="fas fa-plus-circle"></i></a> <a
                                                                    href="javascript:void(0);" class="remove-btn"><i
                                                                        class="fe fe-trash-2"></i></a></td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-lg-7 col-md-6">
                                                <!-- <div class="form-group float-end mb-0"> <button class="btn btn-primary" type="submit">Add Item</button> </div> -->
                                                <div class="invoice-fields">
                                                    <h4 class="field-title">Terms and Conditions</h4> <br> <textarea
                                                        class="form-control" name="note"></textarea>
                                                </div>
                                            </div>
                                            <div class="col-lg-5 col-md-6">
                                                <div class="invoice-total-card">
                                                    <h4 class="invoice-total-title">Summary</h4>
                                                    <div class="invoice-total-box">
                                                        <div class="invoice-total-inner">

                                                            <div class="row">
                                                                <div class="col-lg-6">
                                                                    <p>Sub Total </p>
                                                                </div>
                                                                <div class="col-lg-6 ">
                                                                    <input type="text" class="subtotal billamt utrt1"
                                                                        name="subtotal" value="0.00" readonly="" required>
                                                                </div>
                                                            </div>

                                                            <!-- <div class="row">
                                                                <div class="col-lg-6"><p>Freight</p></div>
                                                                <div class="col-lg-6 ">
                                                                    <input class="billamt utrt1" type="text" name="freight" id="freight" value="0.00" onkeyup="getbillamt();" >
                                                                </div>
                                                            </div> -->

                                                            <div class="row">
                                                                <!-- <div class="col-lg-6"><p>Tax Amt</p></div> -->
                                                                <div class="col-lg-6 ">
                                                                    <input type="hidden"
                                                                        class="totaltaxamt billamt utrt1"
                                                                        name="total_taxamt" id="total_taxamt"
                                                                        value="0.00" readonly="">
                                                                </div>
                                                            </div>

                                                            <div class="row">
                                                                <div class="col-lg-6">
                                                                    <p>CGST @ <input type="text" name="cgstper"
                                                                            id="cgstper" value="0%" size="1"
                                                                            class="no-outline"></p>
                                                                </div>
                                                                <div class="col-lg-6 ">
                                                                    <input type="text" class="utrt1" name="cgst"
                                                                        id="cgst" value="0.00" readonly="">
                                                                </div>
                                                            </div>

                                                            <div class="row">
                                                                <div class="col-lg-6">
                                                                    <p>SGST @ <input type="text" name="sgstper"
                                                                            id="sgstper" value="0%" size="1"
                                                                            class="no-outline"></p>
                                                                </div>
                                                                <div class="col-lg-6 ">
                                                                    <input type="text" class="utrt1" name="sgst"
                                                                        id="sgst" value="0.00" readonly="">
                                                                </div>
                                                            </div>

                                                            <div class="row">
                                                                <div class="col-lg-6">
                                                                    <p>IGST @ <input type="text" name="igstper"
                                                                            id="igstper" value="0%" size="1"
                                                                            class="no-outline"></p>
                                                                </div>
                                                                <div class="col-lg-6 ">
                                                                    <input type="text" class="utrt1" name="igst"
                                                                        id="igst" value="0.00" readonly="">
                                                                </div>
                                                            </div>

                                                            <div class="row">
                                                                <div class="col-lg-6">
                                                                    <p>Adjustments</p>
                                                                </div>
                                                                <div class="col-lg-6 ">
                                                                    <input class="billamt utrt1" type="text"
                                                                        name="adjustment" id="adjustment" value="0.00"
                                                                        onkeyup="getbillamt();">
                                                                </div>
                                                            </div>

                                                            <div class="row">
                                                                <div class="col-lg-6">
                                                                    <p>TCS on Sale Of any Goods </p>
                                                                </div>
                                                                <div class="col-lg-6 ">
                                                                    <input class="billamt utrt1" type="text"
                                                                        name="sale_of_good" id="sale_of_good"
                                                                        value="0.00" onkeyup="getbillamt();">
                                                                </div>
                                                            </div>

                                                            <div class="invoice-total-footer">
                                                                <h4>Total Amount <input class="finalamt utrt1"
                                                                        type="text" name="totalamt" value="0.00"
                                                                        readonly="" required></h4>
                                                            </div>

                                                        </div>
                                                    </div>

                                                    <div class="upload-sign">
                                                        <div class="form-group float-end mb-0"> <a
                                                                href="{% url 'expense_vendor_list'%}"
                                                                class="btn btn-primary">Cancel</a></div>
                                                        <div class="form-group float-end mb-0"> <button
                                                                class="btn btn-primary" type="submit" id="btn_submit"
                                                                name="btn_submit">Save</button> </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row col-sm-6 p-5">
                                        <div class="success_message row"></div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>




<!-- Fot GST Number -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
     const gstNoInput = document.getElementById("acc_gst");
     const gstError = document.getElementById("gstError");
 
     function validateGSTNo(gstNoValue) {
         if (gstNoValue.trim() === '') {
             return true;  // Allow empty value
         }
 
         const gstNoRegex = /^([0-9]{2}[A-Z]{5}[0-9]{4}[A-Z]{1}[1-9A-Z]{1}[Z]{1}[0-9A-Z]{1})$/;
         return gstNoRegex.test(gstNoValue);
     }
 
     gstNoInput.addEventListener("input", function () {
         const gstNoValue = this.value;
 
         if (!validateGSTNo(gstNoValue)) {
             gstError.textContent = "Enter a valid GST number (e.g., 12ABCDE1234F1Z5).";
         } else {
             gstError.textContent = "";
         }
     });
 });
 
 </script>


<script src="https://code.jquery.com/ui/1.10.2/jquery-ui.js"></script>

<script src="https://code.jquery.com/jquery-migrate-3.0.0.min.js"></script>

<script type="text/javascript">
    $(".add-table-items").on('click', '.remove-btn', function () {
        $(this).closest('.add-row').remove();

        subtotal();

        getbillamt();

        totaltaxamt();

        return false;
    });

    var i = 1;
    $(document).on("click", ".add-btn", function () {
        var experiencecontent = '<tr class="add-row">' +
            '<input type="hidden" name="iid[]" class="iid" value="' + i + '">' +

            '<td>' +
            '<input type="text" class="form-control" name="itemcode_' + i + '" id="itemcode_' + i + '">' +
            '</td>' +

            '<td>' +
            '<input type="text" name="item_' + i + '" id="item_' + i + '" class="form-control" onkeyup="getitemsdetails(\'item_' + i + '\',\'qty_' + i + '\',\'rate_' + i + '\',\'hsn_' + i + '\',\'uom_' + i + '\',\'discount_' + i + '\',\'taxrate_' + i + '\',\'itemcode_' + i + '\'); ">' +
            '</td>' +

            '<td>' +
            '<input type="text" class="form-control" name="hsn_' + i + '" id="hsn_' + i + '">' +
            '</td>' +

            '<td>' +
            '<input type="text" class="form-control" name="qty_' + i + '" id="qty_' + i + '" onkeyup="qty(\'qty_' + i + '\');">' +
            '</td>' +

            '<td>' +
            '<input type="text" class="form-control" name="uom_' + i + '" id="uom_' + i + '">' +
            '</td>' +

            '<td>' +
            '<input type="text" class="form-control" name="rate_' + i + '" id="rate_' + i + '" onkeyup="rate(\'rate_' + i + '\');">' +
            '</td>' +

            '<td>' +
            '<input type="text" class="form-control" name="discount_' + i + '" id="discount_' + i + '" onkeyup="discountamt(\'discount_' + i + '\');">' +
            '</td>' +

            '<td>' +
            '<input type="text" class="form-control" name="taxrate_' + i + '" id="taxrate_' + i + '" onkeyup="taxrate(\'taxrate_' + i + '\');">' +
            '</td>' +

            '<td>' +
            '<input type="text" class="form-control taxamt" name="taxamt_' + i + '" id="taxamt_' + i + '">' +
            '</td>' +

            '<td>' +
            '<input type="text" class="form-control totalamt" name="total_' + i + '" id="total_' + i + '">' +
            '</td>' +

            '<td class="add-remove text-end">' +
            '<a href="javascript:void(0);" class="add-btn me-2"><i class="fas fa-plus-circle"></i></a> ' +
            '<a href="javascript:void(0);" class="remove-btn"><i class="fe fe-trash-2"></i></a>' +
            '</td>' +
            '</tr>';
        i++;
        $(".add-table-items").append(experiencecontent);
        return false;
    });
</script>

<script type="text/javascript">
    function getitemsdetails(inputname, qty, rate, hsn, uom, discount, taxrate, itemcode) {
        //alert();return;
        input = inputname.split("_");
        //alert(input);return;

        $('#' + inputname).autocomplete({
            source: function (request, response) {
                $.ajax({
                    url: '#',
                    dataType: "json",
                    type: "POST",
                    data: {
                        name_startsWith: request.term,
                        itemsdetails: input
                    },
                    success: function (data) {
                        response($.map(data, function (item) {
                            var code = item.split("|");
                            //alert(data);
                            return {
                                label: code[0],
                                value: code[0],
                                data: item
                            }
                        }));
                    }
                });
            },
            autoFocus: true,
            minLength: 0,
            change: function (event, ui) {
                if (ui.item == null) {
                }
            },
            select: function (event, ui) {
                var names = ui.item.data.split("|");
                console.log(names)
                $('#' + inputname).val(names[0]);
                //$('#'+qty).val(names[3]);
                $('#' + qty).val('1');
                $('#' + rate).val(names[4]);
                $('#' + hsn).val(names[5]);
                $('#' + discount).val(names[6]);
                //$('#'+taxrate).val('0');
                $('#' + taxrate).val(names[7]);
                $('#' + uom).val(names[10]);
                $('#' + itemcode).val(names[11]);

                discountamt(inputname);

                //taxrate(inputname);

                subtotal();

                totaltaxamt();

                getbillamt()
            }

        });
    }

    function discountamt(inputname) {
        //alert(inputname);
        input = inputname.split("_");
        id_val = input[1];
        //alert(id_val);

        var rate = $('#rate_' + id_val).val();
        var discount = $('#discount_' + id_val).val();
        var qty = $('#qty_' + id_val).val();

        /*//var discountamt = rate/100;
        //var totalamt = rate-discountamt;
        var totalamt = rate-(rate*discount/100);
        $('#total_'+id_val).val(totalamt);

        var taxrate = $('#taxrate_'+id_val).val();
        var taxamt = totalamt*taxrate/100;
        //alert(taxamt);

        $('#taxamt_'+id_val).val((taxamt).toFixed(2));*/

        var item_rate = $('#item_rate').val();

        if (item_rate == 'tax_exclusive') {
            var total = rate - (rate * discount / 100);
            //alert(totalamt);

            var totalamt = total * qty;
            //alert(totalamt);

            $('#total_' + id_val).val((totalamt).toFixed(2));

            var taxrate = $('#taxrate_' + id_val).val();
            var taxamt = totalamt * taxrate / 100;
            //alert(taxamt);

            $('#taxamt_' + id_val).val((taxamt).toFixed(2));
        }

        if (item_rate == 'tax_inclusive') {
            var total = rate - (rate * discount / 100);
            //alert(totalamt);

            var totalamt = total * qty;
            //alert(totalamt);

            //t = $('#total_'+id_val).val((totalamt).toFixed(2));

            var taxrate = $('#taxrate_' + id_val).val();
            var taxamt = totalamt * taxrate / 100;
            //alert(taxamt);

            $('#taxamt_' + id_val).val((taxamt).toFixed(2));

            t = totalamt - taxamt;

            $('#total_' + id_val).val((t).toFixed(2));
        }

        subtotal();

        getbillamt()
    }

    function taxrate(inputname) {
        //alert(inputname);
        input = inputname.split("_");
        id_val = input[1];
        //alert(id_val);

        var rate = $('#rate_' + id_val).val();
        var discount = $('#discount_' + id_val).val();
        var qty = $('#qty_' + id_val).val();

        /*//var discountamt = rate/100;
        //var totalamt = rate-discountamt;
        var totalamt = rate-(rate*discount/100);
        $('#total_'+id_val).val(totalamt);

        var taxrate = $('#taxrate_'+id_val).val();
        var taxamt = totalamt*taxrate/100;
        //alert(taxamt);

        $('#taxamt_'+id_val).val((taxamt).toFixed(2));*/

        var item_rate = $('#item_rate').val();

        if (item_rate == 'tax_exclusive') {
            var total = rate - (rate * discount / 100);
            //alert(totalamt);

            var totalamt = total * qty;
            //alert(totalamt);

            $('#total_' + id_val).val((totalamt).toFixed(2));

            var taxrate = $('#taxrate_' + id_val).val();
            var taxamt = totalamt * taxrate / 100;
            //alert(taxamt);

            $('#taxamt_' + id_val).val((taxamt).toFixed(2));
        }

        if (item_rate == 'tax_inclusive') {
            var total = rate - (rate * discount / 100);
            //alert(totalamt);

            var totalamt = total * qty;
            //alert(totalamt);

            //t = $('#total_'+id_val).val((totalamt).toFixed(2));

            var taxrate = $('#taxrate_' + id_val).val();
            var taxamt = totalamt * taxrate / 100;
            //alert(taxamt);

            $('#taxamt_' + id_val).val((taxamt).toFixed(2));

            t = totalamt - taxamt;

            $('#total_' + id_val).val((t).toFixed(2));
        }

        subtotal();

        getbillamt();

        totaltaxamt()
    }

    function totaltaxamt() {
        place_of_supply = $('#place_of_supply').val();

        taxrate_0 = $('#taxrate_0').val();
        //alert(taxrate_0);

        taxrate = taxrate_0 / 2;

        if (place_of_supply == 23) {
            var sum1 = 0;
            $(".totaltaxamt").each(function () {
                sum1 += +this.value;
            });

            taxamt = sum1 / 2;

            $('#cgst').val(taxamt);
            $('#sgst').val(taxamt);
            $('#igst').val("0.00");

            $('#cgstper').val(taxrate + '%');
            $('#sgstper').val(taxrate + '%');
            $('#igstper').val("0%");
        }
        else {
            var sum1 = 0;
            $(".totaltaxamt").each(function () {
                sum1 += +this.value;
            });

            taxamt = sum1 / 2;

            $('#cgst').val("0.00");
            $('#sgst').val("0.00");
            $('#igst').val(sum1);

            $('#cgstper').val("0%");
            $('#sgstper').val("0%");
            $('#igstper').val(taxrate_0 + '%');
        }

    }

    function qty(inputname) {
        input = inputname.split("_");
        id_val = input[1];
        //alert(id_val);

        var rate = $('#rate_' + id_val).val();
        var qty = $('#qty_' + id_val).val();
        var discount = $('#discount_' + id_val).val();

        var item_rate = $('#item_rate').val();

        if (item_rate == 'tax_exclusive') {
            //var discountamt = rate/100;
            //var total = rate-discountamt;
            var total = rate - (rate * discount / 100);
            //alert(total);
            var totalamt = total * qty;
            //alert(totalamt);

            $('#total_' + id_val).val((totalamt).toFixed(2));

            var taxrate = $('#taxrate_' + id_val).val();
            var taxamt = totalamt * taxrate / 100;
            //alert(taxamt);

            $('#taxamt_' + id_val).val((taxamt).toFixed(2));
        }

        if (item_rate == 'tax_inclusive') {
            //var discountamt = rate/100;
            //var total = rate-discountamt;
            var total = rate - (rate * discount / 100);
            //alert(total);
            var totalamt = total * qty;
            //alert(totalamt);

            //t = $('#total_'+id_val).val((totalamt).toFixed(2));

            var taxrate = $('#taxrate_' + id_val).val();
            var taxamt = totalamt * taxrate / 100;
            //alert(taxamt);

            $('#taxamt_' + id_val).val((taxamt).toFixed(2));

            t = totalamt - taxamt;

            $('#total_' + id_val).val((t).toFixed(2));
        }

        subtotal();

        getbillamt();
    }

    function rate(inputname) {
        input = inputname.split("_");
        id_val = input[1];
        //alert(id_val);

        var rate = $('#rate_' + id_val).val();
        var qty = $('#qty_' + id_val).val();
        var discount = $('#discount_' + id_val).val();

        /*//var discountamt = rate/100;
        //var total = rate-discountamt;
        var total = rate-(rate*discount/100);
        var totalamt = total*qty;
        //alert(totalamt);

        $('#total_'+id_val).val((totalamt).toFixed(2));

        var taxrate = $('#taxrate_'+id_val).val();
        var taxamt = totalamt*taxrate/100;
        //alert(taxamt);

        $('#taxamt_'+id_val).val((taxamt).toFixed(2));*/

        var item_rate = $('#item_rate').val();

        if (item_rate == 'tax_exclusive') {
            //var discountamt = rate/100;
            //var total = rate-discountamt;
            var total = rate - (rate * discount / 100);
            //alert(total);
            var totalamt = total * qty;
            //alert(totalamt);

            $('#total_' + id_val).val((totalamt).toFixed(2));

            var taxrate = $('#taxrate_' + id_val).val();
            var taxamt = totalamt * taxrate / 100;
            //alert(taxamt);

            $('#taxamt_' + id_val).val((taxamt).toFixed(2));
        }

        if (item_rate == 'tax_inclusive') {
            //var discountamt = rate/100;
            //var total = rate-discountamt;
            var total = rate - (rate * discount / 100);
            //alert(total);
            var totalamt = total * qty;
            //alert(totalamt);

            //t = $('#total_'+id_val).val((totalamt).toFixed(2));

            var taxrate = $('#taxrate_' + id_val).val();
            var taxamt = totalamt * taxrate / 100;
            //alert(taxamt);

            $('#taxamt_' + id_val).val((taxamt).toFixed(2));

            t = totalamt - taxamt;

            $('#total_' + id_val).val((t).toFixed(2));
        }

        subtotal();

        getbillamt();
    }

    function subtotal() {
        var freight = $('#freight').val();
        //alert(freight);

        var totalamt = 0;
        $(".totalamt").each(function () {
            totalamt += +this.value;
        });
        //alert(totalamt);

        sub_total = parseInt(freight) + totalamt;

        $('.subtotal').val(sub_total);
        //$('.finalamt').val(parseInt(totalamt));

        taxrate = $('#taxrate_0').val();

        gst_amount = (sub_total * taxrate) / 100

        var sum1 = 0;
        $(".taxamt").each(function () {
            sum1 += +this.value;
        });

        $('.totaltaxamt').val(gst_amount);

        finalamt = totalamt + sum1;
        $('.finalamt').val(finalamt);
    }

    function getbillamt() {
        var sum = 0;
        $(".billamt").each(function () {
            sum += +this.value;
        });
        //alert(sum);

        $('.finalamt').val((sum).toFixed(2));
    }

    $(document).on('change', '#item_rate', function () {
        var item_rate = $(this).val();
        //alert(item_rate);

        for (var i = 0; i < 2; i++) {
            //alert(i);

            if (item_rate == 'tax_inclusive') {
                qty('qty_' + i);
                rate('rate_' + i);
                discountamt('discount_' + i);
            }

            if (item_rate == 'tax_exclusive') {
                qty('qty_' + i);
                rate('rate_' + i);
                discountamt('discount_' + i);
            }
        }


    });
</script>

<script type="text/javascript">
    $(function () {
        $("#expense_form").ajaxForm({
            beforeSend: function () {
                $('#btn_submit').prop('disabled', true);
                $('.form_error_msg').html('');
                $('.success_message').html('<br><div class="alert alert-info">Data analyzing...please wait...</div>');
            },
            uploadProgress: function (event, position, total, percentComplete) {
                //albumprogressbar.width(percentComplete + '%');
            },
            beforeSubmit: function () {
                return $("#expense_form").valid(); // TRUE when form is valid, FALSE will cancel submit
            },
            complete: function (response) {
                //alert('Your Proposal Id Is'+response.pi);
                //console.log(response);return;
                var temp = JSON.parse(response.responseText);
                //console.log(temp);
                if (temp.status == 'success') {
                    $('.success_message').show().html(temp.message);
                    setTimeout(function () {
                        window.location.href = temp.redirect;
                    }, 3000);
                }
                else if (temp.status == 'error') {
                    $('#btn_submit').prop('disabled', false);
                    $('.success_message').html('');
                    $.each(temp.errors, function (key, val) {
                        $('.' + key).html(val);
                    });
                }
            }
        });
    });
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.17.0/jquery.validate.js"></script>

<script src="https://olatechs.in/crm/supreeno/assets/js/malsup-jquery.js"></script>


</body>
</script>
{% endblock main_content %}