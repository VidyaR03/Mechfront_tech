{% extends 'dashboard/base_template.html' %}
{% block title %}
crm
{% endblock %}

{% block custom_css %}

<style>
    /* Inactive tab styles */
    .nav-tabs.nav-tabs-bottom .nav-item .nav-link {
        color: #ccc;
        /* Faint gray color for inactive tabs */
    }

    /* Active tab style */
    .nav-tabs.nav-tabs-bottom .nav-item .nav-link.active {
        color: #000;
        /* Black color for active tab */
    }
</style>
{% endblock custom_css %}

{% block main_content %}
<div class="page-wrapper" style="min-height: 434px;">
    <div class="content container-fluid">
        <div class="page-header invoices-page-header">
            <div class="row align-items-center">
                <div class="col">
                    <h3> <a href="{% url 'performa_invoice_list'%}" style="margin-right: 10px;"><i class="fa fa-arrow-left"
                                data-bs-toggle="tooltip" title="" data-bs-original-title="Back"
                                aria-label="fa fa-arrow-left"></i></a>
                        Update Invoice</h3>
                </div>
                <div class="col-auto"> </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <div class="card invoices-add-card">
                    <div class="card-body">
                        <form class="invoices-form" method="post" id="invoice_form"
                            action="{% url 'performa_edit_invoice' id=invoice_data.id %}" enctype="multipart/form-data"
                            autocomplete="off">
                            {% csrf_token %}
                            <input type="hidden" name="invoice_id" id="invoice_id" value="18">
                            <div class="invoices-main-form">
                                <div class="row">
                                    <div class="col-xl-3 col-md-6 col-sm-12 col-12">
                                        <div class="form-group">
                                            <label>Invoice No</label>
                                            <div class="input-group">
                                                <input type="text" class="form-control" name="invoice_no" id="invoice_no"
                                                    value="{{ invoice_data.pi_number }}" readonly required
                                                    oninput="validateInvoiceNumber()">
                                                <div class="input-group-append">
                                                    <button type="button" id="edit_invoice_no_btn" class="btn btn-outline-secondary" title="Edit Invoice No." style="height: 42px;">
                                                        <i class="fa fa-edit"></i>
                                                    </button>
                                                </div>
                                            </div>
                                            <div id="invoice_no_error" style="display: none; color: red;">Invalid Invoice Number format.</div>
                                            <div id="duplicate_invoice_no_error" style="display: none; color: red;">Invoice number already exists.</div>
                                        </div>
                                    </div>
                                    <div class="col-xl-3 col-md-6 col-sm-12 col-12">
                                        <div class="form-group">
                                            <div class=" ">
                                                <span>
                                                    <label>Invoice Date <span class="text-danger">*</span></label>
                                                    <input class="form-control datetimepicker" type="text"
                                                        name="invoice_date" id="invoice_date"
                                                        value="{{invoice_data.invoice_date}} | date:'d-m-Y' "
                                                         required>
                                                        
                                                </span>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-xl-3 col-md-6 col-sm-12 col-12">
                                        <div class="form-group">
                                            <label>Payment Term</label>
                                            <select class="form-control" name="payment_term" id="payment_term">
                                                <option value="{{invoice_data.invoice_payment_terms}}">
                                                    {{invoice_data.invoice_payment_terms}}</option>
                                                <option value="AGAINST PROFORMA INVOICE">AGAINST PROFORMA INVOICE
                                                </option>
                                                <option value="100% ADVANCE">100% ADVANCE</option>
                                                <option value="50% ADVANCE BALANCE AGAINST DELIVERY">50% ADVANCE BALANCE
                                                    AGAINST DELIVERY</option>
                                                <option value="7 DAYS">7 DAYS</option>
                                                <option value="15 DAYS">15 DAYS</option>
                                                <option value="30 DAYS">30 DAYS</option>
                                                <option value="45 DAYS">45 DAYS</option>
                                                <option value="60 DAYS">60 DAYS</option>
                                                <option value="90 DAYS">90 DAYS</option>
                                                <option value="120 DAYS">120 DAYS</option>
                                                <option value="AGAINST TAX INVOICE">AGAINST TAX INVOICE</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-xl-3 col-md-6 col-sm-12 col-12">
                                        <div class="form-group">
                                            <label>Customer Name</label>
                                            <select name="customer_id_select" class="form-control" id="customer_id_select">
                                                <option value="{{ invoice_data.invoice_customer.id }}">{{ invoice_data.invoice_customer.customer }}</option>
                                               
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-xl-3 col-md-6 col-sm-12 col-12">
                                        <div class="form-group">
                                            <input type="hidden" id="customer_id" name="customer_id" value="{{customer_name.id}}">
                                            <label for="customer_Name">Customer Name From DC</label>
                                            <input list="customer_Name_list" id="customer_Name" name="customer_Name" class="form-control" placeholder="Select Lead"  value="{{invoice_data.invoice_customer_name.dc_customer_name.customer }}" >
                                            <datalist id="customer_Name_list">
                                                {% for lead in dc_list %}
                                                <option value="{{ lead.dc_customer_name.customer}}" 
                                                data-id="{{ lead.id }}" 
                                                data-contact_person="{{ lead.dc_customer_name.customer}}"
                                                data-dc_destination="{{ lead.dc_destination }}"
                                                data-dc_number="{{ lead.dc_number }}"
                                               >{{ lead.customer }} {{ lead.dc_number }}</option>
                                                {% endfor %}
                                            </datalist>
                                        </div>
                                    </div>

                                    <div class="col-xl-3 col-md-6 col-sm-12 col-12">
                                        <div class="form-group">
                                            <label>Contact Person Name.</label>
                                            <input type="text" class="form-control" name="contact_person_name" id="contact_person_name" value="{{invoice_data.invoice_customer_name.dc_customer_name.customer}}">
                                        </div>
                                    </div>
                                    

                                    <div class="col-xl-3 col-md-6 col-sm-12 col-12" hidden>
                                        <div class="form-group">
                                            <div class=" ">
                                                <span>
                                                    <label>Due Date<span class="text-danger">*</span></label>
                                                    <input class="form-control datetimepicker" type="text"
                                                        name="due_date" id="due_date"
                                                        value="{{invoice_data.invoice_due_date}} | date  'Y-m-d' "
                                                        placeholder="Date" required>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- <div class="col-xl-3 col-md-6 col-sm-12 col-12">
                                                <div class="form-group">
                                                    <label>Invoice No.</label>
                                                    <select class="form-control" name="invoice_no" id="invoice_no">
                                                        <option value="">12521</option>
                                                        <option value="">12521</option>
                                                        <option value="">12521</option>
                                                    </select>
                                                </div>
                                            </div> -->

                                    <div class="col-xl-3 col-md-6 col-sm-12 col-12">
                                        <div class="form-group">
                                            <label>Eway Bill No.</label>
                                            <input type="text" class="form-control" name="ewaybill_no" id="ewaybill_no"
                                                value="{{invoice_data.invoice_eway_bill_no}}">
                                        </div>
                                    </div>
                                    <div class="col-xl-3 col-md-6 col-sm-12 col-12">
                                        <div class="form-group">
                                            <label>Delivery Challan No. <span class="text-danger">*</span></label>
                                            <input type="text" class="form-control" name="order_no" id="order_no"
                                                value="{{invoice_data.invoice_delivery_no}}" >
                                        </div>
                                    </div>
                                    <div class="col-xl-3 col-md-6 col-sm-12 col-12">
                                        <div class="form-group">
                                            <label >Source of Supply</label>
                                            <select class="form-control" name="place_of_supply" id="place_of_supply"
                                            onchange="totaltaxamt();">
                                                    <option value="ANDAMAN AND NICOBAR ISLANDS">ANDAMAN AND NICOBAR ISLANDS</option>

                                                    <option value="ANDHRA PRADESH (BEFORE DIVISION)">ANDHRA PRADESH (BEFORE DIVISION)</option>
                                                    
                                                    <option value="ANDHRA PRADESH (NEW)">ANDHRA PRADESH (NEW)</option>
                                                    
                                                    <option value="ARUNACHAL PRADESH">ARUNACHAL PRADESH</option>
                                                    
                                                    <option value="ASSAM">ASSAM</option>
                                                    
                                                    <option value="BIHAR">BIHAR</option>
                                                    
                                                    <option value="CHANDIGARH">CHANDIGARH</option>
                                                    
                                                    <option value="CHHATTISGARH">CHHATTISGARH</option>
                                                    
                                                    <option value="DADRA AND NAGAR HAVELI AND DAMAN AND DIU">DADRA AND NAGAR HAVELI AND DAMAN AND DIU</option>
                                                    
                                                    <option value="DAMAN AND DIU">DAMAN AND DIU</option>
                                                    
                                                    <option value="DELHI">DELHI</option>
                                                    
                                                    <option value="GOA">GOA</option>
                                                    
                                                    <option value="GUJARAT">GUJARAT</option>
                                                    
                                                    <option value="HARYANA">HARYANA</option>
                                                    
                                                    <option value="HIMACHAL PRADESH">HIMACHAL PRADESH</option>
                                                    
                                                    <option value="JAMMU AND KASHMIR">JAMMU AND KASHMIR</option>
                                                    
                                                    <option value="JHARKHAND">JHARKHAND</option>
                                                    
                                                    <option value="KARNATAKA">KARNATAKA</option>
                                                    
                                                    <option value="KERALA">KERALA</option>
                                                    
                                                    <option value="LADAKH">LADAKH</option>
                                                    
                                                    <option value="LAKSHADWEEP">LAKSHADWEEP</option>
                                                    
                                                    <option value="MADHYA PRADESH">MADHYA PRADESH</option>
                                                    
                                                    <option value="MAHARASHTRA">MAHARASHTRA</option>
                                                    
                                                    <option value="MANIPUR">MANIPUR</option>
                                                    
                                                    <option value="MEGHALAYA">MEGHALAYA</option>
                                                    
                                                    <option value="MIZORAM">MIZORAM</option>
                                                    
                                                    <option value="NAGALAND">NAGALAND</option>
                                                    
                                                    <option value="ODISHA">ODISHA</option>
                                                    
                                                    <option value="OTHER TERRITORY">OTHER TERRITORY</option>
                                                    
                                                    <option value="PUDUCHERRY">PUDUCHERRY</option>
                                                    
                                                    <option value="PUNJAB">PUNJAB</option>
                                                    
                                                    <option value="RAJASTHAN">RAJASTHAN</option>
                                                    
                                                    <option value="SIKKIM">SIKKIM</option>
                                                    
                                                    <option value="TAMIL NADU">TAMIL NADU</option>
                                                    
                                                    <option value="TELANGANA">TELANGANA</option>
                                                    
                                                    <option value="TRIPURA">TRIPURA</option>
                                                    
                                                    <option value="UTTAR PRADESH">UTTAR PRADESH</option>
                                                    
                                                    <option value="UTTARAKHAND">UTTARAKHAND</option>
                                                    
                                                    <option value="WEST BENGAL">WEST BENGAL</option>
                                                    
                                            </select>
                                        </div>
                                    </div>
 <div class="col-xl-3 col-md-6 col-sm-12 col-12">
                                        <div class="form-group">
                                            <label>Destination</label>
                                            <input type="text" class="form-control" name="destination" id="destination"
                                                value="{{invoice_data.invoice_destination}}">
                                        </div>
                                    </div>

                                    <div class="col-xl-3 col-md-6 col-sm-12 col-12">
                                        <div class="form-group">
                                            <label>Landing LR-RRNo</label>
                                            <input type="text" class="form-control" name="lrno" id="lrno"
                                                value="{{invoice_data.invoice_landing_LR_RR_No}}">
                                        </div>
                                    </div>

                                    <div class="col-xl-3 col-md-6 col-sm-12 col-12">
                                        <div class="form-group">
                                            <label >Dispatch Through <span class="text-danger">*</span></label>
                                            <div>
                                                <select class="form-control" required name="transporter_name"
                                                    id="transporter_name">
                                                    <option value="{{invoice_data.invoice_dispatch.id}}">
                                                        {{invoice_data.invoice_dispatch.name}}</option>
                                                    {% for i in all_dispatch_through %}
                                                    <option value="{{i.id}}">{{i.name}}</option>
                                                    {% endfor %}

                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- <div class="col-xl-3 col-md-6 col-sm-12 col-12">
                                        <div class="form-group">
                                            <label>Dispatch Document No</label>
                                            <input type="text" class="form-control" name="inv_Dispatch_document_no" id="inv_Dispatch_document_no"
                                                value="{{invoice_data.inv_Dispatch_document_no}}">
                                        </div>
                                    </div> -->

                                    <div class="col-xl-3 col-md-6 col-sm-12 col-12">
                                        <div class="form-group">
                                            <label>Sales Person</label>
                                            <input type="text" class="form-control" name="sales_person"
                                                id="sales_person" value="{{invoice_data.invoice_sales_person}}">
                                        </div>
                                    </div>

                                    <!-- <div class="col-xl-3 col-md-6 col-sm-12 col-12">
                                        <div class="form-group">
                                            <label style="color:black">Invoice Format Type</label>
                                            <div>
                                                <select class="form-control" name="invoice_format" id="invoice_format">
                                                    <option value="{{invoice_data.invoice_format_type}}">
                                                        {{invoice_data.invoice_format_type}}</option>
                                                    <option value="TRIPLICATE FOR SUPPLIER">TRIPLICATE FOR SUPPLIER
                                                    </option>

                                                    <option value="DUPLICATE FOR TRANSPORTER">DUPLICATE FOR TRANSPORTER
                                                    </option>

                                                    <option value="ORIGINAL FOR RECIPIENT">ORIGINAL FOR RECIPIENT
                                                    </option>

                                                </select>
                                            </div>
                                        </div>
                                    </div> -->

                                    <div class="col-xl-3 col-md-6 col-sm-12 col-12">
                                        <div class="form-group">
                                            <label>Buyer Order No.</label>
                                            <input type="text" class="form-control" name="buyer_order_no"
                                                id="buyer_order_no" value="{{invoice_data.invoice_buyer_order_no}}">
                                        </div>
                                    </div>

                                    <div class="col-xl-3 col-md-6 col-sm-12 col-12">
                                        <div class="form-group">
                                            <label>Buyer Order Date <span class="text-danger">*</span> </label>
                                            <input type="text" class="form-control datetimepicker"
                                                name="buyer_order_date" id="buyer_order_date"
                                                value="{{invoice_data.invoice_buyer_order_date}} | 'Y-m-d'   " required>
                                        </div>
                                    </div>

                                    <div class="col-xl-3 col-md-6 col-sm-12 col-12">
                                        <div class="form-group">
                                            <label>Vehicle No.</label>
                                            <input type="text" class="form-control" name="vehicle_no" id="vehicle_no"
                                                value="{{invoice_data.invoice_vehicle_no}}">
                                        </div>
                                    </div>

                                    <div class="col-xl-3 col-md-6 col-sm-12 col-12">
                                        <div class="form-group">
                                            <label>GST No.</label>
                                            <input type="text" class="form-control" name="gst_no" id="gst_no_input"
                                                value="{{invoice_data.invoice_gst_no}}">
                                            <span id="gstError" style="color: red;"></span>

                                        </div>
                                    </div>

                                   

                                    <!-- <div class="col-xl-3 col-md-6 col-sm-12 col-12">
                                        <div class="form-group">
                                            <label>Term of Delivery <span class="text-danger">*</span></label>
                                            <select class="form-control" name="delivery_term" id="delivery_term" required>
                                                <option value="{{invoice_data.invoice_term_of_delivery}}" >
                                                    {{invoice_data.invoice_term_of_delivery}} </option>
                                                <option value="PAID">PAID</option>

                                                <option value="TO PAY">TO PAY</option>

                                                <option value="DOOR DELIVERY">DOOR DELIVERY</option>

                                                <option value="SELF COLLECTION">SELF COLLECTION</option>
                                                <option value="INVOICE FORMAT TYPE">INVOICE FORMAT TYPE</option>

                                            </select>
                                        </div>
                                    </div> -->

                                    

                                   

                                    <div class="col-xl-3 col-md-6 col-sm-12 col-12">
                                        <div class="form-group">
                                            <label for="shipping_address_dropdown">Shipping Address</label>
                                            <select class="form-control" name="shipping_address"
                                                id="shipping_address_dropdown">
                                                <option value="{{invoice_data.invoice_shipping_address}}" selected>{{invoice_data.invoice_shipping_address}}</option>
                                                <option value="">Select Shipping Address</option>
                                                <option value="{{invoice_data.invoice_customer_name.dc_customer_name.shipping_1_attention}},{{invoice_data.invoice_customer_name.dc_customer_name.shipping_1_street}},{{invoice_data.invoice_customer_name.dc_customer_name.shipping_1_city}},{{invoice_data.invoice_customer_name.dc_customer_name.shipping_1_state}},{{invoice_data.invoice_customer_name.dc_customer_name.shipping_1_pincode}}" >{{invoice_data.invoice_customer_name.dc_customer_name.shipping_1_attention}},{{invoice_data.invoice_customer_name.dc_customer_name.shipping_1_street}},{{invoice_data.invoice_customer_name.dc_customer_name.shipping_1_city}},{{invoice_data.invoice_customer_name.dc_customer_name.shipping_1_state}},{{invoice_data.invoice_customer_name.dc_customer_name.shipping_1_pincode}}</option>
                                                <option value="{{invoice_data.invoice_customer_name.dc_customer_name.shipping_2_attention}},{{invoice_data.invoice_customer_name.dc_customer_name.shipping_2_street}},{{invoice_data.invoice_customer_name.dc_customer_name.shipping_2_city}},{{invoice_data.invoice_customer_name.dc_customer_name.shipping_2_state}},{{invoice_data.invoice_customer_name.dc_customer_name.shipping_2_pincode}}" >{{invoice_data.invoice_customer_name.dc_customer_name.shipping_2_attention}},{{invoice_data.invoice_customer_name.dc_customer_name.shipping_2_street}},{{invoice_data.invoice_customer_name.dc_customer_name.shipping_2_city}},{{invoice_data.invoice_customer_name.dc_customer_name.shipping_2_state}},{{invoice_data.invoice_customer_name.dc_customer_name.shipping_2_pincode}}</option>

                                            </select>
                                        </div>
                                    </div>

                                    

                                    
                                    <div class="col-xl-3 col-md-6 col-sm-12 col-12">
                                        <div class="form-group">
                                            <label>Freight(Amount)</label>
                                            <input type="text" class="form-control " name="freight_amount" id="freight_amount"  value="{{invoice_data.cn_freight_amount}}" pattern="\d*" oninput="this.value = this.value.replace(/[^0-9]/g, '');">
                                        </div>
                                    </div>
                                    <div class="col-xl-3 col-md-6 col-sm-12 col-12">
                                        <div class="form-group">
                                            <label>Freight(Percentage)</label>
                                            <input type="text" class="form-control " name="freight_percentage" id="freight_percentage"  value="{{invoice_data.cn_freight_percentage}}" pattern="\d*" oninput="this.value = this.value.replace(/[^0-9]/g, '');">
                                        </div>
                                    </div>

                                    <div class="col-xl-3 col-md-6 col-sm-12 col-12">
                                        <div class="form-group">
                                            <label>Packaging &amp; Forwading (Amount)</label>
                                            <input type="text" class="form-control " name="packaging_forwording_amount" id="packaging_forwording_amount"  value="{{invoice_data.cn_packaging_forwording_amount}}" pattern="\d*" oninput="this.value = this.value.replace(/[^0-9]/g, '');">
                                        </div>
                                    </div>
                                    <div class="col-xl-3 col-md-6 col-sm-12 col-12">
                                        <div class="form-group">
                                            <label>Packaging &amp; Forwading (Percentage)</label>
                                            <input type="text" class="form-control" name="packaging_forwording_percentage" id="packaging_forwording_percentage"  value="{{invoice_data.cn_packaging_forwording_percentage}}" pattern="\d*" oninput="this.value = this.value.replace(/[^0-9]/g, '');">
                                        </div>
                                    </div>

                            
                            
                            

                            

                                    <!-- <div class="col-md-3 ">
                                        <div class="form-group">
                                           <label>GST</label>
                                           <div>
                                              <select class="form-control" name="gst_option" id="gst_option" onchange="updateTaxFields();">
                                                 <option value="{{invoice_data.gst_option}}">{{invoice_data.gst_option}}</option>

                                                 
                                              </select>
                                           </div>
                                        </div>
                                     </div> -->
                                     <div class="col-md-3 ">
                                        <div class="form-group">
                                           <label>GST <span class="text-danger">*</span></label>
                                           <div>
                                              <select class="form-control" name="gst_option" id="gst_option" onchange="updateTaxFields();calculateTotalTaxAmount();">
                                                 <option value=""hidden>Select GST</option>
                                                 <option value="Interstate" {% if invoice_data.gst_option == "Interstate" %}selected{% endif %}>Interstate</option>
                                                 <option value="Intrastate" {% if invoice_data.gst_option == "Intrastate" %}selected{% endif %}>Intrastate</option>
                                               
                                              </select>
                                           </div>
                                        </div>
                                     </div>


                                    <div class="col-lg-2" style="visibility: hidden;">
                                        <div class="form-group">
                                            <label>Item Rates Are </label>
                                            <select class="form-control" name="item_rate" id="item_rate">
                                                <option value="{{invoice_data.item_rate}}">{{invoice_data.item_rate}}
                                                </option>

                                                <option value="tax_exclusive">Tax Exclusive</option>
                                                <option value="tax_inclusive">Tax Inclusive </option>
                                            </select>
                                        </div>
                                    </div>


                                    <div class="rowbb">
                                        <div class="invoice-add-table">
                                            <div class="table-responsive">
                                                <table class="table table-center add-table-items">
                                                    <thead>
                                                        <tr>
                                                            <th></th>
                                                            <th style="padding-left: 30px;">Item Code</th>
                                                            <th width="180px">Description of Goods</th>
                                                            <!-- <th>Godown</th> -->
                                                            <th>HSN</th>
                                                            <th>Qty</th>
                                                            <th>UOM</th>
                                                            <th>Unit Price</th>
                                                            <th>Disc(%)</th>
                                                            <th>Tax Rate</th>
                                                            <th>Tax Amt</th>
                                                            <th>Total</th>
                                                            <th>Actions</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {% for j in invoice_item_data %}
                                                        <tr class="add-row">
                                                            <td><input type="hidden" name="iid[]" class="iid"
                                                                    value="{{len_invoice_item}}">
                                                            </td>

                                                            <td><input type="text" style="width: 120px;" class="form-control"
                                                                    name="itemcode_{{ forloop.counter }}"
                                                                    id="itemcode_{{ forloop.counter }}"
                                                                    value="{{j.invoice_item_code}}"
                                                                    onkeyup="getitemscodedetails('itemcode_{{ forloop.counter }}','item_{{ forloop.counter }}','godown_{{ forloop.counter }}','qty_{{ forloop.counter }}','rate_{{ forloop.counter }}','hsn_{{ forloop.counter }}', 'sac_{{ forloop.counter }}','uom_{{ forloop.counter }}','discount_{{ forloop.counter }}','taxrate_{{ forloop.counter }}');" >
                                                            </td>

                                                            <td><input type="text" class="form-control"
                                                                    name="item_{{ forloop.counter }}"
                                                                    id="item_{{ forloop.counter }}"
                                                                    onkeyup="getitemsdetails('item_{{ forloop.counter }}','godown_{{ forloop.counter }}','qty_{{ forloop.counter }}','rate_{{ forloop.counter }}','hsn_{{ forloop.counter }}', 'sac_{{ forloop.counter }}', 'uom_{{ forloop.counter }}','discount_{{ forloop.counter }}','taxrate_{{ forloop.counter }}','itemcode_{{ forloop.counter }}');"
                                                                    value="{{j.invoice_description_goods}}"
                                                                    placeholder=" " > </td>

                                                            <!-- <td><input type="text" class="form-control" name="godown_{{ forloop.counter }}" id="godown_{{ forloop.counter }}" value=""></td> -->

                                                            <!-- <td width="150">
                                                                <select class="form-select"
                                                                    name="godown_{{ forloop.counter }}"
                                                                    id="godown_{{ forloop.counter }}">
                                                                    <option value="{{j.invoice_godown}}">
                                                                        {{j.invoice_godown}}</option>
                                                                    <option value="3">5th floor</option>
                                                                    <option value="2">Ankush Godown</option>
                                                                    <option value="1">TURBHE</option>
                                                                </select>
                                                            </td> -->

                                                            <td><input type="text" class="form-control"
                                                                    name="hsn_{{ forloop.counter }}"
                                                                    id="hsn_{{ forloop.counter }}"
                                                                    value="{{j.invoice_hsn}}" ></td>

                                                           

                                                            <td><input type="text" class="form-control"
                                                                    name="qty_{{ forloop.counter }}"
                                                                    id="qty_{{ forloop.counter }}"
                                                                    value="{{j.invoice_qantity}}"
                                                                    onkeyup="taxrate('qty_{{ forloop.counter }}')"> </td>

                                                            <td><input type="text" class="form-control"
                                                                    name="uom_{{ forloop.counter }}"
                                                                    id="uom_{{ forloop.counter }}"
                                                                    value="{{j.invoice_uom}}" ></td>

                                                            <td><input type="text" class="form-control"
                                                                    name="rate_{{ forloop.counter }}"
                                                                    id="rate_{{ forloop.counter }}"
                                                                    value="{{j.invoice_unit_price}}"
                                                                    onkeyup="taxrate('rate_{{ forloop.counter }}')"></td>

                                                            <td><input type="text" class="form-control"
                                                                    name="discount_{{ forloop.counter }}"
                                                                    id="discount_{{ forloop.counter }}"
                                                                    value="{{j.invoice_discount}}"
                                                                    onkeyup="discountamt('discount_{{ forloop.counter }}')">
                                                            </td>

                                                            <td><input type="number"
                                                                    class="form-control taxrate_{{ forloop.counter }}"
                                                                    name="taxrate_{{ forloop.counter }}"
                                                                    id="taxrate_{{ forloop.counter }}"
                                                                    value="{{j.invoice_tax_rate}}"
                                                                    onkeyup="taxrate('taxrate_{{ forloop.counter }}')" required>
                                                            </td>
                                                            <td><input type="text" class="form-control taxamt"
                                                                    name="taxamt_{{ forloop.counter }}"
                                                                    id="taxamt_{{ forloop.counter }}"
                                                                    value="{{j.invoice_tax_amount}}" readonly>
                                                            </td>
                                                            <td><input type="text" class="form-control totalamt"
                                                                    name="total_{{ forloop.counter }}"
                                                                    id="total_{{ forloop.counter }}"
                                                                    value="{{j.invoice_total}}" readonly>
                                                            </td>

                                                            <td class="add-remove text-end">
                                                                <a href="javascript:void(0);" class="add-btn me-2"><i
                                                                        class="fas fa-plus-circle"></i></a>

                                                                <a href="javascript:void(0);" class="remove-btn "><i
                                                                        class="fe fe-trash-2"></i></a>
                                                            </td>
                                                        </tr>
                                                        <input type="hidden" id="i_field" value="{{len_invoice_item}}">
                                                        {% endfor %}
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-lg-7 col-md-6">
                                                <!-- <div class="form-group float-end mb-0"> <button class="btn btn-primary" type="submit">Add Item</button> </div> -->
                                                <div class="invoice-fields">
                                                    <strong class="field-title">Terms and Conditions</strong> 
                                                    <!-- <button type="button" class="btn-right btn btn-sm btn-outline-primary" onclick="enableTextarea()"> edit </button> -->
                                                    <br> <textarea class="form-control" name="note" id='Terms_Condition' style="min-height: 50px;" >{{invoice_data.invoice_note}}</textarea>
                                                </div>
                                            </div>
                                            <div class="col-lg-5 col-md-6">
                                                <div class="invoice-total-card">
                                                    <h4 class="invoice-total-title">Summary</h4>
                                                    <div class="invoice-total-box">
                                                        <div class="invoice-total-inner">

                                                            <div class="total-tax-amt" hidden>
                                                                <label for="total_tax_amount">Total Tax Amount:</label>
                                                                <input type="text" id="total_tax_amount" class="form-control" readonly>
                                                            </div>
                                                           


                                                    <!-- omk -->
                                                    <div class="row">
                                                        <div class="col-lg-6">
                                                            <p>Sub Total </p>
                                                        </div>
                                                        <div class="col-lg-6 ">
                                                            <input type="text" class="subtotal billamt utrt1"
                                                                name="subtotal" id="subtotal" value="{{invoice_data.invoice_sub_total}}"
                                                                readonly="">
                                                        </div>
                                                    </div>



                                                    <div class="row">
                                                        <!-- <div class="col-lg-6"><p>Tax Amt</p></div> -->
                                                        <div class="col-lg-6 ">
                                                            <input type="hidden"
                                                                class="totaltaxamt billamt utrt1"
                                                                name="total_taxamt" id="total_taxamt"
                                                                value="{{invoice_data.invoice_total}}" readonly="">
                                                        </div>
                                                    </div>

                                                    <!-- <div class="row">
                                                                <div class="col-lg-6"><p>Freight</p></div>
                                                                <div class="col-lg-6 ">
                                                                    <input class="billamt utrt1" type="text" name="freight" id="freight" value="0.00" onkeyup=";" >
                                                                </div>
                                                            </div> -->

                                                    <div class="row">
                                                        <!-- <div class="col-lg-6"><p>Tax Amt</p></div> -->
                                                        <div class="col-lg-6 ">
                                                            <input type="hidden"
                                                                class="totaltaxamt billamt utrt1"
                                                                name="total_taxamt" id="total_taxamt"
                                                                value="0.00" readonly="">
                                                        </div>
                                                    </div>

                                                    <div class="row">
                                                        <div class="col-lg-6">
                                                            <p>CGST 
                                                                <!-- @ <input type="text" name="cgstper"
                                                                    id="cgstper" value="{{invoice_data.invoice_cgstper}}" size="1"
                                                                    class="no-outline"> -->
                                                                </p>
                                                        </div>
                                                        <div class="col-lg-6 ">
                                                            <input type="text" class="utrt1 billamt" name="cgst"
                                                                id="cgst" value="{{invoice_data.invoice_cgstval}}" readonly="">
                                                        </div>
                                                    </div>

                                                    <div class="row">
                                                        <div class="col-lg-6">
                                                            <p>SGST
                                                                 <!-- @ <input type="text" name="sgstper"
                                                                    id="sgstper" value="{{invoice_data.invoice_sgstper}}" size="1"
                                                                    class="no-outline"> -->
                                                                </p>
                                                        </div>
                                                        <div class="col-lg-6 ">
                                                            <input type="text" class="utrt1 billamt" name="sgst"
                                                                id="sgst" value="{{invoice_data.invoice_sgstval}}" readonly="">
                                                        </div>
                                                    </div>

                                                    <div class="row">
                                                        <div class="col-lg-6">
                                                            <p>IGST
                                                                
                                                                </p>
                                                        </div>
                                                        <div class="col-lg-6 ">
                                                            <input type="text" class="billamt utrt1" name="igst"
                                                                id="igst" value="{{invoice_data.invoice_igstval}}" readonly="">
                                                        </div>
                                                    </div>

                                                    <div class="row">
                                                        <div class="col-lg-6">
                                                            <p>Adjustments</p>
                                                        </div>
                                                        <div class="col-lg-6 ">
                                                            <input class="billamt utrt1" type="text"
                                                                name="adjustment" id="adjustment" value="0.00"
                                                                onkeyup=";">
                                                        </div>
                                                    </div>

                                                    <div id="pfamtgst" style="display: none;">
                                                    <div class="row">
                                                        <div class="col-lg-6"><p>P&F (Amount) + GST</p></div>
                                                        <div class="col-lg-6 ">
                                                            <input class="billamt utrt1 " name="packaging_forwording_amt_amt" type="text" id="pf_amount" value="{{invoice_data.cn_packaging_forwording_amt_amt}}" >
                                                        </div>
                                                    </div>
                                                    </div>


                                                    <div id="pfpergst" style="display: none;">
                                                    <div class="row">
                                                        <div class="col-lg-6"><p>P&F (Percentage) + GST</p></div>
                                                        <div class="col-lg-6 ">
                                                            <input class="billamt utrt1 " type="text" name="packaging_forwording_percentage_amt" id="pf_percentage" value="{{invoice_data.cn_packaging_forwording_percentage_amt}}" >
                                                        </div>
                                                    </div>
                                                    </div>

                                                    <input type="hidden" id="subtotal" value="100.00"> <!-- Replace with actual subtotal -->
                                                    <div id="freight_amount_gst_row" style="display: none;">
                                                    <div class="row">
                                                        <div class="col-lg-6"><p>Freight (Amount) + GST</p></div>
                                                        <div class="col-lg-6 ">
                                                            <input class="billamt utrt1" type="text" name="freight_amt_amt" id="fr_amount" value="{{invoice_data.cn_freight_percentage_amt_amt}}" >
                                                        </div>
                                                    </div>
                                                    </div>

                                                    <div id="freight_percentage_gst_row" style="display: none;">
                                                    <div class="row">
                                                        <div class="col-lg-6"><p>Freight (Percentage) + GST</p></div>
                                                        <div class="col-lg-6 ">
                                                            <input class="utrt1" type="text" id="fr_percentage" name="freight_percentage_amt"  value="{{invoice_data.cn_freight_percentage_amt}}" >
                                                        </div>
                                                    </div>
                                                    </div>

                                                    <div class="row">
                                                        <div class="col-lg-6">
                                                            <p>TCS on Sale Of any Goods </p>
                                                        </div>
                                                        <div class="col-lg-6 ">
                                                            <input class="billamt utrt1" type="text"
                                                                name="sale_of_good" id="sale_of_good"
                                                                value="0.00" onkeyup=";">
                                                        </div>
                                                    </div>

                                                    <div class="invoice-total-footer">
                                                        <h4>Total Amount <input class="finalamt utrt1"
                                                                type="text" name="totalamt" id="totalamt"
                                                                value="{{invoice_data.invoice_total}}" readonly="">(Rs.)
                                                        </h4>
                                                    </div>
                                                    <div class="invoice-total-footer">
                                                        <h4>Total Amount in Word
                                                            -<input  name="totalamt_word" id="totalamt_word" readonly="" style="width: 370px; border: none;" value="{{invoice_data.invoice_total_amt_word}}"></input>
                                                        </h4>
                                                    </div>

                                                </div>
                                            </div>

                                                    <div class="upload-sign">
                                                        <div class="form-group float-end mb-0"> <a
                                                                href="{% url 'invoice_list'%}"
                                                                class="btn btn-primary">Cancel</a></div>
                                                        <div class="form-group float-end mb-0"> <button
                                                                class="btn btn-primary" type="submit" id="btn_submit"
                                                                name="btn_submit">Save</button>
                                                        </div>
                                                        <!-- <div class="form-group float-end mb-0"> <button
                                                                class="btn btn-primary" type="reset" id="reset"
                                                                name="reset">Reset</button>
                                                        </div> -->
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row col-sm-6 p-5">
                                    <div class="success_message row"></div>
                                </div>
                            </div>
                    </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
</div>

</div>


<script>
    // Enable editing for Invoice No field
    document.getElementById('edit_invoice_no_btn').addEventListener('click', function() {
        const invoiceInput = document.getElementById('invoice_no');
        invoiceInput.removeAttribute('readonly');
        invoiceInput.focus();  // Focus the input for immediate editing
    });

    function validateInvoiceNumber() {
        const invoiceInput = document.getElementById('invoice_no');
        const errorDiv = document.getElementById('invoice_no_error');
        const duplicateErrorDiv = document.getElementById('duplicate_invoice_no_error');

        // Validate the format (MF followed by 2 digits, /PI-, and 3 digits, e.g., MF24/PI-007)
        const invoicePattern = /^MF\d{2}\/PI-\d{3}$/;  // Pattern for MF24/PI-007
        if (!invoicePattern.test(invoiceInput.value)) {
            invoiceInput.setCustomValidity('Invalid format. Invoice number must be in the format MF24/PI-007.');
            errorDiv.style.display = 'block';
        } else {
            invoiceInput.setCustomValidity('');
            errorDiv.style.display = 'none';
        }

        // Check for duplicate if the format is valid
        if (invoicePattern.test(invoiceInput.value)) {
            const originalInvoiceNumber = "{{ invoice_data.pi_number }}";  // Get the original number from the template

            if (invoiceInput.value !== originalInvoiceNumber) {
                checkDuplicateInvoiceNumber(invoiceInput.value)
                    .then(isDuplicate => {
                        if (isDuplicate) {
                            invoiceInput.setCustomValidity('Invoice number already exists.');
                            duplicateErrorDiv.style.display = 'block';
                        } else {
                            invoiceInput.setCustomValidity('');
                            duplicateErrorDiv.style.display = 'none';
                        }
                    });
            } else {
                invoiceInput.setCustomValidity('');  // No error if the number is unchanged
                duplicateErrorDiv.style.display = 'none';
            }
        }
    }

    function checkDuplicateInvoiceNumber(invoice_no) {
        return fetch(`/check_duplicate_performa_invoice_no/?invoice_no=${invoice_no}`)
            .then(response => response.json())
            .then(data => data.is_duplicate);
    }
</script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
     const freightAmount = document.getElementById('freight_amount');
     const freightPercentage = document.getElementById('freight_percentage');
     const packagingAmount = document.getElementById('packaging_forwording_amount');
     const packagingPercentage = document.getElementById('packaging_forwording_percentage');
 
     function toggleReadonlyFields(amountField, percentageField) {
         if (amountField.value !== '0' && amountField.value !== '') {
             percentageField.readOnly = true;
         } else if (percentageField.value !== '0' && percentageField.value !== '') {
             amountField.readOnly = true;
         } else {
             amountField.readOnly = false;
             percentageField.readOnly = false;
         }
     }
 
     // Attach event listeners for Freight fields
     freightAmount.addEventListener('input', function() {
         toggleReadonlyFields(freightAmount, freightPercentage);
     });
     freightPercentage.addEventListener('input', function() {
         toggleReadonlyFields(freightAmount, freightPercentage);
     });
 
     // Attach event listeners for Packaging & Forwarding fields
     packagingAmount.addEventListener('input', function() {
         toggleReadonlyFields(packagingAmount, packagingPercentage);
     });
     packagingPercentage.addEventListener('input', function() {
         toggleReadonlyFields(packagingAmount, packagingPercentage);
     });
 
     // Initial check in case values are pre-filled from the datalist
     toggleReadonlyFields(freightAmount, freightPercentage);
     toggleReadonlyFields(packagingAmount, packagingPercentage);
 });
 
 
 </script>
<script>

    $(document).ready(function() {
        function toggleFreightFields() {
                
                const freightAmount = parseFloat(document.getElementById('freight_amount').value) || 0;
                const freightPercentage = parseFloat(document.getElementById('freight_percentage').value) || 0;
    
                if (freightAmount > 0) {
                    document.getElementById('freight_amount_gst_row').style.display = 'block';
                    document.getElementById('freight_percentage_gst_row').style.display = 'none';
                } else if (freightPercentage > 0) {
                    document.getElementById('freight_amount_gst_row').style.display = 'none';
                    document.getElementById('freight_percentage_gst_row').style.display = 'block';
                } else {
                    document.getElementById('freight_amount_gst_row').style.display = 'none';
                    document.getElementById('freight_percentage_gst_row').style.display = 'none';
                }
            }
        toggleFreightFields();
    });
        
        document.addEventListener('DOMContentLoaded', function() {
            
            function toggleFreightFields() {
                
                const freightAmount = parseFloat(document.getElementById('freight_amount').value) || 0;
                const freightPercentage = parseFloat(document.getElementById('freight_percentage').value) || 0;
    
                if (freightAmount > 0) {
                    document.getElementById('freight_amount_gst_row').style.display = 'block';
                    document.getElementById('freight_percentage_gst_row').style.display = 'none';
                } else if (freightPercentage > 0) {
                    document.getElementById('freight_amount_gst_row').style.display = 'none';
                    document.getElementById('freight_percentage_gst_row').style.display = 'block';
                } else {
                    document.getElementById('freight_amount_gst_row').style.display = 'none';
                    document.getElementById('freight_percentage_gst_row').style.display = 'none';
                }
            }
    
            document.getElementById('freight_amount').addEventListener('input', toggleFreightFields);
            document.getElementById('freight_percentage').addEventListener('input', toggleFreightFields);
            // document.getElementById('customer_Name').addEventListener('input', togglePfFields);
    
            toggleFreightFields(); // Initialize the state q_freight_percentage_amt_amton page load
    
            function togglePfFields() {
                const pfAmount = parseFloat(document.getElementById('packaging_forwording_amount').value) || 0;
                const pfPercentage = parseFloat(document.getElementById('packaging_forwording_percentage').value) || 0;
    
                if (pfAmount > 0) {
                    document.getElementById('pfamtgst').style.display = 'block';
                    document.getElementById('pfpergst').style.display = 'none';
                } else if (pfPercentage > 0) {
                    document.getElementById('pfamtgst').style.display = 'none';
                    document.getElementById('pfpergst').style.display = 'block';
                } else {
                    document.getElementById('pfamtgst').style.display = 'none';
                    document.getElementById('pfpergst').style.display = 'none';
                }
            }
    
            
            document.getElementById('packaging_forwording_amount').addEventListener('input', togglePfFields);
            document.getElementById('packaging_forwording_percentage').addEventListener('input', togglePfFields);
            // document.getElementById('customer_Name').addEventListener('input', togglePfFields);
    
            togglePfFields();
    
            
    
            
        });
    </script>
    

<script>
    $(document).ready(function() {
        // Hide fields initially
        $("#pf_amount_row").hide();
        $("#pf_percentage_row").hide();
        $("#fr_amount_row").hide();
        $("#fr_percentage_row").hide();
    
        // Show or hide P&F amount field
        $("#packaging_forwording_amount").on("input", function() {
            if ($(this).val() != "0" && $(this).val() != "") {
                $("#pf_amount_row").show();
            } else {
                $("#pf_amount_row").hide();
            }
        });
    
        // Show or hide P&F percentage field
        $("#packaging_forwording_percentage").on("input", function() {
            if ($(this).val() != "0" && $(this).val() != "") {
                $("#pf_percentage_row").show();
            } else {
                $("#pf_percentage_row").hide();
            }
        });
    
        // Show or hide Freight amount field
        $("#freight_amount").on("input", function() {
            if ($(this).val() != "0" && $(this).val() != "") {
                $("#fr_amount_row").show();
            } else {
                $("#fr_amount_row").hide();
            }
        });
    
        // Show or hide Freight percentage field
        $("#freight_percentage").on("input", function() {
            if ($(this).val() != "0" && $(this).val() != "") {
                $("#fr_percentage_row").show();
            } else {
                $("#fr_percentage_row").hide();
            }
        });
    });
    </script>


<script>
    document.addEventListener('DOMContentLoaded', function () {
        const freightAmount = document.getElementById('freight_amount');
        const freightPercentage = document.getElementById('freight_percentage');
        const packagingAmount = document.getElementById('packaging_forwording_amount');
        const packagingPercentage = document.getElementById('packaging_forwording_percentage');

        function toggleFreightInputs() {
            if (freightAmount.value !== "0" && freightAmount.value !== "") {
                freightPercentage.value = "0";
                freightPercentage.disabled = true;
            } else {
                freightPercentage.disabled = false;
            }
        }

        function toggleFreightPercentage() {
            if (freightPercentage.value !== "0" && freightPercentage.value !== "") {
                freightAmount.value = "0";
                freightAmount.disabled = true;
            } else {
                freightAmount.disabled = false;
            }
        }

        function togglePackagingInputs() {
            if (packagingAmount.value !== "0" && packagingAmount.value !== "") {
                packagingPercentage.value = "0";
                packagingPercentage.disabled = true;
            } else {
                packagingPercentage.disabled = false;
            }
        }

        function togglePackagingPercentage() {
            if (packagingPercentage.value !== "0" && packagingPercentage.value !== "") {
                packagingAmount.value = "0";
                packagingAmount.disabled = true;
            } else {
                packagingAmount.disabled = false;
            }
        }

        freightAmount.addEventListener('input', toggleFreightInputs);
        freightPercentage.addEventListener('input', toggleFreightPercentage);
        packagingAmount.addEventListener('input', togglePackagingInputs);
        packagingPercentage.addEventListener('input', togglePackagingPercentage);
    });
</script>


<script>
    function updatePFPercentage() {
        var subtotal = parseFloat(document.getElementById('subtotal').value); // Assuming subtotal field exists
        var percentage = parseFloat(document.getElementById('packaging_forwording_percentage').value);
        var pfAmount2 = (subtotal * percentage) / 100;

        var gstAmountpf2 = (pfAmount2 * 0.18).toFixed(2);
        var pfAmount = (pfAmount2 + parseFloat(gstAmountpf2)).toFixed(2);
        document.getElementById('pf_percentage').value = pfAmount;
        updateTotalInWords();

    }

    document.addEventListener('DOMContentLoaded', (event) => {
        document.getElementById('packaging_forwording_percentage').addEventListener('input', updatePFPercentage);
    });

    function updateFreightPercentage() {
        var subtotals = parseFloat(document.getElementById('subtotal').value); // Assuming subtotal field exists
        var fr_percentage = parseFloat(document.getElementById('freight_percentage').value);
        var f_Percentage3 = (subtotals * fr_percentage) / 100;

        var gstAmountpf3 = (f_Percentage3 * 0.18).toFixed(2);
        var f_Percentage = (f_Percentage3 + parseFloat(gstAmountpf3)).toFixed(2);

        document.getElementById('fr_percentage').value = f_Percentage;
        updateTotalInWords();

    }

    document.addEventListener('DOMContentLoaded', (event) => {
        document.getElementById('freight_percentage').addEventListener('input', updateFreightPercentage);
    });
</script>

<script>
    function updatePFAmount() {
        var pfAmount1 = parseFloat(document.getElementById('packaging_forwording_amount').value);
        var gstAmountpf = (pfAmount1 * 0.18).toFixed(2);
        var pfAmount = (pfAmount1 + parseFloat(gstAmountpf)).toFixed(2);
        document.getElementById('pf_amount').value = pfAmount;
        updateTotalInWords();

        
    }

    document.addEventListener('DOMContentLoaded', (event) => {
        document.getElementById('packaging_forwording_amount').addEventListener('input', updatePFAmount);

        
    });
    // function updateFreightAmount() {
    //     var fr_Amount = document.getElementById('freight_amount').value;
    //     var gstAmount = fr_Amount * 0.18;
    //     var totall = fr_Amount + gstAmount;
    //     document.getElementById('fr_amount').value = totall;
    //     updateTotalInWords();

    // }

    function updateFreightAmount() {
    var fr_Amount = parseFloat(document.getElementById('freight_amount').value);
    var gstAmount = (fr_Amount * 0.18).toFixed(2);
    var totall = (fr_Amount + parseFloat(gstAmount)).toFixed(2);
    document.getElementById('fr_amount').value = totall;
    updateTotalInWords();
    }

    // function updateFreightAmount() {
    //     var fr_Amount = document.getElementById('freight_amount').value;
    //     var gstAmount = fr_Amount * 0.18;
    //     var gstAmount = pfAmount * 0.18;
    //     document.getElementById('pf_amount').value = (pfAmount + gstAmount).toFixed(2);
    //     updateTotalInWords();

    // }

    document.addEventListener('DOMContentLoaded', (event) => {
        document.getElementById('freight_amount').addEventListener('input', updateFreightAmount);

        
    });
    
</script>
<script>
     function calculateTotalTaxAmount() {
        let totalTaxAmount = 0;
        $(".taxamt").each(function() {
            let taxAmt = parseFloat($(this).val());
            if (!isNaN(taxAmt)) {
                totalTaxAmount += taxAmt;
            }
        });
        $("#total_tax_amount").val(totalTaxAmount.toFixed(2));
        updateTaxFields();
}
</script>

<script type="text/javascript">
    $(document).ready(function () {
    i_field = $('#i_field').val();
    var max_fields = 500;
    var i = i_field;
    var x = 1;
    $(".add-table-items").on('click', '.remove-btn', function () {
        $(this).closest('.add-row').remove();
        
        subtotal();

        calculateTotalTaxAmount();
        $(document).ready(function() {
            subtotal();
        });
        // 
        updateTotalInWords();

        return false;
    });

   

    // var i = 1;
    $(document).on("click", ".add-btn", function () {
        if (x < max_fields) {
        i++;
        x++;
        var experiencecontent = '<tr class="add-row">' +
            ' <td>' +
            '<input type="hidden" name="iid[]" class="iid" value="' + i + '">' +
            '</td>'+
            '<td>' +
            '<input type="text" style="width: 120px;" class="form-control" name="itemcode_' + i + '" id="itemcode_' + i + '" onkeyup="getitemscodedetails(\'itemcode_' + i + '\',\'item_' + i + '\',\'description_' + i + '\',\'godown_' + i + '\',\'qty_' + i + '\',\'rate_' + i + '\',\'uom_' + i + '\',\'discount_' + i + '\',\'taxrate_' + i + '\',\'hsn_' + i + '\'); " onfocus="updateTotalInWords();" required>' +
            '</td>' +

            '<td>' +
            '<input type="text" name="item_' + i + '" id="item_' + i + '" class="form-control" onkeyup="getitemsdetails(\'item_' + i + '\',\'description_' + i + '\',\'godown_' + i + '\',\'qty_' + i + '\',\'rate_' + i + '\',\'uom_' + i + '\',\'discount_' + i + '\',\'taxrate_' + i + '\',\'hsn_' + i + '\',\'itemcode_' + i + '\'); " >' +
            '</td>' +

            '<td>' +
            '<input type="text" name="hsn_' + i + '" id="hsn_' + i + '" class="form-control" >' +
            '</td>' +

            '<td>' +
            '<input type="text" class="form-control" name="qty_' + i + '" id="qty_' + i + '" onkeyup="taxrate(\'qty_' + i + '\');" >' +
            '</td>' +

            '<td>' +
            '<input type="text" class="form-control" name="uom_' + i + '" id="uom_' + i + '" >' +
            '</td>' +

            '<td>' +
            '<input type="text" class="form-control" name="rate_' + i + '" id="rate_' + i + '" onkeyup="rate(\'rate_' + i + '\');" readonly>' +
            '</td>' +

            '<td>' +
            '<input type="text" class="form-control" name="discount_' + i + '" id="discount_' + i + '" onkeyup="discountamt(\'discount_' + i + '\');" >' +
            '</td>' +

            '<td>' +
            '<input type="number" class="form-control taxrate_0" name="taxrate_' + i + '" id="taxrate_' + i + '" onkeyup="taxrate(\'taxrate_' + i + '\');" required>' +
            '</td>' +

            '<td>' +
            '<input type="text" class="form-control taxamt" name="taxamt_' + i + '" id="taxamt_' + i + '" readonly>' +
            '</td>' +

            '<td>' +
            '<input type="text" class="form-control totalamt" name="total_' + i + '" id="total_' + i + '" readonly>' +
            '</td>' +

            '<td class="add-remove text-end">' +
            '<a href="javascript:void(0);" class="add-btn me-2"><i class="fas fa-plus-circle"></i></a> ' +
            '<a href="javascript:void(0);" class="remove-btn"><i class="fe fe-trash-2"></i></a>' +
            '</td>' +
            '</tr>';
        }
        $(".add-table-items").append(experiencecontent);
        return false;
    });
});
</script>

<script type="text/javascript">
    function getitemsdetails(inputname, description, godown, qty, rate, uom, discount, taxrate, hsn, itemcode) {
        //alert();return;
        input = inputname.split("_");
        //alert(input);return;

        $('#' + inputname).autocomplete({
            source: function (request, response) {
                $.ajax({
                    url: '#',
                    dataType: "json",
                    type: "POST",
                    data: {
                        name_startsWith: request.term,
                        itemsdetails: input
                    },
                    success: function (data) {
                        response($.map(data, function (item) {
                            var code = item.split("|");
                            //alert(data);
                            return {
                                label: code[0],
                                value: code[0],
                                data: item
                            }
                        }));
                    }
                });
            },
            autoFocus: true,
            minLength: 0,
            change: function (event, ui) {
                if (ui.item == null) {
                }
            },
            select: function (event, ui) {
                var names = ui.item.data.split("|");
                console.log(names)
                $('#' + inputname).val(names[0]);
                $('#' + description).val(names[1]);
                $('#' + godown).val(names[2]);
                //$('#'+qty).val(names[3]);
                $('#' + qty).val('1');
                $('#' + rate).val(names[5]);
                $('#' + uom).val(names[10]);
                $('#' + discount).val(names[4]);
                $('#' + taxrate).val(names[7]);
                $('#' + hsn).val(names[2]);
                $('#' + item).val(names[1]);
                $('#' + itemcode).val(names[11]);

                calculateTotalTaxAmount();
                updateTaxFields();
                discountamt(inputname);

                subtotal();
                calculatePFPercentage();
                calculateFreightPercentage()

                

                
                updateTotalInWords();
                updatePFAmount();
                updateFreightPercentage();
                updatePFPercentage();
            }

        });
    }

    function getitemscodedetails(inputname, item, description, godown, qty, rate, uom, discount, taxrate, hsn) {
        //alert();return;
        input = inputname.split("_");
        //alert(input);return;
        
        $('#' + inputname).autocomplete({
            source: function (request, response) {
                $.ajax({
                    url: '/getitemscodedetails/',
                    dataType: "json",
                    type: "POST",
                    data: {
                        name_startsWith: request.term,
                        itemsdetails: input
                    },
                    success: function (data) {
                        response($.map(data, function (item) {
                            var code = item.split("|");
                            //alert(data);
                            return {
                                label: code[0],
                                value: code[0],
                                data: item
                            }
                        }));
                    }
                });
            },
            autoFocus: true,
            minLength: 0,
            change: function (event, ui) {
                if (ui.item == null) {
                }
            },
            
            
            select: function (event, ui) {
                var names = ui.item.data.split("|");
                console.log("Mangesh",names)
                $('#' + inputname).val(names[0]);
                $('#' + description).val(names[1]);
                $('#' + godown).val(names[2]);
                //$('#'+qty).val(names[3]);
                $('#' + qty).val('1');
                $('#' + rate).val(names[5]);
                $('#' + uom).val(names[7]);
                $('#' + discount).val(names[4]);
                $('#' + taxrate).val(names[6]);
                $('#' + hsn).val(names[2]);
                $('#' + item).val(names[1]);

                calculateTotalTaxAmount();
                updateTaxFields();
                discountamt(inputname);
                subtotal();
                calculatePFPercentage();
                calculateFreightPercentage()

                

                
                updateTotalInWords();
                updatePFAmount();
                updateFreightPercentage();

                
            }

        });
    }

    function calculatePFPercentage() {
        var subtotal2 = parseFloat(document.getElementById('subtotal').value); // Assuming subtotal field exists
        var percentage2 = parseFloat(document.getElementById('packaging_forwording_percentage').value);
        var pfAmount2 = (subtotal2 * percentage2) / 100;

        var gstAmountpf2 = (pfAmount2 * 0.18).toFixed(2);
        var pfAmount = (pfAmount2 + parseFloat(gstAmountpf2)).toFixed(2);
        console.log(pfAmount,"pfAmount.......")
        document.getElementById('pf_percentage').value = pfAmount;
        updateTotalInWords();

        
    }
    function calculateFreightPercentage() {
        var subtotal3 = parseFloat(document.getElementById('subtotal').value); // Assuming subtotal field exists
        var fr_percentage3 = parseFloat(document.getElementById('freight_percentage').value);
        var f_Percentage3 = (subtotal3 * fr_percentage3) / 100;
        document.getElementById('fr_percentage').value = f_Percentage3.toFixed(2);
        updateTotalInWords();

    }

    function discountamt(inputname) {
        //alert(inputname);
        input = inputname.split("_");
        id_val = input[1];
        //alert(id_val);

        var rate = $('#rate_' + id_val).val();
        var discount = $('#discount_' + id_val).val();
        var qty = $('#qty_' + id_val).val();

        var item_rate = $('#item_rate').val();

        if (item_rate == 'tax_exclusive') {
            var total = rate - (rate * discount / 100);
            //alert(total);
            var totalamt = total * qty;
            //alert(totalamt);

            $('#total_' + id_val).val((totalamt).toFixed(2));

            var taxrate = $('#taxrate_' + id_val).val();
            var taxamt = totalamt * taxrate / 100;
            //alert(taxamt);

            $('#taxamt_' + id_val).val((taxamt).toFixed(2));
        }

        if (item_rate == 'tax_inclusive') {
            var total = rate - (rate * discount / 100);
            //alert(totalamt);

            var totalamt = total * qty;
            //alert(totalamt);

            //t = $('#total_'+id_val).val((totalamt).toFixed(2));

            var taxrate = $('#taxrate_' + id_val).val();
            var taxamt = totalamt * taxrate / 100;
            //alert(taxamt);

            $('#taxamt_' + id_val).val((taxamt).toFixed(2));

            t = totalamt - taxamt;

            $('#total_' + id_val).val((t).toFixed(2));
        }

        subtotal();

        calculateTotalTaxAmount();
        $(document).ready(function() {
            subtotal();
        });
        updateTotalInWords();
    }

    function taxrate(inputname) {

        input = inputname.split("_");
        id_val = input[1];
     
        var rate = $('#rate_' + id_val).val();
        var qty = $('#qty_' + id_val).val();
        var discount = $('#discount_' + id_val).val();

    
        var item_rate = "tax_exclusive";

        if (item_rate == 'tax_exclusive') {
            var total = rate - (rate * discount / 100);
            //alert(total);
            var totalamt = total * qty;
            //alert(totalamt);

            $('#total_' + id_val).val((totalamt).toFixed(2));

            var taxrate = $('#taxrate_' + id_val).val();
            var taxamt = totalamt * taxrate / 100;
            //alert(taxamt);

            $('#taxamt_' + id_val).val((taxamt).toFixed(2));
        }

        if (item_rate == 'tax_inclusive') {
            var total = rate - (rate * discount / 100);
            //alert(totalamt);

            var totalamt = total * qty;
            //alert(totalamt);

            //t = $('#total_'+id_val).val((totalamt).toFixed(2));

            var taxrate = $('#taxrate_' + id_val).val();
            var taxamt = totalamt * taxrate / 100;
            //alert(taxamt);

            $('#taxamt_' + id_val).val((taxamt).toFixed(2));

            t = totalamt - taxamt;

            $('#total_' + id_val).val((t).toFixed(2));
        }

        subtotal();

        calculateTotalTaxAmount();
        $(document).ready(function() {
            subtotal();
        });

        
        updateTotalInWords();
    }

 
    function qty(inputname) {
        input = inputname.split("_");
        id_val = input[1];
        //alert(id_val);

        var rate = $('#rate_' + id_val).val();
        var qty = $('#qty_' + id_val).val();
        var discount = $('#discount_' + id_val).val();

        var item_rate = $('#item_rate').val();

        if (item_rate == 'tax_exclusive') {
            //var discountamt = rate/100;
            //var total = rate-discountamt;
            var total = rate - (rate * discount / 100);
            //alert(total);
            var totalamt = total * qty;
            //alert(totalamt);

            $('#total_' + id_val).val((totalamt).toFixed(2));

            var taxrate = $('#taxrate_' + id_val).val();
            var taxamt = totalamt * taxrate / 100;
            //alert(taxamt);

            $('#taxamt_' + id_val).val((taxamt).toFixed(2));
        }

        if (item_rate == 'tax_inclusive') {
            //var discountamt = rate/100;
            //var total = rate-discountamt;
            var total = rate - (rate * discount / 100);
            //alert(total);
            var totalamt = total * qty;
            //alert(totalamt);

            //t = $('#total_'+id_val).val((totalamt).toFixed(2));

            var taxrate = $('#taxrate_' + id_val).val();
            var taxamt = totalamt * taxrate / 100;
            //alert(taxamt);

            $('#taxamt_' + id_val).val((taxamt).toFixed(2));

            t = totalamt - taxamt;

            $('#total_' + id_val).val((t).toFixed(2));
        }

        subtotal();

        calculateTotalTaxAmount();
        $(document).ready(function() {
            subtotal();
        });
        updateTotalInWords();
    }
    function rate(inputname) {
        // Extracting the id from inputname
        input = inputname.split("_");
        id_val = input[1];

        // Parsing the values
        var rate = parseFloat($('#rate_' + id_val).val()) || 0;
        var qty = parseFloat($('#qty_' + id_val).val()) || 0;
        var discount = parseFloat($('#discount_' + id_val).val()) || 0;

        var item_rate = 'tax_exclusive'; // Assuming tax_exclusive for now.

        if (item_rate == 'tax_exclusive') {
            var total = rate - (rate * discount / 100);
            var totalamt = total * qty;
            $('#total_' + id_val).val(totalamt.toFixed(2));

            var taxrate = parseFloat($('#taxrate_' + id_val).val()) || 0;
            var taxamt = totalamt * taxrate / 100;
            console.log(taxamt,taxrate,"taxamt.kkkkkkkk")

            $('#taxamt_' + id_val).val(taxamt.toFixed(2));
        }

        if (item_rate == 'tax_inclusive') {
            var total = rate - (rate * discount / 100);
            var totalamt = total * qty;
            var taxrate = parseFloat($('#taxrate_' + id_val).val()) || 0;
            var taxamt = totalamt * taxrate / 100;
            $('#taxamt_' + id_val).val(taxamt.toFixed(2));

            var totalExclusive = totalamt - taxamt;
            $('#total_' + id_val).val(totalExclusive.toFixed(2));
        }

        subtotal();
        calculateTotalTaxAmount();
        $(document).ready(function() {
            subtotal();
        });
        updateTotalInWords();
    }

    function subtotal() {
        var totalamt = 0;
        $(".totalamt").each(function () {
            totalamt += parseFloat($(this).val()) || 0;
        });

        var sub_total = totalamt;
        $('.subtotal').val(sub_total.toFixed(2));

        var sum1 = 0;
        $(".taxamt").each(function () {
            sum1 += parseFloat($(this).val()) || 0;
        });
        console.log(sum1,"sum1.........")

        var cgst = parseFloat($('#cgst').val()) || 0;
        var sgst = parseFloat($('#sgst').val()) || 0;
        var igst = parseFloat($('#igst').val()) || 0;
        var adjustment = parseFloat($('#adjustment').val()) || 0;
        var pf_amount = parseFloat($('#pf_amount').val()) || 0;
        var fr_amount = parseFloat($('#fr_amount').val()) || 0;
        var pf_percentage = parseFloat($('#pf_percentage').val()) || 0;
        var fr_percentage = parseFloat($('#fr_percentage').val()) || 0;
        var sale_of_good = parseFloat($('#sale_of_good').val()) || 0;

      

        // var finalamt = sub_total + cgst + sgst + igst + adjustment + pf_amount + fr_amount + pf_percentage + fr_percentage + sale_of_good;
        var finalamt = sub_total + sum1 + adjustment + pf_amount + fr_amount + pf_percentage + fr_percentage + sale_of_good;

        $('.finalamt').val(finalamt.toFixed(2));
        updatePFPercentage();
        updateFreightPercentage();

    }

    

    $(document).on('change', '#item_rate', function () {
        var item_rate = $(this).val();
        //alert(item_rate);

        for (var i = 0; i < 2; i++) {
            //alert(i);

            if (item_rate == 'tax_inclusive') {
                qty('qty_' + i);
                rate('rate_' + i);
                discountamt('discount_' + i);
            }

            if (item_rate == 'tax_exclusive') {
                qty('qty_' + i);
                rate('rate_' + i);
                discountamt('discount_' + i);
            }
        }


    });

    $(document).on('keyup', '#freight_amount', function () {
        subtotal();

        ;
        updateTotalInWords();
    });

    $(document).on('keyup', '#freight_percentage', function () {
        subtotal();

        ;
        updateTotalInWords();
    });
    $(document).on('keyup', '#packaging_forwording_amount', function () {
        subtotal();

        ;
        updateTotalInWords();
    });
    $(document).on('keyup', '#packaging_forwording_percentage', function () {
        subtotal();

        
        updateTotalInWords();
    });
    $(document).on('keyup', '#gst_option', function () {
        subtotal();

        
        updateTotalInWords();
    });

    $(document).on('keyup', '#igst', function () {
        subtotal();

        updateTotalInWords();
    });
</script>

<script>
    function updateTaxFields() {
        var gstOption = document.getElementById('gst_option').value;
        var totalTaxAmount = parseFloat(document.getElementById('total_tax_amount').value) || 0;

        if (gstOption === 'Interstate') {
            document.getElementById('igst').value = totalTaxAmount.toFixed(2);
            document.getElementById('cgst').value = '0.00';
            document.getElementById('sgst').value = '0.00';
        } else if (gstOption === 'Intrastate') {
            var halfTaxAmount = (totalTaxAmount / 2).toFixed(2);
            document.getElementById('cgst').value = halfTaxAmount;
            document.getElementById('sgst').value = halfTaxAmount;
            document.getElementById('igst').value = '0.00';
        } else {
            // Handle cases where no valid option is selected
            document.getElementById('cgst').value = '0.00';
            document.getElementById('sgst').value = '0.00';
            document.getElementById('igst').value = '0.00';
        }
    }
    
    // Example function to update total tax amount (for demonstration purposes)
    function setTotalTaxAmount(amount) {
        document.getElementById('total_tax_amount').value = amount.toFixed(2);
        updateTaxFields();
    }
    </script>
<!-- 
<script>
    $(document).ready(function() {
        $('#gst_option').change(function() {
            updateGST();
            updateTotalInWords();

        });
    
        // Assuming there's a trigger for the subtotal calculation
        $('#freight_amount, .totalamt').on('input', function() {
            subtotal();
            updateTotalInWords();

        });
    });
    
    function updateGST() {
        var gstOption = $('#gst_option').val();
        if (gstOption === "Interstate") {
            // Apply 18% GST and show IGST field
            $('#cgstper').val("0%");
            $('#sgstper').val("0%");
            $('#igstper').val("18%");
            $('#igst_id').show();
        } else if (gstOption === "Intrastate") {
            // Apply 9% CGST and 9% SGST and show fields
            $('#cgstper').val("9%");
            $('#sgstper').val("9%");
            $('#igstper').val("0%");
            $('#igst_id').hide();
        }
        subtotal();
        updateTotalInWords();

    }
    
    function subtotal() {
        var freight = $('#freight').val() || 0;
        var totalamt = 0;
        $(".totalamt").each(function() {
            totalamt += +this.value || 0;
        });
    
        sub_total =  totalamt;
        $('.subtotal').val(sub_total);
    
        var gstOption = $('#gst_option').val();
        var gstRate = 0;
        var cgstRate = 0;
        var sgstRate = 0;
    
        if (gstOption === "Interstate") {
            gstRate = 18;
            cgstRate = 0;
            sgstRate = 0;
        } else if (gstOption === "Intrastate") {
            gstRate = 0;
            cgstRate = 9;
            sgstRate = 9;
        }
    
        var cgstAmount = (sub_total * cgstRate) / 100;
        var sgstAmount = (sub_total * sgstRate) / 100;
        var igstAmount = (sub_total * gstRate) / 100;
    
        if (gstOption === "Interstate") {
            $('#cgst').val("0.00");
            $('#sgst').val("0.00");
            $('#igst').val(igstAmount.toFixed(2));
        } else if (gstOption === "Intrastate") {
            $('#cgst').val(cgstAmount.toFixed(2));
            $('#sgst').val(sgstAmount.toFixed(2));
            $('#igst').val("0.00");
        }
        var pf_amount=$('#packaging_forwording_amount').val();
        var fre_amount=$('#freight_amount').val();
        var subtotal = parseFloat(document.getElementById('subtotal').value); // Assuming subtotal field exists
        var fr_percentage = parseFloat(document.getElementById('freight_percentage').value);
        var f_Percentage_amt = (subtotal * fr_percentage) / 100;

        var subtotal = parseFloat(document.getElementById('subtotal').value); // Assuming subtotal field exists
        var percentage = parseFloat(document.getElementById('packaging_forwording_percentage').value);
        var pfAmount_amt = (subtotal * percentage) / 100;
        

    
        var totalTaxAmount = cgstAmount + sgstAmount + igstAmount;
        $('.totaltaxamt').val(totalTaxAmount.toFixed(2));
    
        var finalamt = sub_total + totalTaxAmount + parseInt(pf_amount) + parseInt(fre_amount) + f_Percentage_amt + pfAmount_amt;
        $('.finalamt').val(finalamt.toFixed(2));
        updateTotalInWords();
    }
    </script>
     -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.17.0/jquery.validate.js"></script>
<script src="https://olatechs.in/crm/supreeno/assets/js/malsup-jquery.js"></script>

<script>

    document.getElementById('customer_Name').addEventListener('input', function() {
        var input = this.value;
        var list = document.getElementById('customer_Name_list').options;

        for (var i = 0; i < list.length; i++) {
            if (list[i].value === input) {
                console.log(list[i].dataset);
                document.getElementById('customer_id').value = list[i].dataset.id;
                document.getElementById('contact_person_name').value = list[i].dataset.contact_person;
                document.getElementById('destination').value = list[i].dataset.dc_destination;
                document.getElementById('order_no').value = list[i].dataset.dc_number;
                //  $("#q_ser_type option").attr('selected', false);
                // $("#q_ser_type option[value='" + list[i].dataset.service_type + "']").attr('selected', true);
                break;
            }
        }
    });
</script>

<script type="text/javascript">



    $(document).on('change', '#customer_name', function () {
        $('#shipping_address').empty();
        //alert();return;
        var customer_id = $('#customer_name').val();
        //alert(customer_id);return;

        $.ajax({
            type: 'POST',
            url: '#',
            data: { 'customer_id': customer_id },
            dataType: 'json',
            success: function (json) {
                $('#shipping_address').append($('<option>').text("Select Shipping Address"));
                //$('#document_uid').append($('<option>').text("Select Document"));
                $.each(json, function (key, value) {
                    $('#shipping_address')
                        .append($("<option></option>")
                            .attr("value", value.id)
                            .text(value.shippingattention + ', ' + value.shippingstreet + ', ' + value.shippingcity + ', ' + value.shippingstate + ', ' + value.shippingpincode))
                });
            }
        })
    });

    function shippingaddress() {
        $('#shipping_address').empty();
        //alert();return;
        var customer_id = $('#customer_name').val();
        //alert(customer_id);return;

        $.ajax({
            type: 'POST',
            url: '#',
            data: { 'customer_id': customer_id },
            dataType: 'json',
            success: function (json) {
                $('#shipping_address').append($('<option>').text("Select Shipping Address"));
                //$('#document_uid').append($('<option>').text("Select Document"));
                $.each(json, function (key, value) {
                    $('#shipping_address')
                        .append($("<option></option>")
                            .attr("value", value.id)
                            .text(value.shippingattention + ', ' + value.shippingstreet + ', ' + value.shippingcity + ', ' + value.shippingstate + ', ' + value.shippingpincode))
                });
            }
        })
    }
</script>

<script type="text/javascript">
    $(document).on('keyup', '#sales_order_no', function () {
        var sales_order_no = $('#sales_order_no').val();

        if (sales_order_no != '') {
            $.ajax({
                type: 'POST',
                url: '#',
                data: { 'sales_order_no': sales_order_no },
                dataType: 'json',
                success: function (data) {
                    $('#challan_date').val(data.sales_order_details.dc_date_1);
                    $('#payment_term').val(data.sales_order_details.payment_term);
                    $('#customer_name').val(data.sales_order_details.customer_name);
                    //$('#challan_type').val(data.sales_order_details.challan_type);
                    $('#place_of_supply').val(data.sales_order_details.place_of_supply);
                    $('#transporter_name').val(data.sales_order_details.transporter_name);
                    $('#delivery_type').val(data.sales_order_details.delivery_type);
                    $('#buyer_order_no').val(data.sales_order_details.buyer_order_no);
                    $('#buyer_order_date').val(data.sales_order_details.buyer_order_date);

                    $('#shipping_address').val(shippingaddress(data.sales_order_details.shippingaddress));
                    $('#lr_no').val(data.sales_order_details.lr_no);
                    $('#destination').val(data.sales_order_details.destination);
                    $('#sales_person').val(data.sales_order_details.sales_person);
                    $('#freight').val(data.sales_order_details.freight);

                    $.each(data.sales_order_entries, function (index, obj) {
                        if (index == 0) {
                            $(`#itemcode_` + index).val(obj.itemcode);
                            $(`#item_` + index).val(obj.item);
                            $(`#hsn_` + index).val(obj.hsn);
                            $(`#qty_` + index).val(obj.qty);
                            $(`#uom_` + index).val(obj.uom);
                            $(`#rate_` + index).val(obj.rate);
                            $(`#discount_` + index).val(obj.discount);
                            $(`#taxrate_` + index).val(obj.taxrate);
                            $(`#taxamt_` + index).val(obj.taxamt);
                            $(`#total_` + index).val(obj.total);
                        }
                        else {

                            var my_html = `<tr class="add-row">
                                    <input type="hidden" name="iid[]" class="iid" value="`+ index + `">

                                    <td><input type="text" class="form-control" name="itemcode_`+ index + `" id="itemcode_` + index + `" value="` + obj.itemcode + `"></td>

                                    <td><input type="text" class="form-control" name="item_`+ index + `" id="item_` + index + `" value="` + obj.item + `" placeholder=" "> </td>

                                    <td><textarea class="form-control" name="hsn_`+ index + `" id="hsn_` + index + `" placeholder=" ">` + obj.hsn + `</textarea></td>
                                                                    
                                    <td><input type="text" class="form-control"name="qty_`+ index + `" id="qty_` + index + `" value="` + obj.qty + `" > </td>

                                    <td><input type="text" class="form-control" name="uom_`+ index + `" id="uom_` + index + `" value="` + obj.uom + `"></td>
                                                                    
                                    <td><input type="text" class="form-control" name="rate_`+ index + `" id="rate_` + index + `" value="` + obj.rate + `" ></td>

                                    <td><input type="text" class="form-control" name="discount_`+ index + `" id="discount_` + index + `" value="` + obj.discount + `"></td>

                                    <td><input type="text" class="form-control" name="taxrate_`+ index + `" id="taxrate_` + index + `" value="` + obj.taxrate + `" ></td>

                                    <td><input type="text" class="form-control taxamt" name="taxamt_`+ index + `" id="taxamt_` + index + `" value="` + obj.taxamt + `"></td>

                                    <td><input type="text" class="form-control totalamt" name="total_`+ index + `" id="total_` + index + `" value="` + obj.total + `"></td>

                                    <td class="add-remove text-end">
                                        <a href="javascript:void(0);" class="add-btn me-2"><i class="fas fa-plus-circle"></i></a>

                                        <a href="javascript:void(0);" class="remove-btn "><i class="fe fe-trash-2" ></i></a>
                                    </td>
                                </tr>`;

                            $("#append_table > tbody ").append(my_html);
                        }
                    });

                    $('#subtotal').val(data.sales_order_details.subtotal);
                    $('#igstper').val(data.sales_order_details.igstper);
                    $('#cgstper').val(data.sales_order_details.cgstper);
                    $('#sgstper').val(data.sales_order_details.sgstper);
                    $('#igst').val(data.sales_order_details.igst);
                    $('#cgst').val(data.sales_order_details.cgst);
                    $('#sgst').val(data.sales_order_details.sgst);
                    $('#total_taxamt').val(data.sales_order_details.total_taxamt);
                    $('#totalamt').val(data.sales_order_details.totalamt);
                }
            })
        }
        else {
            alert("Please enter sales order no");
        }

    });
</script>

<script>
    function test(n) {
        if (n < 0) return false;
        const single_digit = ['', 'One', 'Two', 'Three', 'Four', 'Five', 'Six', 'Seven', 'Eight', 'Nine'];
        const double_digit = ['Ten', 'Eleven', 'Twelve', 'Thirteen', 'Fourteen', 'Fifteen', 'Sixteen', 'Seventeen', 'Eighteen', 'Nineteen'];
        const below_hundred = ['Twenty', 'Thirty', 'Forty', 'Fifty', 'Sixty', 'Seventy', 'Eighty', 'Ninety'];

        if (n === 0) return 'Zero Rupees';

        function translate(n) {
            let word = "";
            if (n < 10) {
                word = single_digit[n] + ' ';
            } else if (n < 20) {
                word = double_digit[n - 10] + ' ';
            } else if (n < 100) {
                const rem = translate(n % 10);
                word = below_hundred[Math.floor(n / 10) - 2] + ' ' + rem;
            } else if (n < 1000) {
                word = single_digit[Math.floor(n / 100)] + ' Hundred ' + translate(n % 100);
            } else if (n < 100000) {
                word = translate(Math.floor(n / 1000)).trim() + ' Thousand ' + translate(n % 1000);
            } else if (n < 10000000) {
                word = translate(Math.floor(n / 100000)).trim() + ' Lakh ' + translate(n % 100000);
            } else if (n < 1000000000) {
                word = translate(Math.floor(n / 10000000)).trim() + ' Crore ' + translate(n % 10000000);
            } else {
                word = translate(Math.floor(n / 1000000000)).trim() + ' Arab ' + translate(n % 1000000000);
            }
            return word;
        }

        let [integerPart, decimalPart] = n.toString().split('.');

        let result = translate(parseInt(integerPart)).trim() + ' Rupees';

        if (decimalPart) {
            decimalPart = decimalPart.padEnd(2, '0'); // Ensure it's at least 2 digits
            result += ' and ' + translate(parseInt(decimalPart)) + ' Paise';
        }

        return result.trim() + '.';
    }

    function updateTotalInWords() {
        const totalAmt = parseFloat(document.getElementById('totalamt').value);
        const totalAmtInWords = isNaN(totalAmt) ? '' : test(totalAmt);
        document.getElementById('totalamt_word').value = totalAmtInWords;
    }

    window.onload = function() {
        document.getElementById('totalamt').addEventListener('input', updateTotalInWords);
        updateTotalInWords(); // Update on page load
    };
</script>


<script>
    // Function to validate email
    function isValidEmail(email) {
        var emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return emailPattern.test(email);
    }

    // Add an event listener for input changes
    document.getElementById('contact_person_email').addEventListener('input', validateEmail);

    // Function to validate email and show/hide error message
    function validateEmail() {
        var emailInput = document.getElementById('contact_person_email').value;
        var emailErrorMessage = document.getElementById('email-error-message');

        // Check if the email is valid
        var isValid = isValidEmail(emailInput);

        // Display or hide the error message based on validation result
        if (!isValid && emailInput !== "") {
            emailErrorMessage.style.display = 'inline';
        } else {
            emailErrorMessage.style.display = 'none';
        }
    }
</script>

{% endblock main_content %}