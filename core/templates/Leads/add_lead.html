{% extends 'dashboard/base_template.html' %}
{% block title %}
CRM
{% endblock %}

{% block custom_css %}
<style>
    /* Inactive tab styles */
    .nav-tabs.nav-tabs-bottom .nav-item .nav-link {
        color: #ccc;
        /* Faint gray color for inactive tabs */
    }

    /* Active tab style */
    .nav-tabs.nav-tabs-bottom .nav-item .nav-link.active {
        color: #000;
        /* Black color for active tab */
    }
</style>
{% endblock custom_css %}

{% block main_content %}
<div class="page-wrapper" style="padding-top: 0px;">
    <div class="content container-fluid">
        <div class="page-header">
            <div class="row">
                <div class="col-sm-12">
                    <h3 class="page-title">
                        <a href="{% url 'lead_list' %}" style="margin-right: 10px;">
                            <i class="fa fa-arrow-left" data-bs-toggle="tooltip" title="" data-bs-original-title="Back"
                                aria-label="fa fa-arrow-left"></i>
                        </a>
                        Add Leads
                    </h3>
                </div>
            </div>
        </div>
        <form method="POST" enctype="multipart/form-data" onsubmit="return validateForm(event)">
            {% csrf_token %}
            <div class="row">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>Contact Person <span class="text-danger">*</span> </label>
                                        <input type="text" class="form-control" name="contact_person"
                                            id="contact_person" placeholder="Contact Person" required>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>Company Name <span class="text-danger">*</span> </label>
                                        <input type="text" class="form-control" name="company_name"
                                            id="company_name" placeholder="Company Name" required>
                                    </div>
                                </div>
                                
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>Contact Number <span class="text-danger">*</span></label>
                                        <input type="text" class="form-control" name="contact_number"
                                            id="contact_number" placeholder="Contact Number" required>
                                        <div id="contactNumberError" class="text-danger mt-2"></div>
                                    </div>
                                </div>

                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>Email ID</label>
                                        <input type="text" class="form-control" name="email" id="email"
                                               placeholder="Email Address" onchange="validateEmail(this);"
                                               value="NA" title="Please enter a valid email address"/>
                                    </div>
                                    <p id="msg_email" style="color: red;"></p>
                                </div>

                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>Status</label>
                                        <select class="form-control " name="status">
                                            <option value="">Select Status</option>
                                            <option value="New" selected>New</option>
                                            <option value="Contacted">Contacted</option>
                                            <option value="Proposal Sent">Proposal Sent</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>Website</label>
                                        <input type="text" class="form-control" name="website" id="website"
                                            placeholder="Website">
                                    </div>
                                </div>

                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>Source</label>
                                        <select class="form-control " name="source" id="source">
                                            <option value="" disabled selected>Select</option>
                                            <option value="Web">Web</option>
                                            <option value="Email">Email</option>
                                            <option value="Phone">Phone</option>
                                            <option value="Social_Media">Social Media</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>Inquiry</label>
                                        <textarea type="text" name="inquiry" id="inquiry" class="form-control"
                                            placeholder="Inquiry"></textarea>
                                    </div>
                                </div>
                            </div>
                            <div class="add-customer-btns text-end">
                                <button type="submit" class="btn btn-outline-primary me-1 btn-rounded">Save Leads</button>
                                <button class="btn customer-btn-cancel btn-outline-danger me-1 btn-rounded">Cancel</button>
                                <button type="reset" class="btn btn-outline-secondary me-1 btn-rounded">Reset</button>
                            </div>
                            <div class="row col-sm-6 p-5">
                                <div class="success_message row"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>
{% endblock main_content %}

{% block custom_js %}
<script>
    document.getElementById("email").addEventListener("input", function() {
        validateEmail(this);
    });

    function validateEmail(emailField) {
        var reg = /^([A-Za-z0-9_\-\.])+@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/;
        const emailError = document.getElementById("msg_email");

        if (reg.test(emailField.value)) {
            emailError.textContent = '';
            emailField.classList.remove('is-invalid');
            emailField.classList.add('is-valid');
            return true;
        }

        const allowedValues = ['na', 'NA', 'nan', 'NaN'];
        if (allowedValues.includes(emailField.value)) {
            emailError.textContent = '';
            emailField.classList.remove('is-invalid');
            emailField.classList.add('is-valid');
            return true;
        }

        emailError.textContent = "Please enter a valid email or 'NA'";
        emailField.classList.add('is-invalid');
        emailField.classList.remove('is-valid');
        return false;
    }

    document.getElementById('contact_number').addEventListener('input', function() {
        validateContactNumber();
    });

    function validateContactNumber() {
        const contactNumberInput = document.getElementById('contact_number');
        const contactNumberError = document.getElementById('contactNumberError');
        const contactNumber = contactNumberInput.value.trim();
        
        // Regular expression for 10-digit number
        const contactNumberPattern = /^\d{10}$/;
        
        if (!contactNumberPattern.test(contactNumber)) {
            contactNumberError.textContent = "Please enter a valid 10-digit contact number.";
            contactNumberInput.classList.add('is-invalid');
        } else {
            contactNumberError.textContent = "";
            contactNumberInput.classList.remove('is-invalid');
            contactNumberInput.classList.add('is-valid');
        }
    }
</script>
{% endblock custom_js %}
