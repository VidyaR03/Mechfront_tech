{% extends 'dashboard/base_template.html' %}
{% block custom_css %}
{% block page_title %}
{% endblock page_title %}
<style>
  .custom-error {
    max-width: 300px;
    /* Adjust the width to your desired value */
    margin: 0 auto;
    /* Add this line to center the element */
    text-align: center;
    /* Add this line to center the text inside the element */
  }

  .input-group-text {
    cursor: pointer;
  }

  .grey-card {
    background-color: LightGray;
  }

  /* .negative-padding {
    margin-top: -60px;
  } */

  div.alphabet {
        display: table;
        width: 100%;
        margin-bottom: 1em;
        text-align: center;
    }
 
    div.alphabet span {
        display: inline-block;
        color: #3174c7;
        cursor: pointer;
        padding: 3px 8px;
        margin: 2px;
        border: 1px solid #3174c7;
        border-radius: 4px;
    }
 
    div.alphabet span:hover {
        background-color: #3174c7;
        color: white;
    }
 
    div.alphabet span.active {
        color: white;
        background-color: #3174c7;
        border-color: #3174c7;
    }
        .toast-success {
                background-color: darkgreen !important;
                color: white !important;
        }
        #toast-container {
            top: auto;
            top: 60px; /* Adjust this value to move the message further down or up */
        }
            .toast-error {
            background-color: red !important;
            color: white !important;
        }

        #toast-container {
            top: auto;
            top: 60px; /* Adjust as needed */
        }

        .dataTables_filter{
            margin-bottom: 16px !important;
        }
        .dataTables_length{
            margin-top: 8px !important;
        }
</style>
{% endblock custom_css %}
<!-- Main content -->
{% block main_content %}

<div class="page-wrapper negative-padding">
  <div class="content container-fluid">
    <div class="page-header">
      <div class="row align-items-center">
        <div class="col">
          <h3 class="page-title">Customer</h3>
        </div>
        <div class="col-auto">
          <a href="{% url 'add_customer' %}" class="btn btn-primary btn-rounded"> <i class="fas fa-plus-circle"></i> Add
            Customer</a>
        </div>
      </div>
    </div>




    <div class="row">
      <div class="col-sm-12">
        <div class="card card-table">
          <div class="card-body">
            <div class="table-responsive test">
              <div class="alphabet"></div>

              <table id="challanTable" class="table table-center table-hover datatable">
                <thead class="thead-light">
                  <tr>
                  <tr>
                    <th>Sr No.</th>
                    <th>Customer Name</th>
                    <th>Email</th>
                    <th>Company Name</th>
                    <th>Phone</th>
                    <!-- <th>Receivables</th> -->

                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  {% if customer_data %}
                  {% for t in customer_data %}
                  <tr>
                    <td>
                      {{forloop.counter}}
                    </td>
                    <!-- <td>
                        <a style="color: blue;" href="{% url 'show_customer' t.id%}">{{t.customer}}  </a>
                    </td> -->
                    <td>
                      {{t.customer}}  
                  </td>
                    <td>
                      {{ t.cust_email }}
                    </td>
                    <td>
                      {{t.company_name}}
                    </td>
                    <td>
                      {{ t.phone }}
                    </td>
                    <!-- <td>{{t.cust_receive_amount}}</td> -->

                    <td>
                      <div class="btn-group" role="group">
                        <a href="{% url 'edit_customer' t.id %}" class="btn btn-sm btn-outline-success me-1 btn-rounded"
                          role="button"><i class="far fa-edit me-1"></i></a>

                        <!-- Link directly to the delete view with the customer ID -->
                        <!-- <a class="btn btn-sm btn-outline-danger me-1"
                          href="{% url 'delete_customer' customer_id=t.id %}">
                          <i class="far fa-trash-alt me-1"></i>
                        </a> -->

                          <a class="btn btn-sm btn-outline-danger me-1" data-bs-toggle="modal" data-bs-target="#deleteModal" 
                          data-url="{% url 'delete_customer' customer_id=t.id %}">
                          <i class="far fa-trash-alt me-1"></i>
                        </a>


                      </div>
                    </td>
                  </tr>






                  {% endfor %}
                  {% endif %}

                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
</div>

<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="deleteModalLabel">Confirm Deletion</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        Are you sure you want to delete this item?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
      </div>
    </div>
  </div>
</div>

{% endblock main_content %}
{% block custom_js %}

<!-- Include Toastr CSS and JavaScript -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>
<script>
    // Function to show the toast message
    function showToastMessage(message, type) {
      toastr[type](message);
    }
  
    // Check if a message exists and show it as a toast
    {% if messages %}
      {% for message in messages %}
        showToastMessage('{{ message }}', '{{ message.tags }}');
      {% endfor %}
    {% endif %}
  </script>
<script>

  document.getElementById('deleteModal').addEventListener('show.bs.modal', function (event) {
    var button = event.relatedTarget;
    var url = button.getAttribute('data-url');
    
    // Set the URL for the confirm button
    var confirmButton = document.getElementById('confirmDeleteBtn');
    confirmButton.onclick = function() {
      window.location.href = url;
    };
  });
    </script>

<!-- Include Toastr CSS and JavaScript -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>


<script>
  // Function to confirm the delete action
  function confirmDelete(url) {
    if (confirm("Are you sure you want to delete this item?")) {
      // If the user clicks OK, redirect to the delete URL
      window.location.href = url;
    }
  }
</script>
<script>
  // Show the message container
  var messageContainer = document.getElementById('message-container');
  messageContainer.style.display = 'block';

  // Automatically hide the message after 10 seconds
  setTimeout(function () {
    messageContainer.style.display = 'none';
  }, 2000); // 10000 milliseconds = 10 seconds
</script>
<!-- Include DataTables CSS -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.10.25/css/jquery.dataTables.min.css">
<!-- Include DataTables JavaScript -->
<script src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>

<script>
  // Function to confirm the delete action
  function confirmDelete(url) {
    if (confirm("Are you sure you want to delete this item?")) {
      // If the user clicks OK, redirect to the delete URL
      window.location.href = url;
    }
  }
</script>
<script>
  $(document).ready(function () {
      // Initialize DataTable with ordering set to false
      var table = $('#challanTable').DataTable({
          "paging": true,       // Enable pagination
          "lengthChange": true, // Show the page length options
          "searching": true,    // Enable search
          "info": true,         // Show information
          "ordering": false,    // Disable ordering
      });

      var alphabet = $('<div class="alphabet"/>').append('Search: ');

      $('<span class="clear active"/>')
          .data('letter', '')
          .html('ALL')
          .appendTo(alphabet);

      for (var i = 0; i < 26; i++) {
          var letter = String.fromCharCode(65 + i);

          $('<span/>')
              .data('letter', letter)
              .html(letter)
              .appendTo(alphabet);
      }

      alphabet.insertBefore(table.table().container());

      alphabet.on('click', 'span', function () {
          alphabet.find('.active').removeClass('active');
          $(this).addClass('active');

          var _alphabetSearch = $(this).data('letter');
          table.column(1).search('^' + _alphabetSearch, true, false).draw();
      });
  });
</script>
{% endblock custom_js %}