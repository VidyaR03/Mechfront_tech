{% extends 'dashboard/base_template.html' %}
{% block title %}
CRM
{% endblock %}

{% block custom_css %}

<style type="text/css">
    .no-outline {
        border-top-style: hidden;
        border-right-style: hidden;
        border-left-style: hidden;
        border-bottom-style: hidden;

    }

    .no-outline:focus {
        display: none;
    }

    #quotation_pdf {
        padding-right: 20px;
    }

    input[type=text],
    input[type=password] {
        width: 100%;
        text-align: center;
    }

    div.brand_name {
        text-transform: uppercase;
    }
</style>
{% endblock custom_css %}
{% block main_content %}

<body>

    <div class="page-wrapper">
        <div class="content container-fluid">
            <div class="row justify-content-center">
                <div class="col-xl-9">
                    <div class="text-md-end">
                        <div class="btn-group btn-group-sm d-print-none mb-4">
                            <!-- <a href="#" onclick="generatePDF('quotation_pdf')" class="btn btn-white text-black-50"><i class="fa fa-print"></i> Print</a> -->
                            <input type="button" onclick="printDiv('printableArea')" value="Download" class="btn btn-primary"/>

                        </div>
                    </div>
                    <div class="card" style="font-family: Calibri;">
                    <div id="printableArea">

                        <div class="card-body" id="quotation_pdf">


                            <div class="invoice-item">

                                <div class="row">
                                    <div class="col-md-7" align="right">
                                        <div class="invoice-logo" style="color: #000000 !important;"> CREDIT NOTE </div>

                                    </div>
                                    <!-- <div class="col-md-5">
                                    <p class="invoice-details"> 
                                        <strong style="color:#fff; text-align:right;">
                                            <span class="badge bg-info-light" style="margin-top:10px;float:right;">377</span>
                                        </strong>
                                    </p>
                                </div> -->
                                </div>
                            </div>
                            <div class="invoice-item" style="padding-left: 10px;">
                                <div class="row" style="border:1px solid #000;">


                                    <div class="col-md-6" style="border-right:1px solid #000;padding:0px;">
                                        <div class="invoice-info" style="border-bottom:0px solid #000;padding:10px;">

                                            <strong class="customer-text"
                                                style="color: #000000 !important; font-size: 22px;">M/S KEYMECH TECHNOLOGIES
                                                 </strong>

                                            <div class="row col-md-12">
                                                <div class="col-md-12 invte" style="color: #000000 !important;">UNIT
                                                    NO.108, PLOT NO. C-56/1, TURBHE INDUSTRIAL PARK, NAVI MUMBAI, THANE,
                                                    MAHARASHTRA, INDIA - 400710.</div>

                                                <div class="col-md-12 invte" style="color: #000000 !important;">
                                                    STOCKIEST AND SUPPLIER OF: </div>


                                                <div class="col-md-12 invte" style="color: #000000 !important;"> MS/SS
                                                    PIPE AND PIPE FITTINGS </div>


                                                <div class="col-md-12 invte" style="color: #000000 !important;">
                                                    STRUCTURAL STEEL </div>


                                                <div class="col-md-12 invte" style="color: #000000 !important;"> ELECTRO
                                                    POLISH PIPE AND DAIRY FITTINGS</div>

                                                <div class="col-md-12 invte" style="color: #000000 !important;">
                                                    <img class="img-fluid d-inline-block"
                                                        src="#"
                                                        height="75" width="75">

                                                    <img class="img-fluid d-inline-block"
                                                        src="#"
                                                        height="50" width="50">

                                                    <img class="img-fluid d-inline-block"
                                                        src="#"
                                                        height="30" width="30">

                                                    <img class="img-fluid d-inline-block"
                                                        src="#"
                                                        height="50" width="50">

                                                    <img class="img-fluid d-inline-block"
                                                        src="#"
                                                        height="50" width="50">

                                                    <img class="img-fluid d-inline-block"
                                                        src="#"
                                                        height="50" width="50">
                                                </div>
                                            </div>
                                        </div>


                                    </div>

                                    <div class="col-md-6" style="border-bottom:0px solid #000;padding:0px;">
                                        <div class="invoice-info" style="border-bottom:0px solid #000;padding:10px;">



                                            <div class="row col-md-12">


                                                <!-- <div class="col-md-12 invte" style="color: #000000 !important;">M/S KEYMECH TECHNOLOGIES</div> -->

                                                <div class="col-md-6 invte" style="color: #000000 !important;">
                                                    GSTIN/UIN </div>
                                                <div class="col-md-6 invte" style="color: #000000 !important;">:
                                                    27ABGCS2596F1Z1</div>

                                                <div class="col-md-6 invte" style="color: #000000 !important;"> PAN
                                                </div>
                                                <div class="col-md-6 invte" style="color: #000000 !important;">:
                                                    ABGCS2596F</div>

                                                <div class="col-md-6 invte" style="color: #000000 !important;"> EMAIL
                                                </div>
                                                <div class="col-md-6 invte" style="color: #000000 !important;">:
                                                    sales@supreenometalspvtltd.com</div>

                                                <div class="col-md-6 invte" style="color: #000000 !important;"> CONTACT
                                                </div>
                                                <div class="col-md-6 invte" style="color: #000000 !important;">:
                                                    8828285089</div>

                                                <div class="col-md-6 invte" style="color: #000000 !important;"> PLACE OF
                                                    SUPPLY</div>
                                                <!-- <div class="col-md-10 invte" style="color: #000000 !important;">: Maharashtra</div> -->
                                                <div class="col-md-6 invte" style="color: #000000 !important;">:
                                                    MAHARASHTRA</div>

                                                <div class="col-md-6 invte" style="color: #000000 !important;"> STATE
                                                    CODE</div>
                                                <div class="col-md-6 invte" style="color: #000000 !important;">: 27
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>

                            <div class="invoice-item" style="padding-left: 10px; padding-right: 5px;">
                                <div class="row"
                                    style="border-left:1px solid #000;border-right:1px solid #000;border-bottom:0px solid #000;   ">
                                    <div class="col-md-6" style="border-right:1px solid #000;padding:0px;">
                                        <div class="invoice-info" style="border-bottom:0px solid #000;padding:10px;">
                                            <p class="invoice-details invoice-details-two">
                                            <p class="invte1" style="color: #000000 !important;"> <b>Ref:
                                                    SMPL/APCOTEX/23-24</b></p>
                                            <p class="invte" style="color: #000000 !important;"> <b>TO</b></p>
                                            <p class="invte1" style="color: #000000 !important;"> <b>APCOTEX INDUSTRIES
                                                    LIMITED</b></p>
                                            <p class="invte" style="color: #000000 !important;"> PLOT NO. 3/1, MIDC
                                                TALOJA, TALOJA DIST-RAIGAD Maharashtra 410208 </p>
                                            </p>
                                            <!-- <p class="invte1" style="color: red;">Terms: Net 10</p> -->
                                            <div class="row">
                                                <div class="col-md-3 invte" style="color: #000000 !important;">
                                                    GSTIN/UIN </div>
                                                <div class="col-md-9 invte" style="color: #000000 !important;">:
                                                    27AAACA3427G1Z1</div>

                                                <div class="col-md-3 invte" style="color: #000000 !important;"> EMAIL
                                                </div>
                                                <div class="col-md-9 invte" style="color: #000000 !important;">:
                                                    rahul.ballal@apcotex.com</div>


                                            </div>


                                        </div>


                                    </div>
                                    <div class="col-md-6" style="border-bottom:0px solid #000;padding:0px;">
                                        <div class="invoice-info"
                                            style="border-bottom:0px solid #000;padding:10px; line-height:24px;">
                                            <div class="row">
                                                <div class="col-md-4 invte" style="color: #000000 !important;">
                                                    <b>CREDIT NOTE NO.</b>
                                                </div>
                                                <div class="col-md-4 invte" style="color: #000000 !important;">:
                                                    {{credit.id}}
                                                </div>
                                                <div class="col-md-4 invte" style="color: #000000 !important;"> </div>

                                                <div class="col-md-4 invte" style="color: #000000 !important;">
                                                    <b>BUYER ORDER NO</b>
                                                </div>
                                                <div class="col-md-4 invte" style="color: #000000 !important;">:
                                                    {{credit.cn_buyer_order_no}} </div>
                                                <div class="col-md-4 invte" style="color: #000000 !important;"> </div>

                                                <div class="col-md-4 invte" style="color: #000000 !important;">
                                                    <b>INVOICE NO</b>
                                                </div>
                                                <div class="col-md-4 invte" style="color: #000000 !important;">:
                                                    {{credit.cn_invoice_no}}
                                                </div>
                                                <div class="col-md-4 invte" style="color: #000000 !important;"> </div>

                                                <div class="col-md-4 invte" style="color: #000000 !important;">
                                                    <b>DELIVERY TYPE</b>
                                                </div>
                                                <div class="col-md-4 invte" style="color: #000000 !important;">:
                                                    {{credit.cn_delivery_term}} </div>
                                                <div class="col-md-4 invte"> </div>

                                                <div class="col-md-4 invte" style="color: #000000 !important;"> <b>DESTINATION</b> </div>
                                                <div class="col-md-4 invte" style="color: #000000 !important;">:
                                                    {{credit.cn_shipping_address}} </div>
                                                <div class="col-md-4 invte"> </div>


                                            </div>


                                        </div>



                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-12">

                                    <div class="table-responsive">
                                        <table width="100%" class="invoice-table" border="1">
                                            <thead>
                                                <tr style="border-bottom:0px solid #000;">
                                                    <td style="padding:0px;">
                                                        <table width="100%">
                                                            <tbody>
                                     
                                                                <tr>
                                                                    <td width="5%" align="center" valign="top"
                                                                        style="border-right:1px solid #000; border-bottom: 1px solid #000; color: #000000 !important;">
                                                                        <strong>Sr.</strong></td>

                                                                    <td width="45%" align="center" valign="top"
                                                                        style="border-right:1px solid #000; border-bottom: 1px solid #000; color: #000000 !important;">
                                                                        <strong>Description of Goods</strong></td>

                                                                    <td width="8%" align="center" valign="top"
                                                                        style="border-right:1px solid #000; border-bottom: 1px solid #000; color: #000000 !important;">
                                                                        <strong>HSN</strong></td>

                                                                    <td width="8%" align="center" valign="top"
                                                                        style="border-right:1px solid #000; border-bottom: 1px solid #000; color: #000000 !important;">
                                                                        <strong>Quantity</strong></td>

                                                                    <td width="8%" align="center" valign="top"
                                                                        style="border-right:1px solid #000; border-bottom: 1px solid #000; color: #000000 !important;">
                                                                        <strong>UOM</strong></td>

                                                                    <td width="8%" align="center" valign="top"
                                                                        style="border-right:1px solid #000; border-bottom: 1px solid #000; color: #000000 !important;">
                                                                        <strong>Rate</strong></td>

                                                                    <td width="8%" align="center" valign="top"
                                                                        style="border-right:1px solid #000; border-bottom: 1px solid #000; color: #000000 !important;">
                                                                        <strong>Discount</strong></td>

                                                                    <td width="10%" align="center" valign="top"
                                                                        style="border-bottom: 1px solid #000; color: #000000 !important;">
                                                                        <strong>Amount</strong></td>
                                                                </tr>
                                                            </table>
                                                            </td>
                                                            </tr>

                                                            <tr>
                                                                <td align="center" valign="top"
                                                                    style="text-align:center;border-bottom: 0px solid #000;padding: 0px; height:300px;">

                                                                    <table width="100%">
                                                                        {% for j in credit_item_data %}

                                                                        <tr>
                                                                            <td width="5%" align="center" valign="top" class="invte" style="color: #000000 !important; border-bottom: 1px solid #000; border-right: 1px solid #000;">
                                                                                {{ j.id }}
                                                                            </td>                                                                           
                                                                            
                
                                                                            <td width="45%" valign="top" style="text-align: left; color: #000000 !important; border-top: 0px solid #000; border-bottom: 1px solid #000; border-right: 1px solid #000;" class="invte">
                                                                            {{j.cn_description_goods}}
                                                                            </td>
    
                                                                            <td width="8%" align="center" valign="top" class="invte" style="color: #000000 !important; border-bottom: 1px solid #000; border-right: 1px solid #000;">
                                                                            {{j.cn_hsn}}
                                                                            </td>
    
                                                                            <td width="8%" align="center" valign="top" class="invte" style=" border-bottom: 1px solid #000; border-right: 1px solid #000;">
                                                                            {{j.cn_qantity}}
                                                                            </td>
                                                                            <td width="8%" valign="top" style="text-align: right; color: #000000 !important; border-bottom: 1px solid #000; border-right: 1px solid #000;" class="invte ">
                                                                                {{j.cn_unit_price}}
                                                                                
                                                                            </td>
    
                                                                            <td width="8%" align="center" valign="top" class="invte" style="color: #000000 !important; border-bottom: 1px solid #000; border-right: 1px solid #000;">
                                                                            {{j.cn_uom}}
                                                                            </td>
                                                                            
                                                                            <td width="8%" align="center" valign="top" class="invte" style="color: #000000 !important; border-bottom: 1px solid #000; border-right: 1px solid #000;">
                                                                                {{j.cn_discount}}
                                                                            </td>
    
                                                                            <td width="10%" valign="top" class="invte" style="border-bottom: 1px solid #000;">
                                                                            {{j.cn_total}} ----
                                                                            </td>                                     
                                                                                                                        
           
                                                                        </tr>
                                                                        {% endfor %}


                                                                    </table>
                                                                </td>
                                                            </tr>



                                                            <tr style="border-bottom:0px solid #000;">
                                                                <td style="padding:0px;">
                                                                    <table width="100%">
                                                                        <tr>
                                                                            <td width="5%" align="center" valign="top"
                                                                                style="border-right:1px solid #000; border-top: 1px solid #000; color: #000000 !important;">
                                                                                <strong></strong></td>

                                                                            <td width="45%" align="center" valign="top"
                                                                                style="border-right:1px solid #000; border-top: 1px solid #000; color: #000000 !important;">
                                                                                <strong>Sub Total</strong></td>

                                                                            <td width="8%" align="center" valign="top"
                                                                                style="border-right:1px solid #000; border-top: 1px solid #000; color: #000000 !important;">
                                                                                <strong></strong></td>

                                                                            <td width="8%" align="center" valign="top"
                                                                                style="border-right:1px solid #000; border-top: 1px solid #000; color: #000000 !important;">
                                                                                <strong>
                                                                                    <input
                                                                                        style="color: #000000 !important; font-weight: bold;"
                                                                                        type="text"
                                                                                        class="total_qty no-outline"
                                                                                        name="total_qty" id="total_qty"
                                                                                        size="5">
                                                                                </strong>
                                                                            </td>



                                                                            <td width="8%" align="center" valign="top"
                                                                                style="border-right:1px solid #000; border-top: 1px solid #000; color: #000000 !important;">
                                                                                <strong></strong></td>

                                                                            <td width="8%" align="center" valign="top"
                                                                                style="border-right:1px solid #000; border-top: 1px solid #000; color: #000000 !important;">
                                                                                <strong></strong></td>

                                                                            <td width="8%" align="center" valign="top"
                                                                                style="border-right:1px solid #000; border-top: 1px solid #000; color: #000000 !important;">
                                                                                <strong></strong></td>

                                                                            <td width="10%" align="center" valign="top"
                                                                                style="border-top: 1px solid #000; color: #000000 !important;">
                                                                                <strong>
                                                                                    <input type="text" class="form-control"
                                                                                    name="subtotal" value="{{credit.cn_sub_total}}" readonly="">
                                                                                </strong>
                                                                            </td>
                                                                        </tr>



                                            </thead>
                                        </table>

                                        <table width="100%" border="1">

                                            <tbody>
                                                <tr>
                                                    <td
                                                        style="border-right:0px solid #000; padding-left:10px; color: #000000 !important; padding-bottom: 0px solid #000; ">
                                                        <strong>TERMS &amp; CONDITIONS</strong>
                                                    </td>

                                                    <td width="33%"
                                                        style="border-right:0px solid #000; padding-left:10px; color: #000000 !important;">
                                                        <strong></strong>
                                                    </td>



                                                </tr>

                                                <tr>
                                                    <td width="50%" align="left" valign="top"
                                                        style="border-right: 0px solid #000;border-top: 0px solid #000;padding-left:10px;">
                                                        <div class="row">
                                                            <div class="col-md-4 invte"
                                                                style="color: #000000 !important;"> <b>PRICE</b> </div>
                                                            <div class="col-md-4 invte"
                                                                style="color: #000000 !important;">: EX WORK </div>
                                                            <div class="col-md-4 invte"
                                                                style="color: #000000 !important;"> </div>

                                                            <div class="col-md-4 invte"
                                                                style="color: #000000 !important;"> <b>GST</b> </div>
                                                            <div class="col-md-4 invte"
                                                                style="color: #000000 !important;">: 18% Extra </div>
                                                            <div class="col-md-4 invte"
                                                                style="color: #000000 !important;"> </div>

                                                            <div class="col-md-4 invte"
                                                                style="color: #000000 !important;"> <b>DELIVERY</b>
                                                            </div>
                                                            <div class="col-md-4 invte"
                                                                style="color: #000000 !important;">: EX STOCK</div>
                                                            <div class="col-md-4 invte"
                                                                style="color: #000000 !important;"> </div>

                                                            <div class="col-md-4 invte"
                                                                style="color: #000000 !important;"> <b>PACKING</b>
                                                            </div>
                                                            <div class="col-md-4 invte"
                                                                style="color: #000000 !important;">: </div>
                                                            <div class="col-md-4 invte"> </div>

                                                            <div class="col-md-4 invte"
                                                                style="color: #000000 !important;"> <b>REMARK</b> </div>
                                                            <div class="col-md-4 invte"
                                                                style="color: #000000 !important;">: </div>
                                                            <div class="col-md-4 invte"> </div>


                                                        </div>
                                                    </td>

                                                    <td width="50%" class="invte" align="left" valign="top"
                                                        style="padding-left:10px;border-right: 0px solid #000;border-top: 0px solid #000; color: #000000 !important;">

                                                        <div class="row">
                                                            <div class="col-md-4 invte"
                                                                style="color: #000000 !important;"> <b>P &amp; F
                                                                    CHARGES</b> </div>
                                                            <div class="col-md-4 invte"
                                                                style="color: #000000 !important;">: </div>
                                                            <div class="col-md-4 invte"
                                                                style="color: #000000 !important;"> </div>

                                                            <div class="col-md-4 invte"
                                                                style="color: #000000 !important;"> <b>INSPECTED BY</b>
                                                            </div>
                                                            <div class="col-md-4 invte"
                                                                style="color: #000000 !important;">: OUR DEPTARTMENT
                                                            </div>
                                                            <div class="col-md-4 invte"
                                                                style="color: #000000 !important;"> </div>

                                                            <div class="col-md-4 invte"
                                                                style="color: #000000 !important;"> <b>FREIGHT</b>
                                                            </div>
                                                            <div class="col-md-4 invte"
                                                                style="color: #000000 !important;">: </div>
                                                            <div class="col-md-4 invte"
                                                                style="color: #000000 !important;"> </div>

                                                            <div class="col-md-4 invte"
                                                                style="color: #000000 !important;"> <b>TRANSPORT</b>
                                                            </div>
                                                            <div class="col-md-4 invte"
                                                                style="color: #000000 !important;">: </div>
                                                            <div class="col-md-4 invte"> </div>

                                                        </div>

                                                    </td>


                                                </tr>

                                                <tr>
                                                    <td colspan="2" width="100%" align="left" valign="top"
                                                        style="border-right: 0px solid #000;border-top: 0px solid #000;padding-left:10px; color: #000000 !important;">
                                                     
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>

                                        <table width="100%" border="1">

                                            <tbody>
                                                <tr>
                                                    <td width="50%"
                                                        style="border-right:0px solid #000; padding-left:10px; color: #000000 !important;">
                                                        <strong></strong>
                                                    </td>



                                                    <td style="padding-left:10px; color: #000000 !important;">
                                                        <strong></strong>
                                                    </td>

                                                </tr>

                                                <tr>
                                                    <td width="50%" align="left" valign="top"
                                                        style="border-right: 1px solid #000;border-top: 1px solid #000;padding-left:10px;">
                                                        <div class="row">
                                                            <div class="col-md-4 invte"
                                                                style="color: #000000 !important;"> <b>CIN NO</b> </div>
                                                            <div class="col-md-8 invte"
                                                                style="color: #000000 !important;">:
                                                                U51909MH2021PTC362346 </div>


                                                            <div class="col-md-4 invte"
                                                                style="color: #000000 !important;"> <b>GST NO</b> </div>
                                                            <div class="col-md-8 invte"
                                                                style="color: #000000 !important;">: 27ABGCS2596F1Z1
                                                            </div>


                                                            <div class="col-md-4 invte"
                                                                style="color: #000000 !important;"> <b>PAN NO</b> </div>
                                                            <div class="col-md-8 invte"
                                                                style="color: #000000 !important;">: ABGCS2596F </div>

                                                        </div>
                                                    </td>

                                                    <td align="left" valign="top"
                                                        style="padding-left:10px;border-bottom:0px solid #000;border-top: 1px solid #000; color: #000000 !important;">

                                                        <div class="row">

                                                            <div class="col-md-12 invte"> </div>



                                                            <div class="col-md-12 invte" align="center">
                                                                <strong style="color: #000000 !important;">M/S KEYMECH TECHNOLOGIES</strong><br>

                                                                <img class="img-fluid d-inline-block"
                                                                    src="#"
                                                                    style="width: 100px; color: #000000 !important;"
                                                                    alt="sign"> <span class="d-block">AUTHORIZED
                                                                    SIGNATURE</span>

                                                            </div>



                                                        </div>

                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>

                                    </div>
                                </div>
                            </div>

                            <br>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>





    <script>
        const button = document.getElementById('download-button');

        button.addEventListener('click', generatePDF);

        function generatePDF() {
            // Choose the element that your content will be rendered to.
            const element = document.getElementById('quotation_pdf');
            // Choose the element and save the PDF for your user.
            html2pdf().from(element).save('Quotation');
            //window.print();
        }



    </script>

    <script type="text/javascript">
        $(document).ready(function () {
            var sum = 0;
            $(".qty").each(function () {
                sum += +this.value;
            });
            //alert(sum);

            $('.total_qty').val(sum);

            /*************************************************/

            var sum1 = 0;
            $(".amount").each(function () {
                sum1 += +this.value;
            });
            //alert(sum1);

            $('.total_amount').val((sum1).toFixed(2));

            /*************************************************/

            var sum2 = 0;
            $(".subtotal").each(function () {
                sum2 += +this.value;
            });
            //alert(sum1);

            $('.total_subtotal').val((sum2).toFixed(2));

            /*************************************************/

            var s = (sum2).toFixed(2);

            var num = s;
            var splittedNum = num.toString().split('.')
            var nonDecimal = splittedNum[0]
            var decimal = splittedNum[1]
            //var result= `AMOUNT IN WORDS INR`+ price_in_words(Number(nonDecimal))+` Paise `+price_in_words(Number(decimal))+` Only`

            if (decimal == '00') {
                var result = `AMOUNT IN WORDS INR` + price_in_words(Number(nonDecimal)) + ` Only`
            }
            else {
                var result = `AMOUNT IN WORDS INR` + price_in_words(Number(nonDecimal)) + ` Paise ` + price_in_words(Number(decimal)) + ` Only`
            }

            $('.res').text(result);

        });

        function price_in_words(price) {
            var sglDigit = ["Zero", "One", "Two", "Three", "Four", "Five", "Six", "Seven", "Eight", "Nine"],
                dblDigit = ["Ten", "Eleven", "Twelve", "Thirteen", "Fourteen", "Fifteen", "Sixteen", "Seventeen", "Eighteen", "Nineteen"],
                tensPlace = ["", "Ten", "Twenty", "Thirty", "Forty", "Fifty", "Sixty", "Seventy", "Eighty", "Ninety"],
                handle_tens = function (dgt, prevDgt) {
                    return 0 == dgt ? "" : " " + (1 == dgt ? dblDigit[prevDgt] : tensPlace[dgt])
                },
                handle_utlc = function (dgt, nxtDgt, denom) {
                    return (0 != dgt && 1 != nxtDgt ? " " + sglDigit[dgt] : "") + (0 != nxtDgt || dgt > 0 ? " " + denom : "")
                };

            var str = "",
                digitIdx = 0,
                digit = 0,
                nxtDigit = 0,
                words = [];
            if (price += "", isNaN(parseInt(price))) str = "";
            else if (parseInt(price) > 0 && price.length <= 10) {
                for (digitIdx = price.length - 1; digitIdx >= 0; digitIdx--) switch (digit = price[digitIdx] - 0, nxtDigit = digitIdx > 0 ? price[digitIdx - 1] - 0 : 0, price.length - digitIdx - 1) {
                    case 0:
                        words.push(handle_utlc(digit, nxtDigit, ""));
                        break;
                    case 1:
                        words.push(handle_tens(digit, price[digitIdx + 1]));
                        break;
                    case 2:
                        words.push(0 != digit ? " " + sglDigit[digit] + " Hundred" + (0 != price[digitIdx + 1] && 0 != price[digitIdx + 2] ? " " : "") : "");
                        break;
                    case 3:
                        words.push(handle_utlc(digit, nxtDigit, "Thousand"));
                        break;
                    case 4:
                        words.push(handle_tens(digit, price[digitIdx + 1]));
                        break;
                    case 5:
                        words.push(handle_utlc(digit, nxtDigit, "Lakh"));
                        break;
                    case 6:
                        words.push(handle_tens(digit, price[digitIdx + 1]));
                        break;
                    case 7:
                        words.push(handle_utlc(digit, nxtDigit, "Crore"));
                        break;
                    case 8:
                        words.push(handle_tens(digit, price[digitIdx + 1]));
                        break;
                    case 9:
                        words.push(0 != digit ? " " + sglDigit[digit] + " Hundred" + (0 != price[digitIdx + 1] || 0 != price[digitIdx + 2] ? " and" : " Crore") : "")
                }
                str = words.reverse().join("")
            } else str = "Zero ";
            return str

        }
    </script>

<script>
    function printDiv(divId) {
       var printContents = document.getElementById(divId).innerHTML;
       var originalContents = document.body.innerHTML;
  
       document.body.innerHTML = printContents;
  
       window.print();
  
       document.body.innerHTML = originalContents;
  }
  
  </script>

    <script type="text/javascript">
        function getitemsdetails(inputname, godown, qty, rate, hsn, uom, discount, taxrate, itemcode) {
            //alert();return;
            input = inputname.split("_");
            //alert(input);return;

            $('#' + inputname).autocomplete({
                source: function (request, response) {
                    $.ajax({
                        url: "{% url 'getitemscodedetails' %}",
                        dataType: "json",
                        type: "POST",
                        data: {
                            name_startsWith: request.term,
                            itemsdetails: input
                        },
                        success: function (data) {
                            // alert("Success")
                            response($.map(data, function (item) {
                                var code = item.split("|");
                                // console.log("mangesh")
                                // console.log(code)
                                //alert(data);
                                return {
                                    label: code[0],
                                    value: code[0],
                                    data: item
                                }
                            }));
                        }
                    });
                },
                autoFocus: true,
                minLength: 0,
                change: function (event, ui) {
                    if (ui.item == null) {
                    }
                },
                select: function (event, ui) {
                    var names = ui.item.data.split("|");
                    // console.log(names)
                    // console.log(names)
                    $('#' + inputname).val(names[0]);
                    $('#' + godown).val(names[2]);
                    //$('#'+qty).val(names[3]);
                    $('#' + qty).val('1');
                    $('#' + rate).val(names[8]);
                    $('#' + hsn).val(names[5]);
                    $('#' + discount).val(names[6]);
                    $('#' + taxrate).val(names[7]);
                    $('#' + uom).val(names[10]);
                    $('#' + itemcode).val(names[11]);

                    discountamt(inputname);

                    subtotal();

                    totaltaxamt();

                    getbillamt();
                }

            });
        }

        function getitemscodedetails(inputname, item, godown, qty, rate, hsn, uom, discount, taxrate) {
            // alert();
            input = inputname.split("_");
            //alert(input);return;

            $('#' + inputname).autocomplete({
                source: function (request, response) {
                    $.ajax({
                        url: "{% url 'getitemscodedetails' %}",
                        dataType: "json",
                        type: "POST",
                        data: {
                            name_startsWith: request.term,
                            itemsdetails: input
                        },
                        success: function (data) {
                            response($.map(data, function (item) {
                                var code = item.split("|");
                                //alert(data);
                                return {
                                    label: code[0],
                                    value: code[0],
                                    data: item
                                }
                            }));
                        }
                    });
                },
                autoFocus: true,
                minLength: 0,
                change: function (event, ui) {
                    if (ui.item == null) {
                    }
                },
                select: function (event, ui) {
                    var names = ui.item.data.split("|");
                    // console.log(names)
                    $('#' + inputname).val(names[0]);
                    $('#' + godown).val(names[2]);
                    //$('#'+qty).val(names[3]);
                    $('#' + qty).val('1');
                    $('#' + rate).val(names[8]);
                    $('#' + hsn).val(names[5]);
                    $('#' + discount).val(names[6]);
                    $('#' + taxrate).val(names[7]);
                    $('#' + uom).val(names[10]);
                    $('#' + item).val(names[11]);

                    discountamt(inputname);

                    subtotal();

                    totaltaxamt();

                    getbillamt()
                }

            });
        }

       

        function discountamt(inputname) {
            //alert(inputname);
            input = inputname.split("_");
            id_val = input[1];
            //alert(id_val);
            var rate = $('#rate_' + id_val).val();
            var discount = $('#discount_' + id_val).val();
            var qty = $('#qty_' + id_val).val();

            /*//var discountamt = rate/100;
            //var totalamt = rate-discountamt;
            var totalamt = rate-(rate*discount/100);
            $('#total_'+id_val).val(totalamt);
    
            var taxrate = $('#taxrate_'+id_val).val();
            var taxamt = totalamt*taxrate/100;
            //alert(taxamt);
    
            $('#taxamt_'+id_val).val((taxamt).toFixed(2));*/

            var item_rate = $('#item_rate').val();

            if (item_rate == 'tax_exclusive') {
                var total = rate - (rate * discount / 100);
                //alert(total);
                var totalamt = total * qty;
                //alert(totalamt);

                $('#total_' + id_val).val((totalamt).toFixed(2));

                var taxrate = $('#taxrate_' + id_val).val();
                var taxamt = totalamt * taxrate / 100;
                //alert(taxamt);

                $('#taxamt_' + id_val).val((taxamt).toFixed(2));
            }

            if (item_rate == 'tax_inclusive') {
                var total = rate - (rate * discount / 100);
                //alert(totalamt);

                var totalamt = total * qty;
                //alert(totalamt);

                //t = $('#total_'+id_val).val((totalamt).toFixed(2));

                var taxrate = $('#taxrate_' + id_val).val();
                var taxamt = totalamt * taxrate / 100;
                //alert(taxamt);

                $('#taxamt_' + id_val).val((taxamt).toFixed(2));

                t = totalamt - taxamt;

                $('#total_' + id_val).val((t).toFixed(2));
            }

            subtotal();

            getbillamt()
        }

        function taxrate(inputname) {
            //alert(inputname);
            input = inputname.split("_");
            id_val = input[1];
            //alert(id_val);

            var rate = $('#rate_' + id_val).val();
            var qty = $('#qty_' + id_val).val();
            var discount = $('#discount_' + id_val).val();

            /*//var discountamt = rate/100;
            //var totalamt = rate-discountamt;
            var totalamt = rate-(rate*discount/100);
            $('#total_'+id_val).val(totalamt);
    
            var taxrate = $('#taxrate_'+id_val).val();
            var taxamt = rate*taxrate/100;
            //alert(taxamt);
    
            $('#taxamt_'+id_val).val((taxamt).toFixed(2));*/

            var item_rate = $('#item_rate').val();

            if (item_rate == 'tax_exclusive') {
                var total = rate - (rate * discount / 100);
                //alert(total);
                var totalamt = total * qty;
                //alert(totalamt);

                $('#total_' + id_val).val((totalamt).toFixed(2));

                var taxrate = $('#taxrate_' + id_val).val();
                var taxamt = totalamt * taxrate / 100;
                //alert(taxamt);

                $('#taxamt_' + id_val).val((taxamt).toFixed(2));
            }

            if (item_rate == 'tax_inclusive') {
                var total = rate - (rate * discount / 100);
                //alert(totalamt);

                var totalamt = total * qty;
                //alert(totalamt);

                //t = $('#total_'+id_val).val((totalamt).toFixed(2));

                var taxrate = $('#taxrate_' + id_val).val();
                var taxamt = totalamt * taxrate / 100;
                //alert(taxamt);

                $('#taxamt_' + id_val).val((taxamt).toFixed(2));

                t = totalamt - taxamt;

                $('#total_' + id_val).val((t).toFixed(2));
            }

            subtotal();

            getbillamt();

            totaltaxamt()
        }

        /*function totaltaxamt()
        {
    
            var sum1 = 0;
            $(".totaltaxamt").each(function()
            {
              sum1 += +this.value;
            });
    
            taxamt = sum1/2;
    
            $('#cgst').val(taxamt);
            $('#sgst').val(taxamt);
        }*/

        function totaltaxamt() {
            place_of_supply = $('#place_of_supply').val();

            taxrate_0 = $('#taxrate_0').val();
            //alert(taxrate_0);

            taxrate = taxrate_0 / 2;

            if (place_of_supply == 23) {
                var sum1 = 0;
                $(".totaltaxamt").each(function () {
                    sum1 += +this.value;
                });

                taxamt = sum1 / 2;

                $('#cgst').val(taxamt);
                $('#sgst').val(taxamt);
                $('#igst').val("0.00");

                $('#cgstper').val(taxrate + '%');
                $('#sgstper').val(taxrate + '%');
                $('#igstper').val("0%");
            }
            else {
                var sum1 = 0;
                $(".totaltaxamt").each(function () {
                    sum1 += +this.value;
                });

                taxamt = sum1 / 2;

                $('#cgst').val("0.00");
                $('#sgst').val("0.00");
                $('#igst').val(sum1);

                $('#cgstper').val("0%");
                $('#sgstper').val("0%");
                $('#igstper').val(taxrate_0 + '%');
            }

        }

        function qty(inputname) {
            input = inputname.split("_");
            id_val = input[1];
            //alert(id_val);

            var rate = $('#rate_' + id_val).val();
            var qty = $('#qty_' + id_val).val();
            var discount = $('#discount_' + id_val).val();

            /*//var discountamt = rate/100;
            //var total = rate-discountamt;
            var total = rate-(rate*discount/100);
            var totalamt = total*qty;
            //alert(totalamt);
    
            $('#total_'+id_val).val((totalamt).toFixed(2));
    
            var taxrate = $('#taxrate_'+id_val).val();
            var taxamt = totalamt*taxrate/100;
            //alert(taxamt);
    
            $('#taxamt_'+id_val).val((taxamt).toFixed(2));*/

            var item_rate = $('#item_rate').val();

            if (item_rate == 'tax_exclusive') {
                //var discountamt = rate/100;
                //var total = rate-discountamt;
                var total = rate - (rate * discount / 100);
                //alert(total);
                var totalamt = total * qty;
                //alert(totalamt);

                $('#total_' + id_val).val((totalamt).toFixed(2));

                var taxrate = $('#taxrate_' + id_val).val();
                var taxamt = totalamt * taxrate / 100;
                //alert(taxamt);

                $('#taxamt_' + id_val).val((taxamt).toFixed(2));
            }

            if (item_rate == 'tax_inclusive') {
                //var discountamt = rate/100;
                //var total = rate-discountamt;
                var total = rate - (rate * discount / 100);
                //alert(total);
                var totalamt = total * qty;
                //alert(totalamt);

                //t = $('#total_'+id_val).val((totalamt).toFixed(2));

                var taxrate = $('#taxrate_' + id_val).val();
                var taxamt = totalamt * taxrate / 100;
                //alert(taxamt);

                $('#taxamt_' + id_val).val((taxamt).toFixed(2));

                t = totalamt - taxamt;

                $('#total_' + id_val).val((t).toFixed(2));
            }

            subtotal();

            getbillamt();
        }

        function rate(inputname) {
            input = inputname.split("_");
            id_val = input[1];
            //alert(id_val);

            var rate = $('#rate_' + id_val).val();
            var qty = $('#qty_' + id_val).val();
            var discount = $('#discount_' + id_val).val();

            /*//var discountamt = rate/100;
            //var total = rate-discountamt;
            var total = rate-(rate*discount/100);
            var totalamt = total*qty;
            //alert(totalamt);
    
            $('#total_'+id_val).val((totalamt).toFixed(2));
    
            var taxrate = $('#taxrate_'+id_val).val();
            var taxamt = totalamt*taxrate/100;
            //alert(taxamt);
    
            $('#taxamt_'+id_val).val((taxamt).toFixed(2));*/

            var item_rate = $('#item_rate').val();

            if (item_rate == 'tax_exclusive') {
                //var discountamt = rate/100;
                //var total = rate-discountamt;
                var total = rate - (rate * discount / 100);
                //alert(total);
                var totalamt = total * qty;
                //alert(totalamt);

                $('#total_' + id_val).val((totalamt).toFixed(2));

                var taxrate = $('#taxrate_' + id_val).val();
                var taxamt = totalamt * taxrate / 100;
                //alert(taxamt);

                $('#taxamt_' + id_val).val((taxamt).toFixed(2));
            }

            if (item_rate == 'tax_inclusive') {
                //var discountamt = rate/100;
                //var total = rate-discountamt;
                var total = rate - (rate * discount / 100);
                //alert(total);
                var totalamt = total * qty;
                //alert(totalamt);

                //t = $('#total_'+id_val).val((totalamt).toFixed(2));

                var taxrate = $('#taxrate_' + id_val).val();
                var taxamt = totalamt * taxrate / 100;
                //alert(taxamt);

                $('#taxamt_' + id_val).val((taxamt).toFixed(2));

                t = totalamt - taxamt;

                $('#total_' + id_val).val((t).toFixed(2));
            }

            subtotal();

            getbillamt();

            totaltaxamt();
        }

        /*function subtotal()
        {
            var sum = 0;
            $(".totalamt").each(function()
            {
              sum += +this.value;
            });
            //alert(sum);
    
            $('.subtotal').val((sum).toFixed(2));
            //$('.finalamt').val(parseInt(sum));
    
            var sum1 = 0;
            $(".taxamt").each(function()
            {
              sum1 += +this.value;
            });
    
            $('.totaltaxamt').val(sum1);
    
            finalamt = sum+sum1;
            $('.finalamt').val(finalamt);
        }*/

        function subtotal() {
            var freight = $('#freight').val();
            //alert(freight);

            var totalamt = 0;
            $(".totalamt").each(function () {
                totalamt += +this.value;
            });
            //alert(totalamt);

            sub_total = parseInt(freight) + totalamt;

            $('.subtotal').val(sub_total);
            //$('.finalamt').val(parseInt(totalamt));

            taxrate = $('#taxrate_0').val();

            gst_amount = (sub_total * taxrate) / 100

            var sum1 = 0;
            $(".taxamt").each(function () {
                sum1 += +this.value;
            });

            $('.totaltaxamt').val(gst_amount);

            finalamt = totalamt + sum1;
            $('.finalamt').val(finalamt);
        }

        function getbillamt() {
            var sum = 0;
            $(".billamt").each(function () {
                sum += +this.value;
            });
            //alert(sum);

            $('.finalamt').val((sum).toFixed(2));
        }

        $(document).on('change', '#item_rate', function () {
            var item_rate = $(this).val();
            //alert(item_rate);

            for (var i = 0; i < 2; i++) {
                //alert(i);

                if (item_rate == 'tax_inclusive') {
                    qty('qty_' + i);
                    rate('rate_' + i);
                    discountamt('discount_' + i);
                }

                if (item_rate == 'tax_exclusive') {
                    qty('qty_' + i);
                    rate('rate_' + i);
                    discountamt('discount_' + i);
                }
            }


        });

        $(document).on('keyup', '#freight', function () {
            subtotal();

            totaltaxamt();
            getbillamt();
        });
    </script>

</body>
{% endblock main_content %}