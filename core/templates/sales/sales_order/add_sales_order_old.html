{% extends 'dashboard/base_template.html' %}
{% block title %}
Ecoway
{% endblock %}

{% block custom_css %}


<style>
    /* Inactive tab styles */
    .nav-tabs.nav-tabs-bottom .nav-item .nav-link {
        color: #ccc;
        /* Faint gray color for inactive tabs */
    }

    /* Active tab style */
    .nav-tabs.nav-tabs-bottom .nav-item .nav-link.active {
        color: #000;
        /* Black color for active tab */
    }
</style>
{% endblock custom_css %}

{% block main_content %}
<div class="page-wrapper" style="min-height: 367px;">
    <div class="content container-fluid">
        <div class="page-header invoices-page-header">
            <div class="row align-items-center">
                <div class="col">
                    <h3> <a href="{% url 'sales_order_list' %}" style="margin-right: 10px;"><i class="fa fa-arrow-left"
                                data-bs-toggle="tooltip" title="" data-bs-original-title="Back"
                                aria-label="fa fa-arrow-left"></i></a> Add Sales Order</h3>
                </div>
                <div class="col-auto"> </div>
            </div>
        </div>
        <div class="col-md-12">
            <div class="card invoices-add-card">
                <div class="card-body">
                    <form class="invoices-form" method="post" id="sales_order_form" action="{% url 'add_sales_order' %}"
                        enctype="multipart/form-data" autocomplete="off">
                        <div class="invoices-main-form">
                            {% csrf_token %}
                            <div class="row">

                                <!-- <div class="col-xl-2 col-md-6 col-sm-12 col-12">
                                    <div class="form-group">
                                        <label>Sales Order No</label>
                                        <input type="text" class="form-control" name="sales_order_no" id="sales_order_no" >
                                    </div>
                                </div> -->

                                <div class="col-xl-2 col-md-6 col-sm-12 col-12">
                                    <div class="form-group">
                                        <div class=" ">
                                            <span>
                                                <label>Sale Order Date</label>
                                                <input class="form-control datetimepicker" type="text" name="so_date"
                                                    id="sales_order_date" value="04-12-2023" placeholder="04-12-2023" required>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-xl-2 col-md-6 col-sm-12 col-12">
                                    <div class="form-group">
                                        <label>Payment Term</label>
                                        <select class="form-control" name="payment_term" id="payment_term">
                                            <option value="">Select Payment Term</option>

                                            <option value="AGAINST PROFORMA INVOICE">AGAINST PROFORMA INVOICE</option>

                                            <option value="100% ADVANCE">100% ADVANCE</option>

                                            <option value="50% ADVANCE BALANCE AGAINST DELIVERY">50% ADVANCE BALANCE AGAINST DELIVERY</option>

                                            <option value="7 DAYS">7 DAYS</option>

                                            <option value="15 DAYS">15 DAYS</option>

                                            <option value="30 DAYS">30 DAYS</option>

                                            <option value="45 DAYS">45 DAYS</option>

                                            <option value="60 DAYS">60 DAYS</option>

                                            <option value="90 DAYS">90 DAYS</option>

                                            <option value="120 DAYS">120 DAYS</option>

                                            <option value="AGAINST TAX INVOICE">AGAINST TAX INVOICE</option>

                                        </select>
                                    </div>
                                </div>
                                <div class="col-xl-2 col-md-6 col-sm-12 col-12">
                                    <div class="form-group">
                                        <label>Customer Name</label>
                                        <div data-select2-id="4">
                                            <div data-select2-id="4">
                                                <select id="customer_Name_id" name="customer_Name" required class="form-select">
                                                    <option value="">Choose...</option>
                                                    {% for i in customer_name %}
                                                    <option value="{{i.id}}">{{i.customer}}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-xl-2 col-md-6 col-sm-12 col-12">
                                    <div class="form-group">
                                        <div class=" ">
                                            <span>
                                                <label>Due Date</label>
                                                <input class="form-control datetimepicker" type="text" name="due_date"
                                                    id="due_date" value="04-12-2023" placeholder="Enter Date" required>
                                            </span>
                                        </div>
                                    </div>
                                </div>

             

                                <div class="col-xl-2 col-md-6 col-sm-12 col-12">
                                    <div class="form-group">
                                        <label>Place Of Supply </label>
                                        <select class="form-control" name="place_of_supply" id="place_of_supply"
                                            onchange="totaltaxamt();">
                                            <option value="">State/Province</option>
                                            <option value="ANDAMAN AND NICOBAR ISLANDS">ANDAMAN AND NICOBAR ISLANDS</option>

                                            <option value="ANDHRA PRADESH (BEFORE DIVISION)">ANDHRA PRADESH (BEFORE DIVISION)</option>

                                            <option value="ANDHRA PRADESH (NEW)">ANDHRA PRADESH (NEW)</option>

                                            <option value="ARUNACHAL PRADESH">ARUNACHAL PRADESH</option>

                                            <option value="ASSAM">ASSAM</option>

                                            <option value="BIHAR">BIHAR</option>

                                            <option value="CHANDIGARH">CHANDIGARH</option>

                                            <option value="CHHATTISGARH">CHHATTISGARH</option>

                                            <option value="DADRA AND NAGAR HAVELI AND DAMAN AND DIU">DADRA AND NAGAR HAVELI AND DAMAN AND DIU</option>

                                            <option value="DAMAN AND DIU">DAMAN AND DIU</option>

                                            <option value="DELHI">DELHI</option>

                                            <option value="GOA">GOA</option>

                                            <option value="GUJARAT">GUJARAT</option>

                                            <option value="HARYANA">HARYANA</option>

                                            <option value="HIMACHAL PRADESH">HIMACHAL PRADESH</option>

                                            <option value="JAMMU AND KASHMIR">JAMMU AND KASHMIR</option>

                                            <option value="JHARKHAND">JHARKHAND</option>

                                            <option value="KARNATAKA">KARNATAKA</option>

                                            <option value="KERALA">KERALA</option>

                                            <option value="LADAKH">LADAKH</option>

                                            <option value="LAKSHADWEEP">LAKSHADWEEP</option>

                                            <option value="MADHYA PRADESH">MADHYA PRADESH</option>

                                            <option value="MAHARASHTRA">MAHARASHTRA</option>

                                            <option value="MANIPUR">MANIPUR</option>

                                            <option value="MEGHALAYA">MEGHALAYA</option>

                                            <option value="MIZORAM">MIZORAM</option>

                                            <option value="NAGALAND">NAGALAND</option>

                                            <option value="ODISHA">ODISHA</option>

                                            <option value="OTHER TERRITORY">OTHER TERRITORY</option>

                                            <option value="PUDUCHERRY">PUDUCHERRY</option>

                                            <option value="PUNJAB">PUNJAB</option>

                                            <option value="RAJASTHAN">RAJASTHAN</option>

                                            <option value="SIKKIM">SIKKIM</option>

                                            <option value="TAMIL NADU">TAMIL NADU</option>

                                            <option value="TELANGANA">TELANGANA</option>

                                            <option value="TRIPURA">TRIPURA</option>

                                            <option value="UTTAR PRADESH">UTTAR PRADESH</option>

                                            <option value="UTTARAKHAND">UTTARAKHAND</option>

                                            <option value="WEST BENGAL">WEST BENGAL</option>

                                        </select>
                                    </div>
                                </div>

                                <div class="col-xl-2 col-md-6 col-sm-12 col-12">
                                    <div class="form-group">
                                        <label>Destination</label>
                                        <input type="text" class="form-control" name="destination" id="destination">
                                    </div>
                                </div>

                                <div class="col-xl-2 col-md-6 col-sm-12 col-12">
                                    <div class="form-group">
                                        <label style="color:black">Dispatch Through</label>
                                        <div>
                                            <select class="form-control" name="transporter_name" id="transporter_name">
                                                <option value="" hidden>Select Transporter </option>
                                                <option value="MAHAVIR COURIER">MAHAVIR COURIER</option>

                                                <option value="MARUTI COURIER">MARUTI COURIER</option>

                                                <option value="PROFESSIONAL COURIER">PROFESSIONAL COURIER</option>

                                                <option value="GUJRAT GOODS SERVICE">GUJRAT GOODS SERVICE</option>

                                                <option value="LALJI MULJI TRANPORT CO.">LALJI MULJI TRANPORT CO.</option>

                                                <option value="AVINASH CARGO PVT LTD">AVINASH CARGO PVT LTD</option>

                                                <option value="ASHOK LOGISTICS">ASHOK LOGISTICS</option>

                                                <option value="ASHOK TRANSPORT CO.">ASHOK TRANSPORT CO.</option>

                                                <option value="SANJAY TEMPO DAILY SERVICE">SANJAY TEMPO DAILY SERVICE</option>

                                                <option value="TIRUPATI LOGISTIC">TIRUPATI LOGISTIC</option>

                                                <option value="CHINTAMANI TRANPORT SERVICES">CHINTAMANI TRANPORT SERVICES</option>

                                                <option value="DYANESHWAR V PATIL">DYANESHWAR V PATIL</option>

                                            </select>
                                        </div>
                                    </div>
                                </div>



                                <div class="col-xl-2 col-md-6 col-sm-12 col-12">
                                    <div class="form-group">
                                        <label>Sales Person</label>
                                        <input type="text" class="form-control" name="sales_person" id="sales_person">
                                    </div>
                                </div>

                                <div class="col-xl-2 col-md-6 col-sm-12 col-12">
                                    <div class="form-group">
                                        <label>Invoice Type</label>
                                        <select class="form-control" name="invoice_type" id="invoice_type">
                                            <option value="">Select Invoice Type</option>

                                            <option value="1">DEEMED EXPORTS</option>

                                            <option value="2">SEZ SUPPLIES WITH PAYMENT</option>

                                            <option value="3">SEZ SUPPLY WITHOUT PAYMENT</option>

                                            <option value="4">SUPPLY ATTRACT REVRSE CHARGE</option>

                                            <option value="5">INTRA-STATE SUPPLIES ATTRACTING IGST</option>

                                            <option value="6">REGULAR</option>

                                        </select>
                                    </div>
                                </div>

                                <div class="col-xl-2 col-md-6 col-sm-12 col-12">
                                    <div class="form-group">
                                        <label>Delivery Type</label>
                                        <div>
                                            <select class="form-control" name="delivery_type" id="delivery_type">
                                                <option value="">Select Delivery Type </option>
                                                <option value="1">PAID</option>

                                                <option value="2">TO PAY</option>

                                                <option value="3">DOOR DELIVERY</option>

                                                <option value="4">SELF COLLECTION</option>

                                            </select>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-xl-2 col-md-6 col-sm-12 col-12">
                                    <div class="form-group">
                                        <div class=" ">
                                            <span>
                                                <label>Buyer Order No.</label>
                                                <input class="form-control" type="text" name="buyer_order_no"
                                                    id="buyer_order_no">
                                            </span>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-xl-2 col-md-6 col-sm-12 col-12">
                                    <div class="form-group">
                                        <div class=" ">
                                            <span>
                                                <label>Buyer Order Date</label>
                                                <input class="form-control datetimepicker" type="text"
                                                    name="buyer_order_date" id="buyer_order_date" value="04-12-2023"
                                                    placeholder="04-12-2023">
                                            </span>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>Shipping Address</label>
                                        <select class="form-select" name="shipping_address" id="shipping_address">
                                            <option value="">Select Shipping Address</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="col-xl-2 col-md-6 col-sm-12 col-12">
                                    <div class="form-group">
                                        <div class=" ">
                                            <span>
                                                <label>Freight</label>
                                                <input class="form-control" type="text" name="freight" id="freight"
                                                    value="0.00">
                                            </span>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-xl-2 col-md-6 col-sm-12 col-12">
                                    <div class="form-group">
                                        <div class=" ">
                                            <span>
                                                <label>Delivery Challan No. 1</label>
                                                <input class="form-control" type="text" name="dc_no_1" id="dc_no_1">
                                            </span>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-xl-2 col-md-6 col-sm-12 col-12">
                                    <div class="form-group">
                                        <div class=" ">
                                            <span>
                                                <label>Delivery Challan Date 1</label>
                                                <input class="form-control datetimepicker" type="text" name="dc_date_1"
                                                    id="dc_date_1" value="04-12-2023" placeholder="04-12-2023">
                                            </span>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-xl-2 col-md-6 col-sm-12 col-12">
                                    <div class="form-group">
                                        <div class=" ">
                                            <span>
                                                <label>Delivery Challan No. 2</label>
                                                <input class="form-control" type="text" name="dc_no_2" id="dc_no_2">
                                            </span>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-xl-2 col-md-6 col-sm-12 col-12">
                                    <div class="form-group">
                                        <div class=" ">
                                            <span>
                                                <label>Delivery Challan Date 2</label>
                                                <input class="form-control datetimepicker" type="text" name="dc_date_2"
                                                    id="dc_date_2" value="04-12-2023" placeholder="04-12-2023">
                                            </span>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-xl-2 col-md-6 col-sm-12 col-12">
                                    <div class="form-group">
                                        <div class=" ">
                                            <span>
                                                <label>Delivery Challan No. 3</label>
                                                <input class="form-control" type="text" name="dc_no_3" id="dc_no_3">
                                            </span>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-xl-2 col-md-6 col-sm-12 col-12">
                                    <div class="form-group">
                                        <div class=" ">
                                            <span>
                                                <label>Delivery Challan Date 3</label>
                                                <input class="form-control datetimepicker" type="text" name="dc_date_3"
                                                    id="dc_date_3" value="04-12-2023" placeholder="04-12-2023">
                                            </span>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-xl-2 col-md-6 col-sm-12 col-12">
                                    <div class="form-group">
                                        <div class=" ">
                                            <span>
                                                <label>Delivery Challan No. 4</label>
                                                <input class="form-control" type="text" name="dc_no_4" id="dc_no_4">
                                            </span>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-xl-2 col-md-6 col-sm-12 col-12">
                                    <div class="form-group">
                                        <div class=" ">
                                            <span>
                                                <label>Delivery Challan Date 4</label>
                                                <input class="form-control datetimepicker" type="text" name="dc_date_4"
                                                    id="dc_date_4" value="04-12-2023" placeholder="04-12-2023">
                                            </span>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-xl-2 col-md-6 col-sm-12 col-12">
                                    <div class="form-group">
                                        <div class=" ">
                                            <span>
                                                <label>Invoice No. 1</label>
                                                <input class="form-control" type="text" name="invoice_no_1"
                                                    id="invoice_no_1">
                                            </span>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-xl-2 col-md-6 col-sm-12 col-12">
                                    <div class="form-group">
                                        <div class=" ">
                                            <span>
                                                <label>Invoice Date 1</label>
                                                <input class="form-control datetimepicker" type="text"
                                                    name="invoice_date_1" id="invoice_date_1" value="04-12-2023"
                                                    placeholder="04-12-2023">
                                            </span>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-xl-2 col-md-6 col-sm-12 col-12">
                                    <div class="form-group">
                                        <div class=" ">
                                            <span>
                                                <label>Invoice No. 2</label>
                                                <input class="form-control" type="text" name="invoice_no_2"
                                                    id="invoice_no_2">
                                            </span>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-xl-2 col-md-6 col-sm-12 col-12">
                                    <div class="form-group">
                                        <div class=" ">
                                            <span>
                                                <label>Invoice Date 2</label>
                                                <input class="form-control datetimepicker" type="text"
                                                    name="invoice_date_2" id="invoice_date_2" value="04-12-2023"
                                                    placeholder="04-12-2023">
                                            </span>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-xl-2 col-md-6 col-sm-12 col-12">
                                    <div class="form-group">
                                        <div class=" ">
                                            <span>
                                                <label>Invoice No. 3</label>
                                                <input class="form-control" type="text" name="invoice_no_3"
                                                    id="invoice_no_3">
                                            </span>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-xl-2 col-md-6 col-sm-12 col-12">
                                    <div class="form-group">
                                        <div class=" ">
                                            <span>
                                                <label>Invoice Date 3</label>
                                                <input class="form-control datetimepicker" type="text"
                                                    name="invoice_date_3" id="invoice_date_3" value="04-12-2023"
                                                    placeholder="04-12-2023">
                                            </span>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-xl-2 col-md-6 col-sm-12 col-12">
                                    <div class="form-group">
                                        <div class=" ">
                                            <span>
                                                <label>Invoice No. 4</label>
                                                <input class="form-control" type="text" name="invoice_no_4"
                                                    id="invoice_no_4">
                                            </span>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-xl-2 col-md-6 col-sm-12 col-12">
                                    <div class="form-group">
                                        <div class=" ">
                                            <span>
                                                <label>Invoice Date 4</label>
                                                <input class="form-control datetimepicker" type="text"
                                                    name="invoice_date_4" id="invoice_date_4" value="04-12-2023"
                                                    placeholder="04-12-2023">
                                            </span>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-xl-2 col-md-6 col-sm-12 col-12">
                                    <div class="form-group">
                                        <div class=" ">
                                            <span>
                                                <label>Eway Bill No. 1</label>
                                                <input class="form-control" type="text" name="eway_bill_no_1"
                                                    id="eway_bill_no_1">
                                            </span>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-xl-2 col-md-6 col-sm-12 col-12">
                                    <div class="form-group">
                                        <div class=" ">
                                            <span>
                                                <label>Eway Bill No. 2</label>
                                                <input class="form-control" type="text" name="eway_bill_no_2"
                                                    id="eway_bill_no_2">
                                            </span>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-xl-2 col-md-6 col-sm-12 col-12">
                                    <div class="form-group">
                                        <div class=" ">
                                            <span>
                                                <label>Eway Bill No. 3</label>
                                                <input class="form-control" type="text" name="eway_bill_no_3"
                                                    id="eway_bill_no_3">
                                            </span>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-xl-2 col-md-6 col-sm-12 col-12">
                                    <div class="form-group">
                                        <div class=" ">
                                            <span>
                                                <label>Eway Bill No. 4</label>
                                                <input class="form-control" type="text" name="eway_bill_no_4"
                                                    id="eway_bill_no_4">
                                            </span>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-lg-2" style="visibility: hidden;">
                                    <div class="form-group">
                                        <label>Item Rates Are </label>
                                        <select class="form-control" name="item_rate" id="item_rate">
                                            <option value="tax_exclusive">Tax Exclusive</option>
                                            <option value="tax_inclusive">Tax Inclusive </option>
                                        </select>
                                    </div>
                                </div>

                                <!-- <div class="col-lg-2 ">
                                    <div class="form-group">
                                        <label>Sales Person</label>
                                        <select class="form-control" name="item_rate" id="item_rate">
                                            <option value="">Search Sales Person</option>
                                            <option value="">Tax Inclusive </option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-lg-2 ">
                                    <div class="form-group">
                                        <label>Sales Person</label>
                                        <select class="form-control" name="item_rate" id="item_rate">
                                            <option value="">Enter Sales Person</option>
                                            <option value="">Tax Inclusive </option>
                                        </select>
                                    </div>
                                </div> -->
                                <div class="rowbb">
                                    <div class="invoice-add-table">
                                        <div class="table-responsive">
                                            <table class="table table-center add-table-items">
                                                <thead>
                                                    <tr>
                                                        <th>Item Code</th>
                                                        <th width="180px">Description of Goods</th>
                                                        <th>Godown</th>
                                                        <th>HSN</th>
                                                        <th>Qty</th>
                                                        <th>UOM</th>
                                                        <th>Unit Price</th>
                                                        <th>Disc(%)</th>
                                                        <th>Tax Rate</th>
                                                        <th>Tax Amt</th>
                                                        <th>Total</th>
                                                        <th>Actions</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <input type="hidden" name="iid[]" class="iid" value="0">
                                                    <tr class="add-row">
                                                        <td><input type="text" class="form-control" name="itemcode_0"
                                                                id="itemcode_0"
                                                                onkeyup="getitemscodedetails('itemcode_0','item_0','godown_0','qty_0','rate_0','hsn_0','uom_0','discount_0','taxrate_0');">
                                                        </td>

                                                        <td><input type="text" class="form-control" name="item_0"
                                                                id="item_0"
                                                                onkeyup="getitemsdetails('item_0','godown_0','qty_0','rate_0','hsn_0','uom_0','discount_0','taxrate_0','itemcode_0');"
                                                                placeholder=" "> 
                                                        </td>

                                                        <!-- <td><input type="text" class="form-control" name="godown_0" id="godown_0"></td> -->

                                                        <td width="150">
                                                            <select class="form-select" name="godown_0" id="godown_0">
                                                                <option value="">Select Godown</option>
                                                                {% for i in godown_name %}
                                                                <option value="{{i.id}}">{{i.name}}</option>
                                                                {% endfor %}
                                                            </select>
                                                        </td>

                                                        <td><input type="text" class="form-control" name="hsn_0"
                                                                id="hsn_0"></td>

                                                        <td><input type="text" class="form-control" name="qty_0"
                                                                id="qty_0" onkeyup="qty('qty_0')"> </td>

                                                        <td><input type="text" class="form-control" name="uom_0"
                                                                id="uom_0"></td>

                                                        <td><input type="text" class="form-control" name="rate_0"
                                                                id="rate_0" onkeyup="rate('rate_0')"></td>

                                                        <td><input type="text" class="form-control" name="discount_0"
                                                                id="discount_0" onkeyup="discountamt('discount_0')">
                                                        </td>

                                                        <td><input type="text" class="form-control taxrate_0"
                                                                name="taxrate_0" id="taxrate_0"
                                                                onkeyup="taxrate('taxrate_0')"></td>

                                                        <td><input type="text" class="form-control taxamt"
                                                                name="taxamt_0" id="taxamt_0"></td>

                                                        <td><input type="text" class="form-control totalamt"
                                                                name="total_0" id="total_0"></td>

                                                        <td class="add-remove text-end"> <a href="javascript:void(0);"
                                                                class="add-btn me-2"><i
                                                                    class="fas fa-plus-circle"></i></a> <a
                                                                href="javascript:void(0);" class="remove-btn"><i
                                                                    class="fe fe-trash-2"></i></a></td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-lg-7 col-md-6">
                                            <!-- <div class="form-group float-end mb-0"> <button class="btn btn-primary" type="submit">Add Item</button> </div> -->
                                            <div class="invoice-fields">
                                                <h4 class="field-title">Terms and Conditions</h4> <br> <textarea
                                                    class="form-control" name="note"></textarea>
                                            </div>
                                        </div>
                                        <div class="col-lg-5 col-md-6">
                                            <div class="invoice-total-card">
                                                <h4 class="invoice-total-title">Summary</h4>
                                                <div class="invoice-total-box">
                                                    <div class="invoice-total-inner">



                                                        <div class="row">
                                                            <div class="col-lg-6">
                                                                <p>Sub Total </p>
                                                            </div>
                                                            <div class="col-lg-6 ">
                                                                <input type="text" class="subtotal billamt utrt1"
                                                                    name="subtotal" value="0.00" readonly="">
                                                            </div>
                                                        </div>

                                                        <!-- <div class="row">
                                                            <div class="col-lg-6"><p>Freight </p></div>
                                                            <div class="col-lg-6 ">
                                                                <input type="text" class=" billamt utrt1" name="freight" value="0.00" onkeyup="getbillamt();">
                                                            </div>
                                                        </div> -->

                                                        <div class="row">
                                                            <!-- <div class="col-lg-6"><p>Tax Amt</p></div> -->
                                                            <div class="col-lg-6 ">
                                                                <input type="hidden" class="totaltaxamt billamt utrt1"
                                                                    name="total_taxamt" id="total_taxamt" value="0.00"
                                                                    readonly="">
                                                            </div>
                                                        </div>

                                                        <div class="row">
                                                            <div class="col-lg-6">
                                                                <p>CGST @ <input type="text" name="cgstper" id="cgstper"
                                                                        value="0%" size="1" class="no-outline"></p>
                                                            </div>
                                                            <div class="col-lg-6 ">
                                                                <input type="text" class="utrt1" name="cgst" id="cgst"
                                                                    value="0.00" readonly="">
                                                            </div>
                                                        </div>

                                                        <div class="row">
                                                            <div class="col-lg-6">
                                                                <p>SGST @ <input type="text" name="sgstper" id="sgstper"
                                                                        value="0%" size="1" class="no-outline"></p>
                                                            </div>
                                                            <div class="col-lg-6 ">
                                                                <input type="text" class="utrt1" name="sgst" id="sgst"
                                                                    value="0.00" readonly="">
                                                            </div>
                                                        </div>

                                                        <div class="row">
                                                            <div class="col-lg-6">
                                                                <p>IGST @ <input type="text" name="igstper" id="igstper"
                                                                        value="0%" size="1" class="no-outline"></p>
                                                            </div>
                                                            <div class="col-lg-6 ">
                                                                <input type="text" class="utrt1" name="igst" id="igst"
                                                                    value="0.00" readonly="">
                                                            </div>
                                                        </div>

                                                        <div class="row">
                                                            <div class="col-lg-6">
                                                                <p>Adjustments</p>
                                                            </div>
                                                            <div class="col-lg-6 ">
                                                                <input class="billamt utrt1" type="text"
                                                                    name="adjustment" id="adjustment" value="0.00"
                                                                    onkeyup="getbillamt();">
                                                            </div>
                                                        </div>

                                                        <div class="row">
                                                            <div class="col-lg-6">
                                                                <p>TCS on Sale Of any Goods </p>
                                                            </div>
                                                            <div class="col-lg-6 ">
                                                                <input class="billamt utrt1" type="text"
                                                                    name="sale_of_good" id="sale_of_good" value="0.00"
                                                                    onkeyup="getbillamt();">
                                                            </div>
                                                        </div>

                                                        <div class="invoice-total-footer">
                                                            <h4>Total Amount <input class="finalamt utrt1" type="text"
                                                                    name="totalamt" value="0.00" readonly=""></h4>
                                                        </div>

                                                    </div>
                                                </div>

                                                <div class="upload-sign">
                                                    <div class="form-group float-end mb-0"> <a
                                                            href="{% url 'sales_order_list' %}"
                                                            class="btn btn-primary">Cancel</a></div>
                                                    <div class="form-group float-end mb-0"> <button
                                                            class="btn btn-primary" type="submit" id="btn_submit"
                                                            name="btn_submit">Save</button> </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row col-sm-6 p-5">
                                    <div class="success_message row"></div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock main_content %}
{% block custom_js %}


<script type="text/javascript">
    $(".add-table-items").on('click', '.remove-btn', function () {
        $(this).closest('.add-row').remove();

        subtotal();

        getbillamt();

        totaltaxamt();

        return false;
    });

    var i = 1;
    $(document).on("click", ".add-btn", function () {
        var experiencecontent = '<tr class="add-row">' +
            '<input type="hidden" name="iid[]" class="iid" value="' + i + '">' +

            '<td>' +
            '<input type="text" class="form-control" name="itemcode_' + i + '" id="itemcode_' + i + '" onkeyup="getitemscodedetails(\'itemcode_' + i + '\',\'item_' + i + '\',\'godown_' + i + '\',\'qty_' + i + '\',\'rate_' + i + '\',\'hsn_' + i + '\',\'uom_' + i + '\',\'discount_' + i + '\',\'taxrate_' + i + '\'); ">' +
            '</td>' +

            '<td>' +
            '<input type="text" name="item_' + i + '" id="item_' + i + '" class="form-control" onkeyup="getitemsdetails(\'item_' + i + '\',\'godown_' + i + '\',\'qty_' + i + '\',\'rate_' + i + '\',\'hsn_' + i + '\',\'uom_' + i + '\',\'discount_' + i + '\',\'taxrate_' + i + '\',\'itemcode_' + i + '\'); ">' +
            '</td>' +

            '<td>' +
            '<select class="form-select" name="godown_' + i + '" id="godown_' + i + '" >' +
            '<option value="">Select Godown</option>' +
            '{% for godown in godown_name %}'+
            '<option value="{{ godown.id }}">{{ godown.name }}</option>' +
            '{% endfor %}' +
            '</select>' +
            '</td>' +

            '<td>' +
            '<input type="text" class="form-control" name="hsn_' + i + '" id="hsn_' + i + '">' +
            '</td>' +

            '<td>' +
            '<input type="text" class="form-control" name="qty_' + i + '" id="qty_' + i + '" onkeyup="qty(\'qty_' + i + '\');">' +
            '</td>' +

            '<td>' +
            '<input type="text" class="form-control" name="uom_' + i + '" id="uom_' + i + '">' +
            '</td>' +

            '<td>' +
            '<input type="text" class="form-control" name="rate_' + i + '" id="rate_' + i + '" onkeyup="rate(\'rate_' + i + '\');">' +
            '</td>' +

            '<td>' +
            '<input type="text" class="form-control" name="discount_' + i + '" id="discount_' + i + '" onkeyup="discountamt(\'discount_' + i + '\');">' +
            '</td>' +

            '<td>' +
            '<input type="text" class="form-control taxrate_0" name="taxrate_' + i + '" id="taxrate_' + i + '" onkeyup="taxrate(\'taxrate_' + i + '\');">' +
            '</td>' +

            '<td>' +
            '<input type="text" class="form-control taxamt" name="taxamt_' + i + '" id="taxamt_' + i + '">' +
            '</td>' +

            '<td>' +
            '<input type="text" class="form-control totalamt" name="total_' + i + '" id="total_' + i + '">' +
            '</td>' +

            '<td class="add-remove text-end">' +
            '<a href="javascript:void(0);" class="add-btn me-2"><i class="fas fa-plus-circle"></i></a> ' +
            '<a href="javascript:void(0);" class="remove-btn"><i class="fe fe-trash-2"></i></a>' +
            '</td>' +
            '</tr>';
        i++;
        $(".add-table-items").append(experiencecontent);
        return false;
    });
</script>

<script type="text/javascript">
    function getitemsdetails(inputname, godown, qty, rate, hsn, uom, discount, taxrate, itemcode) {
        //alert();return;
        input = inputname.split("_");
        //alert(input);return;

        $('#' + inputname).autocomplete({
            source: function (request, response) {
                $.ajax({
                    url: '#',
                    dataType: "json",
                    type: "POST",
                    data: {
                        name_startsWith: request.term,
                        itemsdetails: input
                    },
                    success: function (data) {
                        response($.map(data, function (item) {
                            var code = item.split("|");
                            //alert(data);
                            return {
                                label: code[0],
                                value: code[0],
                                data: item
                            }
                        }));
                    }
                });
            },
            autoFocus: true,
            minLength: 0,
            change: function (event, ui) {
                if (ui.item == null) {
                }
            },
            select: function (event, ui) {
                var names = ui.item.data.split("|");
                console.log(names)
                $('#' + inputname).val(names[0]);
                $('#' + godown).val(names[2]);
                //$('#'+qty).val(names[3]);
                $('#' + qty).val('1');
                // $('#' + rate).val(names[8]);
                $('#' + rate).val('0');
                $('#' + hsn).val(names[5]);
                $('#' + discount).val(names[6]);
                $('#' + taxrate).val(names[7]);
                $('#' + uom).val(names[10]);
                $('#' + itemcode).val(names[11]);

                discountamt(inputname);

                //taxrate(inputname);

                subtotal();

                totaltaxamt();

                getbillamt()
            }

        });
    }

    function getitemscodedetails(inputname, item, godown, qty, rate, hsn, uom, discount, taxrate) {
        //alert();return;
        input = inputname.split("_");
        //alert(input);return;
        // console.log("Mangesh1")
        $('#' + inputname).autocomplete({
            source: function (request, response) {

                $.ajax({
                    url: "{% url 'getitemscodedetails' %}",
                    dataType: "json",
                    type: "POST",
                    data: {
                        name_startsWith: request.term,
                        itemsdetails: input
                    },
                    success: function (data) {
                        response($.map(data, function (item) {
                            var code = item.split("|");
                            //alert(data);
                            return {
                                label: code[0],
                                value: code[0],
                                data: item
                            }
                        }));
                    }
                });
            },
            autoFocus: true,
            minLength: 0,
            change: function (event, ui) {
                if (ui.item == null) {
                }
            },
            select: function (event, ui) {
                var names = ui.item.data.split("|");
                console.log("mangesh",names)
                $('#' + inputname).val(names[0]);
                $('#' + godown).val(names[2]);
                // $('#' + desc).val(names[1]);
                //$('#'+qty).val(names[3]);
                $('#' + qty).val('1');
                $('#' + rate).val('1');
                $('#' + hsn).val(names[2]);
                $('#' + discount).val(names[5]);
                $('#' + taxrate).val(names[7]);
                $('#' + uom).val(names[3]);
                $('#' + item).val(names[1]);
                discountamt(inputname);
                //taxrate(inputname);
                subtotal();
                totaltaxamt();
                getbillamt()
            }
        });
    }

    function discountamt(inputname) {
        //alert(inputname);
        input = inputname.split("_");
        id_val = input[1];
        //alert(id_val);
        var rate = $('#rate_' + id_val).val();
        var qty = $('#qty_' + id_val).val();
        var discount = $('#discount_' + id_val).val();
        var item_rate = $('#item_rate').val();
        if (item_rate == 'tax_exclusive') {
            var total = rate - (rate * discount / 100);
            //alert(total);
            var totalamt = total * qty;
            //alert(totalamt);
            $('#total_' + id_val).val((totalamt).toFixed(2));
            var taxrate = $('#taxrate_' + id_val).val();
            var taxamt = totalamt * taxrate / 100;
            //alert(taxamt);

            $('#taxamt_' + id_val).val((taxamt).toFixed(2));
        }

        if (item_rate == 'tax_inclusive') {
            var total = rate - (rate * discount / 100);
            //alert(totalamt);

            var totalamt = total * qty;
            //alert(totalamt);

            //t = $('#total_'+id_val).val((totalamt).toFixed(2));

            var taxrate = $('#taxrate_' + id_val).val();
            var taxamt = totalamt * taxrate / 100;
            //alert(taxamt);

            $('#taxamt_' + id_val).val((taxamt).toFixed(2));

            t = totalamt - taxamt;

            $('#total_' + id_val).val((t).toFixed(2));
        }

        subtotal();

        getbillamt()
    }

    function taxrate(inputname) {
        //alert(inputname);
        input = inputname.split("_");
        id_val = input[1];
        //alert(id_val);

        var rate = $('#rate_' + id_val).val();
        var qty = $('#qty_' + id_val).val();
        var discount = $('#discount_' + id_val).val();

        /*//var discountamt = rate/100;
        //var totalamt = rate-discountamt;
        var totalamt = rate-(rate*discount/100);
        $('#total_'+id_val).val(totalamt);

        var taxrate = $('#taxrate_'+id_val).val();
        var taxamt = rate*taxrate/100;
        //alert(taxamt);

        $('#taxamt_'+id_val).val((taxamt).toFixed(2));*/

        var item_rate = $('#item_rate').val();

        if (item_rate == 'tax_exclusive') {
            var total = rate - (rate * discount / 100);
            //alert(total);
            var totalamt = total * qty;
            //alert(totalamt);

            $('#total_' + id_val).val((totalamt).toFixed(2));

            var taxrate = $('#taxrate_' + id_val).val();
            var taxamt = totalamt * taxrate / 100;
            //alert(taxamt);

            $('#taxamt_' + id_val).val((taxamt).toFixed(2));
        }

        if (item_rate == 'tax_inclusive') {
            var total = rate - (rate * discount / 100);
            //alert(totalamt);

            var totalamt = total * qty;
            //alert(totalamt);

            //t = $('#total_'+id_val).val((totalamt).toFixed(2));

            var taxrate = $('#taxrate_' + id_val).val();
            var taxamt = totalamt * taxrate / 100;
            //alert(taxamt);

            $('#taxamt_' + id_val).val((taxamt).toFixed(2));

            t = totalamt - taxamt;

            $('#total_' + id_val).val((t).toFixed(2));
        }

        subtotal();

        getbillamt();

        totaltaxamt()
    }

    /*function totaltaxamt()
    {

        var sum1 = 0;
        $(".totaltaxamt").each(function()
        {
          sum1 += +this.value;
        });

        taxamt = sum1/2;

        $('#cgst').val(taxamt);
        $('#sgst').val(taxamt);
        $('#igst').val("0.00");
    }*/

    function totaltaxamt() {
        place_of_supply = $('#place_of_supply').val();

        taxrate_0 = $('.taxrate_0').val();
        //alert(taxrate_0);

        taxrate = taxrate_0 / 2;

        if (place_of_supply == "MAHARASHTRA") {
            var sum1 = 0;
            $(".totaltaxamt").each(function () {
                sum1 += +this.value;
            });

            taxamt = sum1 / 2;

            $('#cgst').val(taxamt);
            $('#sgst').val(taxamt);
            $('#igst').val("0.00");

            $('#cgstper').val(taxrate + '%');
            $('#sgstper').val(taxrate + '%');
            $('#igstper').val("0%");
        }
        else {
            var sum1 = 0;
            $(".totaltaxamt").each(function () {
                sum1 += +this.value;
            });

            taxamt = sum1 / 2;

            $('#cgst').val("0.00");
            $('#sgst').val("0.00");
            $('#igst').val(sum1);

            $('#cgstper').val("0%");
            $('#sgstper').val("0%");
            $('#igstper').val(taxrate_0 + '%');
        }

    }

    function qty(inputname) {
        input = inputname.split("_");
        id_val = input[1];
        //alert(id_val);

        var rate = $('#rate_' + id_val).val();
        var qty = $('#qty_' + id_val).val();
        var discount = $('#discount_' + id_val).val();

        /*//var discountamt = rate/100;
        //var total = rate-discountamt;
        var total = rate-(rate*discount/100);
        var totalamt = total*qty;
        //alert(totalamt);

        $('#total_'+id_val).val((totalamt).toFixed(2));

        var taxrate = $('#taxrate_'+id_val).val();
        var taxamt = totalamt*taxrate/100;
        //alert(taxamt);

        $('#taxamt_'+id_val).val((taxamt).toFixed(2));*/

        var item_rate = $('#item_rate').val();

        if (item_rate == 'tax_exclusive') {
            //var discountamt = rate/100;
            //var total = rate-discountamt;
            var total = rate - (rate * discount / 100);
            //alert(total);
            var totalamt = total * qty;
            //alert(totalamt);

            $('#total_' + id_val).val((totalamt).toFixed(2));

            var taxrate = $('#taxrate_' + id_val).val();
            var taxamt = totalamt * taxrate / 100;
            //alert(taxamt);

            $('#taxamt_' + id_val).val((taxamt).toFixed(2));
        }

        if (item_rate == 'tax_inclusive') {
            //var discountamt = rate/100;
            //var total = rate-discountamt;
            var total = rate - (rate * discount / 100);
            //alert(total);
            var totalamt = total * qty;
            //alert(totalamt);

            //t = $('#total_'+id_val).val((totalamt).toFixed(2));

            var taxrate = $('#taxrate_' + id_val).val();
            var taxamt = totalamt * taxrate / 100;
            //alert(taxamt);

            $('#taxamt_' + id_val).val((taxamt).toFixed(2));

            t = totalamt - taxamt;

            $('#total_' + id_val).val((t).toFixed(2));
        }

        subtotal();

        getbillamt();
    }

    function rate(inputname) {
        input = inputname.split("_");
        id_val = input[1];
        //alert(id_val);

        var rate = $('#rate_' + id_val).val();
        var qty = $('#qty_' + id_val).val();
        var discount = $('#discount_' + id_val).val();

        /*//var discountamt = rate/100;
        //var total = rate-discountamt;
        var total = rate-(rate*discount/100);
        var totalamt = total*qty;
        //alert(totalamt);

        $('#total_'+id_val).val((totalamt).toFixed(2));

        var taxrate = $('#taxrate_'+id_val).val();
        var taxamt = totalamt*taxrate/100;
        //alert(taxamt);

        $('#taxamt_'+id_val).val((taxamt).toFixed(2));*/

        var item_rate = $('#item_rate').val();

        if (item_rate == 'tax_exclusive') {
            //var discountamt = rate/100;
            //var total = rate-discountamt;
            var total = rate - (rate * discount / 100);
            //alert(total);
            var totalamt = total * qty;
            //alert(totalamt);

            $('#total_' + id_val).val((totalamt).toFixed(2));

            var taxrate = $('#taxrate_' + id_val).val();
            var taxamt = totalamt * taxrate / 100;
            //alert(taxamt);

            $('#taxamt_' + id_val).val((taxamt).toFixed(2));
        }

        if (item_rate == 'tax_inclusive') {
            //var discountamt = rate/100;
            //var total = rate-discountamt;
            var total = rate - (rate * discount / 100);
            //alert(total);
            var totalamt = total * qty;
            //alert(totalamt);

            //t = $('#total_'+id_val).val((totalamt).toFixed(2));

            var taxrate = $('#taxrate_' + id_val).val();
            var taxamt = totalamt * taxrate / 100;
            //alert(taxamt);

            $('#taxamt_' + id_val).val((taxamt).toFixed(2));

            t = totalamt - taxamt;

            $('#total_' + id_val).val((t).toFixed(2));
        }

        subtotal();

        getbillamt();

        totaltaxamt();
    }

    /*function subtotal()
    {
        var sum = 0;
        $(".totalamt").each(function()
        {
          sum += +this.value;
        });
        //alert(sum);

        $('.subtotal').val((sum).toFixed(2));
        //$('.finalamt').val(parseInt(sum));

        var sum1 = 0;
        $(".taxamt").each(function()
        {
          sum1 += +this.value;
        });

        $('.totaltaxamt').val(sum1);

        finalamt = sum+sum1;
        $('.finalamt').val(finalamt);
    }*/

    function subtotal() {
        var freight = $('#freight').val();
        //alert(freight);

        var totalamt = 0;
        $(".totalamt").each(function () {
            totalamt += +this.value;
        });
        //alert(totalamt);

        sub_total = parseInt(freight) + totalamt;

        $('.subtotal').val(sub_total);
        //$('.finalamt').val(parseInt(totalamt));

        taxrate = $('.taxrate_0').val();

        gst_amount = (sub_total * taxrate) / 100

        var sum1 = 0;
        $(".taxamt").each(function () {
            sum1 += +this.value;
        });

        $('.totaltaxamt').val(gst_amount);

        finalamt = totalamt + sum1;
        $('.finalamt').val(finalamt);
    }

    function getbillamt() {
        var sum = 0;
        $(".billamt").each(function () {
            sum += +this.value;
        });
        //alert(sum);

        $('.finalamt').val((sum).toFixed(2));
    }

    $(document).on('change', '#item_rate', function () {
        var item_rate = $(this).val();
        //alert(item_rate);

        for (var i = 0; i < 2; i++) {
            //alert(i);

            if (item_rate == 'tax_inclusive') {
                qty('qty_' + i);
                rate('rate_' + i);
                discountamt('discount_' + i);
            }

            if (item_rate == 'tax_exclusive') {
                qty('qty_' + i);
                rate('rate_' + i);
                discountamt('discount_' + i);
            }
        }


    });

    $(document).on('keyup', '#freight', function () {
        subtotal();

        totaltaxamt();
        getbillamt();
    });
</script>


<!-- <script src="https://olatechs.in/crm/supreeno/assets/js/malsup-jquery.js"></script> -->

<script type="text/javascript">
    $(document).on('change', '#customer_name', function () {
        $('#customer_address').empty();
        if ($(this).val() != 'none') {
            var customer_id = $(this).val();
            $.ajax({
                type: 'POST',
                url: '#',
                data: { customer_id: customer_id },
                dataType: 'json',
                success: function (response) {
                    $('#customer_address').val(response['billing_attention'] + ', ' + response['billing_street'] + ', ' + response['billing_city'] + ', ' + response['billing_state'] + ', ' + response['billing_pincode']);
                    $('#gst_no').val(response.gst_no);
                }
            })
        }
        else {
            $("#customer_address").empty();
        }
    });
</script>

<script type="text/javascript">
    $(document).on('change', '#customer_name', function () {
        $('#shipping_address').empty();
        //alert();return;
        var customer_id = $('#customer_name').val();
        //alert(customer_id);return;

        $.ajax({
            type: 'POST',
            url: '#',
            data: { 'customer_id': customer_id },
            dataType: 'json',
            success: function (json) {
                $('#shipping_address').append($('<option>').text("Select Shipping Address"));
                //$('#document_uid').append($('<option>').text("Select Document"));
                $.each(json, function (key, value) {
                    $('#shipping_address')
                        .append($("<option></option>")
                            .attr("value", value.id)
                            .text(value.shippingattention + ', ' + value.shippingstreet + ', ' + value.shippingcity + ', ' + value.shippingstate + ', ' + value.shippingpincode))
                });
            }
        })
    });
</script>
{% endblock custom_js %}