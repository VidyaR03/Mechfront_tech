{% extends 'dashboard/base_template.html' %}
{% block custom_css %}
{% block page_title %}
{% endblock page_title %}
<style>
    /* Media query for small screens */
    @media (max-width: 768px) {
        #sidebar {
            display: none;
            /* Hide the sidebar on small screens */
        }

        #content {
            width: 100%;
            /* Make the content occupy the full width */
        }

        /* Show the sidebar when the toggle button is active */
        #sidebar.active {
            display: block;
            position: fixed;
            top: 0;
            left: 0;
            width: 250px;
            /* Adjust the width as needed */
        }
    }
</style>
<style>
    /* Style the chart container */
    #chart {
        min-width: 5px; /* Minimum width */
        min-height: 5px; /* Minimum height */
        border: 1px solid #ccc; /* Optional: Adding border for visualization */
    }
</style>

{% endblock custom_css %}
<!-- Main content -->
{% block main_content %}

<div class="page-wrapper" style="padding-top:10px;">
    <div class="content container-fluid">
        <div class="row">
            <div class="col-xl-3 col-sm-6 col-12">
                <div class="card">
                    <div class="card-body">
                        <div class="dash-widget-header"> <span class="dash-widget-icon bg-1"> <i
                                    class="fas fa-users"></i> </span>
                            <div class="dash-count">
                                <div class="dash-title"> Total Customer </div>
                                <div class="dash-counts">
                                    <p>{{tcustomer}}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-sm-6 col-12">
                <div class="card">
                    <div class="card-body">
                        <div class="dash-widget-header"> <span class="dash-widget-icon bg-2"> <i
                                    class="fas fa-users"></i> </span>
                            <div class="dash-count">
                                <div class="dash-title">Total Vendor</div>
                                <div class="dash-counts">
                                    <p>{{total_vendor}}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-sm-6 col-12">
                <div class="card">
                    <div class="card-body">
                        <div class="dash-widget-header"> <span class="dash-widget-icon bg-3"> <i
                                    class="fas fa-file-alt"></i> </span>
                            <div class="dash-count">
                                <div class="dash-title">Total Invoices</div>
                                <div class="dash-counts">
                                    <p>{{tInvoice}}</p>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-sm-6 col-12">
                <div class="card">
                    <div class="card-body">
                        <div class="dash-widget-header"> <span class="dash-widget-icon bg-4"> <i
                                    class="far fa-file"></i> </span>
                            <div class="dash-count">
                                <div class="dash-title">Total Bill</div>
                                <div class="dash-counts">
                                    <p>{{bill}}</p>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
        <br>
<div class="row">


    <div class="col-md-6 col-sm-6">
        <div class="card flex-fill">
                <div class="card-header">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="card-title">Sales Analytics</h5>
                        <!-- <div class="dropdown">
                            <button class="btn btn-white btn-sm dropdown-toggle" type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false"> Monthly
                            </button>
                            <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                                <li><a href="javascript:void(0);" class="dropdown-item">Weekly</a></li>
                                <li><a href="javascript:void(0);" class="dropdown-item">Monthly</a></li>
                                <li><a href="javascript:void(0);" class="dropdown-item">Yearly</a></li>
                            </ul>
                        </div> -->
                    </div>
                </div>
                <div>
                    <!-- <label for="year-select">Select Year:</label>
                    <select id="year-select" onchange="handleYearChange()">
                        <option value="2023">2023</option>
                        <option value="2024">2024</option>
                    </select> -->
                </div>
                <div class="card-body" style="max-height: 350px; overflow-y: auto;">
                    <div id="sales_chart" style="height: 250px;">
                    </div>
                    <div class="text-center text-muted">
                        <!-- Your text content -->
                    </div>
                </div>
            </div>
        </div>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

        <div class="col-md-6 col-sm-6">
            <div class="card flex-fill">
                <div class="card-header">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="card-title">Invoice Analytics</h5>
                        <div class="dropdown">
                            <button class="btn btn-white btn-sm dropdown-toggle" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false"> Monthly
                            </button>
                        </div>
                    </div>
                </div>
                <div class="card-body" style="max-height: 350px; overflow-y: auto;">
                    <canvas id="invoiceChart" style="height: 300px;"></canvas>
                </div>
            </div>
        </div>
        
    </div>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // Get invoice data from your Django template
            const invoiceLabels = [
                {% for invoice in invoices %}
                    "{{ invoice.invoice_date|date:'M d' }}",
                {% endfor %}
            ];
            
            const invoiceData = [
                {% for invoice in invoices %}
                    {{ invoice.invoice_sub_total }},
                {% endfor %}
            ];
    
            // Set up the Chart.js chart
            const ctx = document.getElementById('invoiceChart').getContext('2d');
            const invoiceChart = new Chart(ctx, {
                type: 'bar', // You can change this to 'line', 'pie', etc.
                data: {
                    labels: invoiceLabels,
                    datasets: [{
                        label: 'Invoice Amounts',
                        data: invoiceData,
                        backgroundColor: 'rgba(54, 162, 235, 0.6)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        });
    </script>
    
        <br>

        <div class="row">
            <div class="col-md-6 col-sm-6">
                <div class="card">
                    <div class="card-header">
                        <div class="row">
                            <div class="col">
                                <h5 class="card-title">Recent Invoices</h5>
                            </div>
                            <div class="col-auto"> <a href="{% url 'invoice_list'%}"
                                    class="btn-right btn btn-sm btn-outline-primary"> View All </a> </div>
                        </div>
                    </div>
                    <div class="card-body">

                        <div class="table-responsive">
                            <table class="table table-stripped table-hover">
                                    <thead class="thead-light">
                                        <tr>
                                        <tr>
                                            <th>Customer</th>
                                            <th>Invoice Date</th>
                                            <th>Invoice Number</th>
                                            <th>DC no</th>
                                            <th>Amount</th>
                                            <th>Action</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% if invoices %}
                                        {% for t in invoices %}
                                        <tr>
                                            <td>
                                                {{t.invoice_customer_name_customer.customer}}
                                                
                                            </td>
                                            <td>
                                                {{t.invoice_date}}
                                            </td>
                                            <td>
                                                {{t.inv_number}}
                                            </td>
                                            <td>
                                                {{t.invoice_delivery_no}}                                                    
                                            </td>
                                            <td>
                                                {{t.invoice_sub_total}}
                                            </td>
                                            <td>
                                                <a href="{% url 'invoice_show_pdf' t.id %}" style="color: blue;">
                                                    <i class="fas fa-eye"></i> <!-- Assuming you are using Font Awesome icons -->
                                                  </a>
                                                                                              </td>
                                            
                                        </tr>
                                  
                                        {% endfor %}
                                        {% endif %}
                                    </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6 col-sm-6">
                <div class="card">
                    <div class="card-header">
                        <div class="row">
                            <div class="col">
                                <h5 class="card-title">Recent Bill</h5>
                            </div>
                            <div class="col-auto"> <a href="{% url 'purchase_invoice_list'  %}"
                                    class="btn-right btn btn-sm btn-outline-primary"> View All </a> </div>
                        </div>
                    </div>
                    <div class="card-body">

                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead class="thead-light">
                                    <tr>
                                        <th>Vendor</th>
                                        <th>Due Date</th>
                                        <th>Amount</th>
                                        <th>Status</th>
                                        <th class="text-right">Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% if pinvoice %}
                                    {% for t in pinvoice %}
                                    <tr>
                                        <td>
                                            {{t.purchase_invoice_vendor_name.company_name}}
                                        </td>
                                        <td>
                                            {{t.purchase_due_date}}
                                        </td>
                                        <td>
                                            {{t.purchase_invoice_total}}
                                        </td>
                                        <td>
                                            <span class="badge bg-success-light">Invoiced</span>                                                    
                                        </td>
                                        <td>
                                        <a href="{% url 'purchase_invoice_list'%}" style="color: blue;">
                                            <i class="fas fa-eye"></i> <!-- Assuming you are using Font Awesome icons -->
                                          </a>
                                        </td>
                                        
                                    </tr>
                              
                                    {% endfor %}
                                    {% endif %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

</div>
</div>

<!-- Include ApexCharts JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/apexcharts@3.35.1/dist/apexcharts.min.js"></script>
<!-- <script>
    // Sample chart data
    var options = {
        chart: {
            type: '', // You can change the chart type here
        },
        series: [{
            name: 'Sales',
            data: [30, 40, 45, 50, 49, 60, 70, 91, 125],
        }],
        xaxis: {
            categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep'],
        },
    };

    var chart = new ApexCharts(document.querySelector("#sales_chart"), options);
    chart.render();
</script> -->

<script>
    function handleYearChange() {
        var selectedYear = document.getElementById("year-select").value;

        // You may want to fetch the data for the selected year using AJAX
        // For simplicity, I'll simulate updating the URL with the selected year using window.location
        // Update the URL to include the selected year as a query parameter
        window.location.href = "{% url 'admin_home' %}?selected_year=" + selectedYear;
    }

    // Chart rendering function
    function renderChart(creditData, debitData, categories) {
        var options = {
            series: [{
                name: 'Credit',
                data: creditData,
                color: 'rgb(118, 56, 255)'
            }, {
                name: 'Debit',
                data: debitData,
                color: 'rgb(255, 165, 0)'
            }],
            chart: {
                type: 'bar',
                height: 350
            },
            plotOptions: {
                bar: {
                    horizontal: false,
                    columnWidth: '55%',
                    endingShape: 'rounded'
                },
            },
            dataLabels: {
                enabled: false
            },
            stroke: {
                show: true,
                width: 2,
                colors: ['transparent']
            },
            xaxis: {
                categories: categories,
            },
            yaxis: {
                title: {
                    text: '$ (rupees)'
                },
                labels: {
                    formatter: function (value) {
                        return value.toFixed(2); // Displaying two digits after the decimal point
                    }
                }
            },
            fill: {
                opacity: 1
            },
        };

        var chart = new ApexCharts(document.querySelector("#sales_chart"), options);
        chart.render();
    }

    // Assuming credit_data, debit_data, and months_categories are passed from Django template
    renderChart({{ credit_data | safe }}, {{ debit_data | safe }}, ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']);
</script>


<!-- <script>
 function handleYearChange() {
        var selectedYear = document.getElementById("year-select").value;
 }  
var options = {
          series: [{
          name: 'Credit',
          data: {{ credit_data | safe }},
          color: 'rgb(118, 56, 255)'

        }, {
          name: 'Debit',
          data: {{ debit_data | safe }},
          color :'rgb(255, 165, 0)'
        }],
          chart: {
          type: 'bar',
          height: 350
        },
        plotOptions: {
          bar: {
            horizontal: false,
            columnWidth: '55%',
            endingShape: 'rounded'
          },
        },
        dataLabels: {
          enabled: false
        },
        stroke: {
          show: true,
          width: 2,
          colors: ['transparent']
        },
        xaxis: {
          categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct','Nov','Dec'],
        },
        yaxis: {
          title: {
            text: '$ (rupees)'
          
        },
        labels: {
        formatter: function (value) {
        return value.toFixed(2); // Displaying two digits after the decimal point
        }
        }
        },

        fill: {
          opacity: 1
        },
       
        };
        

        var chart = new ApexCharts(document.querySelector("#sales_chart"), options);
        chart.render();
</script> -->

<!DOCTYPE html>
<html>
<head>
    <title>Donut Chart Example</title>
<script src="/path/to/apexcharts.min.js"></script>
</head>
<body>
    <div id="chart"></div>

    <script>
        var totalFreight = {{total_freight}};
        var totalSubTotal = {{total_sub_total}};
        var totalAmount = {{total_amount}};

        var donutData = [totalFreight, totalSubTotal, totalAmount];
        // var donutData = [20,30,40];
        console.log("Mangesh",donutData)

        var donutOptions = {
            chart: {
                type: 'donut',
                height: 350,
                width: '100%',
            },
            series: donutData,
            labels: ['Received', 'Total', 'Pending'],
            colors: ['#FF5733', '#5733FF', '#FFA500'],
            responsive: [{
                breakpoint: 480,
                options: {
                    chart: {
                        height: 250
                    }
                }
            }]
        };

        var chart = new ApexCharts(document.getElementById("chart"), donutOptions);
        chart.render();
    </script>
</body>
</html>



<script src="assets/js/jquery-3.6.0.min.js"></script>
<script src="assets/js/bootstrap.bundle.min.js"></script>
<script src="assets/js/feather.min.js"></script>
<script src="assets/plugins/slimscroll/jquery.slimscroll.min.js"></script>
<script src="assets/plugins/apexchart/apexcharts.min.js"></script>
<script src="assets/plugins/apexchart/chart-data.js"></script>
<script src="assets/js/script.js"></script>

</body>

</html>
{% endblock main_content %}