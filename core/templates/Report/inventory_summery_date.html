{% extends 'dashboard/base_template.html' %}
{% block title %}
CRM
{% endblock %}

{% block custom_css %}

<style>/* Inactive tab styles */
   .nav-tabs.nav-tabs-bottom .nav-item .nav-link {
       color: #ccc; /* Faint gray color for inactive tabs */
   }
   
   /* Active tab style */
   .nav-tabs.nav-tabs-bottom .nav-item .nav-link.active {
       color: #000; /* Black color for active tab */
   }
   </style>
{% endblock custom_css %}

{% block main_content %}




<div class="page-wrapper" style="padding-top: 0px;">
    <div class="content container-fluid">
        <div class="page-header">
            <div class="row">
                <div class="col-sm-12">
                    <h3 class="page-title">
                        <a href="{% url 'inventory_date' %}" style="margin-right: 10px;">
                            <!-- <i class="fa fa-arrow-left" data-bs-toggle="tooltip" title="" data-bs-original-title="Back" aria-label="fa fa-arrow-left"></i> -->
                        </a>
                        Inventory Summary Report Datewise
                    </h3>
                </div>
            </div>
        </div>
        <form class="invoices-form" method="post" action="{% url 'inventory_summery_report' %}" enctype="multipart/form-data" autocomplete="off" novalidate="novalidate">
    {% csrf_token %}
    <div class="invoices-main-form">
        <div class="row">
            <div class="col-xl-3 col-md-6 col-sm-12 col-12">
                <div class="form-group">
                    <label>From Date</label>
                    <input class="form-control" type="date" name="start_date" id="from_date">
                </div>
            </div>

            <div class="col-xl-3 col-md-6 col-sm-12 col-12">
                <div class="form-group">
                    <label>To Date</label>
                    <input class="form-control" type="date" name="end_date" id="to_date">
                </div>
            </div>

<!-- Company Name dropdown -->
<div class="col-xl-3 col-md-6 col-sm-12 col-12">
    <div class="form-group">
        <label>Company Name</label>
        <select class="form-control" name="company_name" id="company_name">
            <option value="">Select Company</option>
            {% for company_name in companies %}
                <option value="{{ company_name }}" {% if selected_company == company_name %}selected{% endif %}>
                    {{ company_name }}
                </option>
            {% endfor %}
        </select>
    </div>
</div>


            <div class="col-md-3">
                <div class="text-end mt-4">
                    <button type="submit" class="btn btn-primary" id="btn_submit" name="btn_submit">Submit</button>
                    <a href="{% url 'inventory_date' %}" class="btn btn-primary">Cancel</a>
                </div>
                <div class="row col-sm-6 p-5">
                    <div class="success_message row"></div>
                </div>
            </div>
        </div>
    </div>
</form>

<script>
document.addEventListener("DOMContentLoaded", function() {
    let today = new Date().toISOString().split('T')[0];
    document.getElementById("from_date").value = today;
    document.getElementById("to_date").value = today;
});
</script>

<script>
document.addEventListener("DOMContentLoaded", function() {
    let fromDateInput = document.getElementById("from_date");
    let toDateInput = document.getElementById("to_date");

    // Render the base URL from Django
    const baseUrl = "{% url 'get_companies_by_date' %}";

    // Set today's date if inputs are empty
    let today = new Date().toISOString().split('T')[0];
    if (!fromDateInput.value) fromDateInput.value = today;
    if (!toDateInput.value) toDateInput.value = today;

    function fetchCompanies() {
        let fromDate = fromDateInput.value;
        let toDate = toDateInput.value;

        if (fromDate && toDate) {
            fetch(`${baseUrl}?start_date=${fromDate}&end_date=${toDate}`)
                .then(response => response.json())
                .then(data => {
                    let companySelect = document.getElementById("company_name");
                    
                    // Clear and add the "All Companies" option
                    companySelect.innerHTML = `<option value="">-- All Companies --</option>`;
                    
                    data.forEach(company => {
                        let opt = document.createElement("option");
                        opt.value = company;
                        opt.textContent = company;
                        companySelect.appendChild(opt);
                    });

                    // Keep previously selected value (even if blank for "All Companies")
                    let selectedCompany = "{{ selected_company|default:'' }}";
                    if (selectedCompany !== undefined) {
                        companySelect.value = selectedCompany;
                    }
                })
                .catch(error => console.error("Error fetching companies:", error));
        }
    }

    fromDateInput.addEventListener("change", fetchCompanies);
    toDateInput.addEventListener("change", fetchCompanies);

    // Auto fetch on page load
    if (fromDateInput.value && toDateInput.value) {
        fetchCompanies();
    }
});
</script>


   
{% endblock main_content %}

    
