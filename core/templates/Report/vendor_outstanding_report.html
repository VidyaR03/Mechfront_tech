{% extends 'dashboard/base_template.html' %}
{% block custom_css %}
<style>
    .custom-error {
        max-width: 300px;
        margin: 0 auto;
        text-align: center;
        color: red;
    }
    .grey-card {
        background-color: LightGray;
    }
    .right-aligned {
        position: fixed;
        top: 20px;
        right: 20px;
    }
    .table-container {
        margin-top: 20px;
        padding: 20px;
        border-radius: 8px;
        background-color: #f9f9f9;
    }
    .table th, .table td {
        text-align: center;
    }
    .table th {
        background-color: #f1f1f1;
    }
    .table td a {
        color: blue;
        text-decoration: none;
    }
    .table td a:hover {
        text-decoration: underline;
    }
    .page-wrapper {
        min-height: auto;
    }
</style>
{% endblock custom_css %}

{% block main_content %}
<div class="page-wrapper">
    <div class="content container-fluid">
        {% if error_message %}
            <div class="custom-error">{{ error_message }}</div>
        {% endif %}
        <div class="row">
            <div class="col-sm-12">
                <div class="card card-table">
                    <div class="card-header">
                        <div class="col-lg-12">
                            <div class="d-flex justify-content-between align-items-center">
                                <h3 class="card-title">
                                    <a href="{% url 'vendor_outstanding' %}" style="margin-right: 10px;">
                                        <i class="fa fa-arrow-left" data-bs-toggle="tooltip" title="Back" aria-label="fa fa-arrow-left"></i>
                                    </a>
                                    Account Payable Summary Details
                                </h3>
                                {% if start_date and end_date %}
                                    <form method="post" action="{% url 'vendor_outstanding' %}" style="display:inline;">
                                        {% csrf_token %}
                                        <input type="hidden" name="vendor_id" value="{{ selected_customer|default_if_none:'all' }}">
                                        <input type="hidden" name="start_date" value="{{ start_date }}">
                                        <input type="hidden" name="end_date" value="{{ end_date }}">
                                        <input type="hidden" name="download_excel" value="true">
                                        <button type="submit" class="btn btn-primary">Download Excel</button>
                                    </form>
                                {% else %}
                                    <button class="btn btn-primary" disabled>Download Excel</button>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="rport">
                            <h2><b>M/S KEYMECH TECHNOLOGIES</b></h2>
                            {% if customer %}
                                <h3>{{ customer.company_name }}</h3>
                            {% endif %}
                            <h3 style="font-size: 20px;">Account Payable Summary Details</h3>
                            <p><b>From</b> {{ start_date|default:'N/A' }} <b>To</b> {{ end_date|default:'N/A' }}</p>
                        </div>
                        <br>
                        <div class="table-container">
                            <div class="table-responsive">
                                <table class="table table-center table-hover">
                                    <thead class="thead-light">
                                        <tr>
                                            <th>SR.NO.</th>
                                                <th>VENDOR NAME</th>
                                            <th>INVOICE NO.</th>
                                            <th>INVOICE DATE</th>
                                            <th>DUE DATE</th>
                                            <th>INVOICE AMOUNT</th>
                                            <th>DUE DAYS</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% if ven_entries %}
                                            {% for data in ven_entries %}
                                            <tr>
                                                <td>{{ forloop.counter }}</td>
                                                   <td>{{ data.vendor_name|upper }}</td>
                                                <td><a href="#" style="color:blue;">{{ data.invoice_number }}</a></td>
                                                <td>{{ data.date|date:"j F Y" }}</td>
                                                <td>{{ data.due_date|date:"j F Y" }}</td>
                                                {% comment %} <td style="text-align: center;">{{ data.amount|floatformat:2 }}</td> {% endcomment %}
                                                <td>{{ data.amount|floatformat:2 }}</td>

                                                <td>{{ data.due_days }}</td>
                                            </tr>
                                            {% endfor %}
                                        {% else %}
                                            <tr>
                                                <td colspan="{% if selected_customer == 'all' %}7{% else %}6{% endif %}">No data available for the selected date range.</td>
                                            </tr>
                                        {% endif %}
                                        <tr>
                                            <td colspan="{% if selected_customer == 'all' %}4{% else %}3{% endif %}"><strong>TOTAL</strong></td>
                                            <td></td>
                                            <td></td>
                                            <td style="text-align: center;"><strong>{{ total_amount_main|floatformat:2 }}</strong></td>
                                            <td></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock main_content %}