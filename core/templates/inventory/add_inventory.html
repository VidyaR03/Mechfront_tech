{% extends 'dashboard/base_template.html' %}
{% block title %}
Ecoway
{% endblock %}

{% block custom_css %}

<style>
   /* Inactive tab styles */
   .nav-tabs.nav-tabs-bottom .nav-item .nav-link {
      color: #ccc;
      /* Faint gray color for inactive tabs */
   }

   /* Active tab style */
   .nav-tabs.nav-tabs-bottom .nav-item .nav-link.active {
      color: #000;
      /* Black color for active tab */
   }
</style>
{% endblock custom_css %}

{% block main_content %}
<div class="page-wrapper" style="padding-top:0px;">
   <div class="content container-fluid">
      <div class="page-header">
         <div class="row">
            <div class="col-sm-12">
               <h3 class="page-title"> <a href="{% url 'inventory_list_data' %}" style="margin-right: 10px;"><i
                        class="fa fa-arrow-left" data-bs-toggle="tooltip" title="" data-bs-original-title="Back"
                        aria-label="fa fa-arrow-left"></i></a>Add Inventory</h3>
            </div>
         </div>
      </div>
      <div class="row">
         <div class="col-md-12">
            <div class="card" data-select2-id="9">
               <div class="card-body" data-select2-id="8">
                  <form method="post" id="inventory_form" action="{% url 'add_inventory' %}" enctype="multipart/form-data" autocomplete="off" novalidate="novalidate">
                     {% csrf_token %}
                     <div class="row">
                         <!-- Item Description, Item Code, Unit, Type, Tax Type -->
                         <div class="col-md-6">
                             <div class="form-group">
                                 <label>Item Description <span style="color: red;">*</span></label>
                                 <input class="form-control" type="text" name="inventory_name" id="name" required>
                                 <div class="error-message" id="inventory_name_error" style="display:none;color:red;">Please enter the item description.</div>
                             </div>
                         </div>
                        <div class="col-md-6">

                        <div class="form-group">
                                    <label>Company Name</label>
                                    <select class="form-control" name="company_name" id="company_name">
                                        <option value="0" hidden>Select Company Name</option>
                                        {% for i in company_name %}
                                        <option value="{{i.id}}">{{i.company_name}}</option>
                                        {% endfor %}
                                    </select>
                                    <div class="error-message" id="comapny_error" style="display:none;color:red;">Please select a company name.</div>
                                </div>
                    </div>
                         <div class="col-md-3">
                             <div class="form-group">
                                 <label>Item Code <span style="color: red;">*</span></label>
                                 <input class="form-control" type="text" name="item_code" id="item_code" required>
                                 <div class="error-message" id="item_code_error" style="display:none;color:red;">Please enter the item code.</div>
                             </div>
                         </div>
                         <div class="col-md-3">
                             <div class="form-group">
                                 <label>Unit <span style="color: red;">*</span></label>
                                 <select class="form-control" name="units" id="unit" required>
                                    <option value="" hidden>Select Unit</option>
                                    <option value="kg">Kilogram (kg)</option>
                                    <option value="g">Gram (g)</option>
                                    <option value="mg">Milligram (mg)</option>
                                    <option value="ltr">Litre (L)</option>
                                    <option value="ml">Millilitre (mL)</option>
                                    <option value="m">Meter (m)</option>
                                    <option value="cm">Centimeter (cm)</option>
                                    <option value="mm">Millimeter (mm)</option>
                                    <option value="km">Kilometer (km)</option>
                                    <option value="sq_m">Square Meter (m²)</option>
                                    <option value="sq_km">Square Kilometer (km²)</option>
                                    <option value="cubic_m">Cubic Meter (m³)</option>
                                    <option value="cubic_cm">Cubic Centimeter (cm³)</option>
                                    <option value="in">Inch (in)</option>
                                    <option value="ft">Foot (ft)</option>
                                    <option value="yd">Yard (yd)</option>
                                    <option value="mile">Mile (mi)</option>
                                    <option value="oz">Ounce (oz)</option>
                                    <option value="lb">Pound (lb)</option>
                                    <option value="ton">Ton (t)</option>
                                    <option value="gal">Gallon (gal)</option>
                                    <option value="qt">Quart (qt)</option>
                                    <option value="pt">Pint (pt)</option>
                                    <option value="cup">Cup</option>
                                    <option value="tbsp">Tablespoon (tbsp)</option>
                                    <option value="tsp">Teaspoon (tsp)</option>
                                    <option value="other">Other</option>
                                    <option value="Nos">Nos</option>

                                 </select>
                                 <div class="error-message" id="unit_error" style="display:none;color:red;">Please select a unit.</div>
                             </div>
                         </div>
                         <div class="col-md-3">
                             <div class="form-group">
                                 <label>Type</label>
                                 <select class="form-control" name="type" id="good_type">
                                     <option value="Goods">Goods</option>
                                     <option value="Service">Services</option>
                                 </select>
                                 <div class="error-message" id="good_type_error" style="display:none;color:red;">Please select a type.</div>
                             </div>
                         </div>
                         <div class="col-md-3">
                             <div class="form-group">
                                 <label>Tax Type</label>
                                 <select class="form-control" name="tax_type" id="tax_type">
                                     <option value="" hidden>Select Tax Type</option>
                                     <option value="Non GST">Non GST</option>
                                     <option value="Taxable" selected>Taxable</option>
                                 </select>
                                 <div class="error-message" id="tax_type_error" style="display:none;color:red;">Please select a tax type.</div>
                             </div>
                         </div>
                         <!-- HSN, SKU, Default Discount -->
                         <div class="col-md-2">
                             <div class="form-group">
                                 <label>HSN/SAC <span style="color: red;">*</span></label>
                                 <input class="form-control" type="number" name="hsn"   oninput="this.value = this.value.replace(/[^0-9]/g, '');" required>
                                 <!-- <div class="error-message" id="hsn_error" style="display:none;color:red;">Please enter a valid 8 digit HSN code. </div> -->
                             </div>
                         </div>
                         <div class="col-md-2">
                             <div class="form-group">
                                 <label>SKU</label>
                                 <input class="form-control" type="number" name="sku" id="sku" value="0" pattern="\d{9}" oninput="this.value = this.value.replace(/[^0-9]/g, '');">
                                 <div class="error-message" id="sku_error" style="display:none;color:red;">Please enter a valid SKU.</div>
                             </div>
                         </div>
                         <!-- <div class="col-md-2">
                             <div class="form-group">
                                 <label>Default Discount (%)</label>
                                 <input class="form-control" type="number" name="default_discount" id="default_discount" value="0" oninput="this.value = this.value.replace(/[^0-9]/g, '');">
                                 <div class="error-message" id="default_discount_error" style="display:none;color:red;">Please enter a valid discount.</div>
                             </div>
                         </div> -->
                         <div class="col-md-2">
                            <div class="form-group">
                                <label>Default Discount (%) </label>
                                <input class="form-control" type="text" name="default_discount" id="default_discount" 
                                       
                                       pattern="\d{1,5}(\.\d{0,2})?" 
                                       title="Enter a number with up to 5 digits before the decimal and up to 2 digits after the decimal."
                                       maxlength="3"
                                       oninput="this.value = this.value.replace(/[^0-9.]/g, '');">
                                <div class="error-message" id="default_discount_error" style="display:none;color:red;">
                                    Please enter a valid discount.
                                </div>
                            </div>
                        </div>
                         
                         <!-- Sales Information Section -->
                         <div class="col-lg-3 pt11">
                             <h5>
                                 <input type="checkbox" name="sales_information" id="sales_information" value="sales_information" style="vertical-align: middle;"> Sales Information
                             </h5>
                         </div>
                         <div class="col-md-2 pt11 sales_information hidden">
                             <div class="form-group">
                                 <label>Rate <span style="color: red;">*</span></label>
                                 <input class="form-control" type="number" name="sale_rate" id="sale_rate" value="0" oninput="this.value = this.value.replace(/[^0-9]/g, '');" required>
                                 <div class="error-message" id="sale_rate_error" style="display:none;color:red;">Please enter the sales rate.</div>
                             </div>
                         </div>
                         <div class="col-md-3 pt11 sales_information hidden">
                            <div class="form-group">
                                <label>Description</label>
                                <textarea class="form-control" name="sale_description" id="sale_description"></textarea>
                                <div class="error-message" id="sale_description_error" style="display:none;color:red;">Please enter a sales description.</div>
                            </div>
                        </div>
                         <div class="col-md-3 pt11 sales_information hidden">
                             <div class="form-group" hidden>
                                 <label>Sales</label>
                                 <select class="form-control" name="sales_account" id="sales_account">
                                     <option value="">Select Account</option>
                                     <optgroup label="Income">
                                       <option value="Sales">Sales</option>
                                       <option value="Discount">Discount</option>
                                       <option value="Shipping Charge">Shipping Charge</option>
                                       <option value="General Income">General Income</option>
                                       <option value="Interest Income">Interest Income</option>
                                       <option value="Late Fee Income">Late Fee Income</option>
                                       <option value="Other Charges">Other Charges</option>
                                   </optgroup>
                                 </select>
                                 <div class="error-message" id="sales_account_error" style="display:none;color:red;">Please select a sales account.</div>
                             </div>
                         </div>
                         
                         
                         <!-- Purchase Information Section -->
                         <div class="col-lg-3 pt11">
                             <h5>
                                 <input type="checkbox" name="purchase_information" id="purchase_information" value="purchase_information" style="vertical-align: middle;"> Purchase Information
                             </h5>
                         </div>
                         <div class="col-md-2 pt11 purchase_information hidden">
                             <div class="form-group">
                                 <label>Rate</label>
                                 <input class="form-control" type="number" name="purchase_rate" id="purchase_rate" value="0" oninput="this.value = this.value.replace(/[^0-9]/g, '');">
                                 <div class="error-message" id="purchase_rate_error" style="display:none;color:red;">Please enter the purchase rate.</div>
                             </div>
                         </div>
                         <div class="col-md-3 pt11 purchase_information hidden">
                             <div class="form-group">
                                 <label>Purchase</label>
                                 <select class="form-control" name="purchase_account" id="purchase_account">
                                     <option value="" hidden>Select Account</option>
                                     <optgroup label="Expense">
                                        <option value="Purchase Account">Purchase Account</option>
                                         <option value="Bank Fees and Charges">Bank Fees and Charges</option>
                                         <option value="Printing and Stationery">Printing and Stationery</option>
                                         <option value="Salaries and Employee Wages">Salaries and Employee Wages</option>
                                         <option value="Meals and Entertainment">Meals and Entertainment</option>
                                         <option value="Depreciation Expense">Depreciation Expense</option>
                                         <option value="Consultant Expense">Consultant Expense</option>
                                         <option value="Repairs and Maintenance">Repairs and Maintenance</option>
                                         <option value="Other Expenses">Other Expenses</option>
                                         <option value="Lodging">Lodging</option>
                                         <option value="Bad Debt">Bad Debt</option>
                                         <option value="Postage">Postage</option>
                                         <option value="Advertising And Marketing">Advertising And Marketing</option>
                                         <option value="Credit Card Charges">Credit Card Charges</option>
                                         <option value="Travel Expense">Travel Expense</option>
                                         <option value="Telephone Expense">Telephone Expense</option>
                                         <option value="Automobile Expense">Automobile Expense</option>
                                         <option value="IT and Internet Expenses">IT and Internet Expenses</option>
                                         <option value="Rent Expense">Rent Expense</option>
                                         <option value="Janitorial Expense">Janitorial Expense</option>
                                         <option value="Office Supplies">Office Supplies</option>
                                         <option value="Custom Duty">Custom Duty</option>
                                         <option value="PETROL EXPENSE">PETROL EXPENSE</option>
                                         <option value="COURIER EXPENSE">COURIER EXPENSE</option>
                                         <option value="Office Expenses">Office Expenses</option>
                                         <option value="COMMISION">COMMISION</option>
                                         <option value="FIX ASSET PURCHASE">FIX ASSET PURCHASE</option>
                                         <option value="BANK COMMISION">BANK COMMISION</option>
                                         <option value="MARKETING EXPENSE">MARKETING EXPENSE</option>
                                         <option value="OTHER PURCHASE">OTHER PURCHASE</option>
                                         <option value="MISC EXPENSE">MISC EXPENSE</option>
                                         <option value="OTHER INDIRECT EXPENSE">OTHER INDIRECT EXPENSE</option>
                                     </optgroup>
                                 
                                 </select>
                                 <div class="error-message" id="purchase_account_error" style="display:none;color:red;">Please select a purchase account.</div>
                             </div>
                         </div>
                         <div class="col-md-3 pt11 purchase_information hidden">
                             <div class="form-group">
                                 <label>Description</label>
                                 <textarea class="form-control" name="purchase_description" id="purchase_description"></textarea>
                                 <div class="error-message" id="purchase_description_error" style="display:none;color:red;">Please enter a purchase description.</div>
                             </div>
                         </div>


                          
                         <!-- Trackable Item Section -->
                         <div class="col-lg-3 pt11">
                           <h5>
                               <input type="checkbox" style="vertical-align: middle;" name="trackable_item" id="trackable_item" value="trackable_item"> It's a trackable item
                           </h5>
                       </div>
                       <div class="col-lg-9 pt11 trackable_item hidden">
                           <div class="row">
                               <div class="col-md-3">
                                   <div class="form-group">
                                       <label>Opening Stock {Qty.}</label>
                                       <input class="form-control" type="number" name="opening_stock" id="opening_stock" value="0" oninput="this.value = this.value.replace(/[^0-9]/g, '');">
                                       <div class="error-message" id="opening_stock_error" style="display:none;color:red;">Please enter the opening stock quantity.</div>
                                   </div>
                               </div>
                               <div class="col-md-3">
                                   <div class="form-group">
                                       <label>Opening Rate</label>
                                       <input class="form-control" type="number" name="opening_rate" id="opening_rate" value="0" oninput="this.value = this.value.replace(/[^0-9]/g, '');">
                                       <div class="error-message" id="opening_rate_error" style="display:none;color:red;">Please enter the opening rate.</div>
                                   </div>
                               </div>
                               <div class="col-md-3" hidden>
                                   <div class="form-group">
                                       <label>Godown</label>
                                       <select class="form-control" name="godown" id="godown">
                                           <option value="" hidden>Select Godown</option>
                                           {% for i in godown_name %}
                                           <option value="{{i.city_name}}">{{i.city_name}}</option>
                                           {% endfor %}
                                       </select>
                                       <div class="error-message" id="godown_error" style="display:none;color:red;">Please select a godown.</div>
                                   </div>
                               </div>
                               <div class="col-md-3">
                                <div class="form-group">
                                    <label>Godown</label>
                                    <select class="form-control" name="inv_godown" id="godown">
                                        <option value="0" hidden>Select Godown</option>
                                        {% for i in godown_name %}
                                        <option value="{{i.id}}">{{i.city_name}}</option>
                                        {% endfor %}
                                    </select>
                                    <div class="error-message" id="godown_error" style="display:none;color:red;">Please select a godown.</div>
                                </div>
                            </div>
                           </div>
                       </div>
                      
                         
                         <!-- Submit Button -->
                         <div class="col-md-12 pt11">
                             <div class="form-group">
                                 <button type="submit" class="btn btn-primary" id="submit">Submit</button>
                                <a href="{% url 'inventory_list_data' %}" class="btn customer-btn-cancel btn-outline-danger me-1 btn-rounded">Cancel</a>

                             </div>
                         </div>
                     </div>
                 </form>
                 
               </div>
            </div>
         </div>


{% endblock main_content %}
{% block custom_js %}

<!-- omkar code  -->
<script type="text/javascript">
   $(document).ready(function () {
      // Initialize states on page load
      if ($('#trackable_item').prop('checked')) {
         $('.trackable_item').show();
         $('#purchase_information').attr('disabled', 'disabled');
         $('#sales_information').attr('disabled', 'disabled');
      } else {
         $('.trackable_item').hide();
         $('#purchase_information').removeAttr('disabled');
         $('#sales_information').removeAttr('disabled');
      }

      // Trackable item checkbox click event
      $('#trackable_item').click(function () {
         if ($(this).prop('checked')) {
            $('#purchase_information').attr('disabled', 'disabled');
            $('#sales_information').attr('disabled', 'disabled');
            $('.trackable_item').show();
         } else {
            $('#purchase_information').removeAttr('disabled');
            $('#sales_information').removeAttr('disabled');
            $('.trackable_item').hide();
         }
      });

      // Purchase information checkbox click event
      $('#purchase_information').click(function () {
         if ($(this).prop('checked')) {
            $('.purchase_information').show();
         } else {
            $('.purchase_information').hide();
         }
      });

      // Sales information checkbox click event
      $('#sales_information').click(function () {
         if ($(this).prop('checked')) {
            $('.sales_information').show();
         } else {
            $('.sales_information').hide();
         }
      });

      // Tax type change event
      $('#tax_type').change(function () {
         var $tax_type = $('#tax_type').val();
         if ($tax_type == 'Taxable') {
            $('.instrastate_gst').show();
            $('.insterstate_gst').show();
         } else {
            $('.instrastate_gst').hide();
            $('.insterstate_gst').hide();
         }
      });

      // Trigger change event on page load to handle default state
      $('#purchase_information').trigger('click');
      $('#sales_information').trigger('click');
      $('#tax_type').trigger('change');
   });
</script>
<script>
   document.getElementById('sales_information').addEventListener('change', function () {
       document.querySelectorAll('.sales_information').forEach(function (element) {
           element.classList.toggle('hidden', !this.checked);
       }, this);
   });

   document.getElementById('purchase_information').addEventListener('change', function () {
       document.querySelectorAll('.purchase_information').forEach(function (element) {
           element.classList.toggle('hidden', !this.checked);
       }, this);
   });

   // Utility function to handle validation and display errors
   function validateField(field, errorMessageId, condition) {
       if (condition) {
           field.classList.add('is-invalid');
           document.getElementById(errorMessageId).style.display = 'block';
       } else {
           field.classList.remove('is-invalid');
           document.getElementById(errorMessageId).style.display = 'none';
       }
   }

   // Validate fields live
   function attachValidationLive() {
       const form = document.getElementById('inventory_form');

       // Check Item Description
       const nameField = form.querySelector('#name');
       nameField.addEventListener('input', function () {
           validateField(nameField, 'inventory_name_error', !nameField.value.trim());
       });

       // Check Item Code
       const itemCodeField = form.querySelector('#item_code');
       itemCodeField.addEventListener('input', function () {
           validateField(itemCodeField, 'item_code_error', !itemCodeField.value.trim());
       });

       // Check Unit
       const unitField = form.querySelector('#unit');
       unitField.addEventListener('change', function () {
           validateField(unitField, 'unit_error', !unitField.value);
       });

       

       // Add similar event listeners for other fields as needed
   }

   // Attach validation on page load
   attachValidationLive();

   document.getElementById('inventory_form').addEventListener('submit', function (event) {
       let form = event.target;
       let isValid = true;

       // Check all fields before submitting
       const nameField = form.querySelector('#name');
       const itemCodeField = form.querySelector('#item_code');
       const unitField = form.querySelector('#unit');

       validateField(nameField, 'inventory_name_error', !nameField.value.trim());
       validateField(itemCodeField, 'item_code_error', !itemCodeField.value.trim());
       validateField(unitField, 'unit_error', !unitField.value);

       isValid = !document.querySelectorAll('.is-invalid').length;

       if (!isValid) {
           event.preventDefault();
       }
   });
</script>
{% endblock custom_js %}