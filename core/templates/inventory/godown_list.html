{% extends 'dashboard/base_template.html' %}
{% block custom_css %}
{% block page_title %}
{% endblock page_title %}
<style>
    .custom-error {
        max-width: 300px;
        margin: 0 auto;
        text-align: center;
    }
    .input-group-text {
        cursor: pointer;
    }
    .grey-card {
        background-color: LightGray;
    }
    .toast-success {
              background-color: darkgreen !important;
              color: white !important;
    }
    #toast-container {
        top: auto;
        top: 60px; /* Adjust this value to move the message further down or up */
    }
        .dataTables_filter{
            margin-bottom: 16px !important;
        }
        .dataTables_length{
            margin-top: 8px !important;
        }
</style>
{% endblock custom_css %}
{% block main_content %}
<div class="page-wrapper negative-padding">
    <div class="content container-fluid">
        <div class="page-header">
            <div class="row align-items-center">
                <div class="col">
                    <h3 class="page-title">Godown</h3>
                </div>
                <div class="col-auto">
                    <a href="{% url 'godown_add' %}" class="btn btn-primary btn-rounded">
                        <i class="fas fa-plus-circle"></i> Add Godown
                    </a>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-12">
                <div class="card card-table">
                    <div class="card-body">
                        <div class="table-responsive">
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label> Search Godown City</label>
                                    <div>
                                        <select class="form-control" name="city_name" id="city_name">
                                            <option value="all">All</option>
                                            {% for i in godown_list %}
                                            <option value="{{ i.city_name }}">{{ i.city_name }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <table id="challanTable" class="table table-center table-hover datatable">
                                <thead class="thead-light">
                                    <tr>
                                        <th>SR. No</th>
                                       
                                        <th>Godown City</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% if godown_list %}
                                    {% for t in godown_list %}
                                    <tr>
                                        <td>{{ forloop.counter }}</a></td>
                                      
                                        <td class="city"><a href="{% url 'godown_view' id=t.id %}" >{{ t.city_name }}</a></td>
                                        <td>
                                            <div class="btn-group" role="group">
                                                <a href="{% url 'edit_godown' id=t.id %}" class="btn btn-sm btn-outline-success me-1 btn-rounded" role="button"><i class="far fa-edit me-1"></i></a>
                                                <!-- <a class="btn btn-sm btn-outline-danger me-1" onclick="confirmDelete('{% url 'delete_godown' id=t.id %}')">
                                                    <i class="far fa-trash-alt me-1"></i>
                                                </a> -->


                                                <a class="btn btn-sm btn-outline-danger me-1" data-bs-toggle="modal" data-bs-target="#deleteModal" 
                                                data-url="{% url 'delete_godown' id=t.id %}">
                                                <i class="far fa-trash-alt me-1"></i></a>
                                            </div>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                    {% endif %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="deleteModalLabel">Confirm Deletion</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          Are you sure you want to delete this item?
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
        </div>
      </div>
    </div>
  </div>

{% endblock main_content %}
{% block custom_js %}

<!-- Include Toastr CSS and JavaScript -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>
<script>
  // Function to show the toast message
  function showToastMessage(message, type) {
    toastr[type](message);
  }

  // Check if a success message exists and show it as a toast
  {% if messages %}
    {% for message in messages %}
      {% if message.tags == 'success' %}
        showToastMessage('{{ message }}', 'success');
      {% endif %}
    {% endfor %}
  {% endif %}
</script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>
<script>
    $(document).ready(function () {
        // Initialize DataTable with ordering set to false
        var table = $('#challanTable').DataTable({
            "paging": true,
            "lengthChange": true,
            "searching": true,
            "info": true,
            "ordering": false,
        });

        // Dropdown filter functionality
        $('#city_name').on('change', function() {
            var selectedCity = $(this).val().toLowerCase();

            $('#challanTable tbody tr').each(function() {
                var rowCity = $(this).find('.city').text().toLowerCase();

                if (selectedCity === "all" || selectedCity === rowCity) {
                    $(this).show();
                } else {
                    $(this).hide();
                }
            });

            // Redraw DataTable to update the display
            table.draw();
        });
    });

    // Function to confirm the delete action
    function confirmDelete(url) {
        if (confirm("Are you sure you want to delete this item?")) {
            // If the user clicks OK, redirect to the delete URL
            window.location.href = url;
        }
    }
</script>

<script>

    document.getElementById('deleteModal').addEventListener('show.bs.modal', function (event) {
      var button = event.relatedTarget;
      var url = button.getAttribute('data-url');
      
      // Set the URL for the confirm button
      var confirmButton = document.getElementById('confirmDeleteBtn');
      confirmButton.onclick = function() {
        window.location.href = url;
      };
    });
    </script>
    
{% endblock custom_js %}
